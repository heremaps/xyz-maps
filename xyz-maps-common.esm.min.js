/*
 * @here/xyz-maps-common
 * (c) 2019-2022 HERE
 */
var t="undefined"!=typeof window?window:global;let e=0;class s{constructor(t={},s){this.id=++e,t.exec&&(this.exec=t.exec),t.init&&(this.init=t.init),t.onDone&&(this.onDone=t.onDone),this.name=t.name,this.time=t.time||3,this.setPriority(t.priority),this.manager=s||a.getInstance()}setPriority(t){this.priority=Math.max(Math.min(0^t,5),1)}setManager(t){this.manager=t}start(t){return this._initData=t,this.manager.start(this)}pause(){return this.paused=!0,this.CONTINUE}resume(){this.paused=!1,this.start(this._initData)}restart(t={}){const{_initData:e}=this;this.cancel(),this.paused=!1,this.canceled=!1,this.yield=!1,this._data=null,t.init&&(this.init=t.init),t.priority&&this.setPriority(t.priority),t.onDone&&(this.onDone=t.onDone),this.start(e)}init(t){return t}exec(t){}onDone(t){return t}cancel(){return this._initData=null,this.manager.cancel(this)}isInterrupted(){return this.started&&this.yield}}s.prototype.CONTINUE=!0,s.prototype.BREAK=!1,s.prototype.onDone=null,s.prototype._data=null,s.prototype.yield=!1,s.prototype.canceled=!1;const r=1e3/60-4;let n,i=0;class o{constructor(e){this.time=r,this.now=()=>performance.now();const s=this;if(s.queue=[[],[],[],[],[],[]],s.id=i++,s.active=!1,e>1&&(s.time=e||r),t.postMessage){const e="tm-"+s.id;t.addEventListener("message",(r=>{r.source==t&&r.data==e&&(r.stopPropagation(),s.runner())}),!0),s._resume=()=>{s.active=!0,t.postMessage(e,"*")}}else s._resume=()=>{s.active=!0,setTimeout(s.runner.bind(s),0)}}runner(t){const e=this;if(!e.active)return e._resume();for(t||(t=e.now());;){const s=e._next();if(!s)break;let r,n,i,o=!1;for(s.yield?(s.yield=!1,i=s._data):(n=e.now(),i=s.init(s._initData));!o;){const a=n||e.now();if(n=null,o=!s.exec(i)||s.canceled,e.task=null,o){s.yield=!1,s._data=null,this.completeTask(s,i),r=e.now();break}if(r=e.now(),s.paused){s._data=i,s.started=!1,s.yield=!0;break}if(s.yield||r-a>s.time||r-t>e.time)return this.resumeTask(s,i),e._resume()}if(!(r-t<e.time))return e._resume()}e.active=!1}completeTask(t,e){var s;t.started=!1,t.canceled||null===(s=t.onDone)||void 0===s||s.call(t,e)}resumeTask(t,e){this._insert(this.task=t,!0),t.yield=!0,t._data=e}setExclusiveTime(t){this.time=0^t}_next(){const t=this.queue;let e=null;for(let s=1,{length:r}=t;s<r&&!(e=t[s].shift());s++);return this.task=e}create(t){return new s(t,this)}_insert(t,e){const s=this.queue[t.priority];e?s.unshift(t):s.push(t)}isWaiting(t){return-1!=this.queue[t.priority].indexOf(t)}start(t,e){const s=this.task;t.started||t.paused||(t.started=!0,t!=s&&(t.canceled=!1,this._insert(t),this.active?s&&s.priority>t.priority&&(s.yield=!0):(this.active=!!e,this.runner())))}cancel(t){t.canceled=!0,t.yield=!1,t.started=!1;const e=t==this.task,s=t.priority,r=this.queue[s],n=r.indexOf(t);return-1!=n&&r.splice(n,1),e&&(this.task=null),e}}var a={getInstance:function(t){return n?"number"==typeof t&&(n.time=t):n=this.createInstance(t),n},createInstance:function(t){return this.active=!0,new o(t)},active:!1};class l extends s{constructor(t,e){const s=t.tasks;super({name:t.name,priority:t.priority},e),this.results=[],this.tasks=s,this.onAllDone=t.onDone,this.initSequence()}setActiveTask(t){this.current=t,this.priority=this.tasks[t].priority,this.time=this.tasks[t].time}initSequence(){this.setActiveTask(0),this.results.length=0}curTask(){return this.tasks[this.current]}nextTask(){const t=this.current+1;if(t<this.tasks.length)return this.setActiveTask(t),this.tasks[t]}init(t){return this.curTask().init(t)}exec(t){return this.curTask().exec(t)}cancel(){return this.initSequence(),super.cancel()}onDone(t){var e,s;let r=this.curTask();const n=null===(e=r.onDone)||void 0===e?void 0:e.call(r,t);t=void 0===n?t:n,this.results.push(t);if(this.nextTask())this._initData=t,this.manager._insert(this,!0);else{const t=this.results.slice();this.initSequence(),null===(s=this.onAllDone)||void 0===s||s.call(this,t)}}}let h;const c=(t,e,s)=>{let r=-1;for(let n=0;n<t.length;n++)if(t[n][0]==e&&t[n][1]==s){r=n;break}return r};class u{constructor(t){this._l={},this._sync=!1,this._exec={};for(let e=0;e<t.length;e++)this.addEvent(t[e])}addEvent(t){this._l[t]||(this._l[t]=[],this._exec[t]=h)}sync(t){return this._sync=!!t,this}removeEvent(t){delete this._l[t]}getEvents(){const t=[];for(const e in this._l)t[t.length]=e;return t}get(t){let e=this._l[t];return e&&e.slice()}isDefined(t){return!!this._l[t]}isListened(t){return this._l[t]&&this._l[t].length}add(t,e,s){let r,n=!1;return this._l.hasOwnProperty(t)&&(r=c(this._l[t],e,s),-1==r&&(this._l[t].push([e,s]),n=!0)),n}remove(t,e,s){if(this._l.hasOwnProperty(t)){const r=c(this._l[t],e,s);if(-1!=r)return this._exec[t]--,this._l[t].splice(r,1),!0}return!1}trigger(t,e,s,r){let n,i=!1;if(this._l[t]){const o=this._l[t].length;for(this._exec[t]=0;this._exec[t]<o;this._exec[t]++)if(i=!0,n=this._l[t][this._exec[t]]){if(r&&!r(n))continue;const t=n[0],i=n[1];s||this._sync?Array.isArray(e)?t.apply(i,e):t.call(i,e):((t,e,s)=>{setTimeout((()=>{Array.isArray(s)?t.apply(e,s):t.call(e,s)}),0)})(t,i,e)}this._exec[t]=h}return i}}class p{constructor(t,e){this.key=t,this.data=e}}p.prototype.data=null,p.prototype.next=null,p.prototype.prev=null;class d{constructor(t){this.length=0,this.head=null,this.tail=null,this.max=t||5e3,this._={},this.tail=null}setSize(t){if(this.length>t){let e=this.length-t;for(;e--;)this.remove(this.tail.key)}this.max=t}get(t){let e,s,r;return(e=this._[t])&&(e!=this.head&&(this.tail==e&&(this.tail=e.next),s=e.prev,r=e.next,s&&(s.next=e.next||e),r&&(r.prev=s),(s=this.head)&&(s.next=e),e.prev=this.head,e.next=null,this.head=e),e=e.data),e}toArray(){let t=[],e=this.tail,s=0;for(;e;)t[s++]=e.data,e=e.next;return t}forEach(t){let e=this.tail,s=0;for(;e;)t(e.data,s++),e=e.next}clear(){this._={},this.head=null,this.tail=null,this.length=0}remove(t){let e,s,r;return(e=this._[t])&&(s=e.prev,r=e.next,s&&(s.next=r),r&&(r.prev=s),r||(this.head=s),s||(this.tail=r),delete this._[t],e=e.data,this.length--),e}set(t,e){let s,r,n;return(s=this._[t])?(s.data=e,s!=this.head&&this.get(t)):(this.length==this.max?(n=this.tail.data,delete this._[this.tail.key],this.tail=this.tail.next,this.tail.prev=null):this.length++,s=new p(t,e),this._[t]=s,r=this.head,r?(s.prev=r,r.next=s):this.tail=s,this.head=s),n}}const f=a.getInstance();var g=(t,e,s)=>{s=s||f;const r=t.indexOf("["),n=t.lastIndexOf("]"),i=(e,s)=>{e.grp=20,e.elements.push.apply(e.elements,JSON.parse("["+t.slice(e.start,s)+"]")),e.start=null};s.create({name:"PJA",priority:4,time:4,onDone:function(s){if(e){let i;const o=s.elements;if(o.length)if(-1!=t.indexOf('"type":"FeatureCollection"')){const e=JSON.parse(t.substr(0,r+1)+t.substr(n));e.features=o,i=e}else i=o;else i=JSON.parse(t);e(i)}},init:function(){return{i:r,open:0,start:null,len:n,elements:[],grp:20,last:null}},exec:function(e){const s=e.elements,r=e.len;let n,o;if(e.i<r){for(;(n=e.i++)<r;)if(o=t.charAt(n),'"'!=o){if("{"==o)e.open++,null==e.start&&(e.start=n);else if("}"==o){if(0==--e.open)return--e.grp&&n<r-2||(e.grp=20,s.push.apply(s,JSON.parse("["+t.slice(e.start,e.last=n+1)+"]")),e.start=null),this.CONTINUE}else if(0==e.open&&!isNaN(o)){20!=e.grp&&i(e,n-1);const r=t.substr(n),o=r.search("[0-9](]|,)")+1;s.push(parseFloat(r.substring(0,o))),e.i=n+o}}else e.i=t.indexOf('"',n+1)+1;20!=e.grp&&null!=e.last&&s.push.apply(s,JSON.parse("["+t.slice(e.last+1,t.lastIndexOf("]"))+"]"))}}}).start()};const y=(t,e,s)=>{if(null==s||"object"!=typeof s)return s;if(s.constructor!=Object&&s.constructor!=Array)return s;if(s.constructor==Date||s.constructor==RegExp||s.constructor==Function||s.constructor==String||s.constructor==Number||s.constructor==Boolean)return new s.constructor(s);e=e||new s.constructor;for(const r in s)e[r]=y(t,t?e[r]:null,s[r]);return e},m=(t,e)=>{for(const s in e)"constructor"!=s&&(t[s]=e[s]);return t},x=t=>{if("object"!=typeof t||!t)return t;if(Array.isArray(t)){const e=[];for(let s=0;s<t.length;s+=1)e[s]=x(t[s]);return e}const e={};for(let s in t)t.hasOwnProperty(s)&&(e[s]=x(t[s]));return e},b={loglevel:"debug",dump:function(t,e){const s=!!b.loglevel,{console:r}=window;if(s&&r){const t=Array.prototype.slice.call(arguments);let e=t[t.length-1];if(e in r?t.pop():e="log",!0===s||s===e)if(Function.prototype.bind&&"object"==typeof r.log){Function.prototype.bind.call(r[e],r).apply(r,t)}else r[e].apply(r,t)}return b},extend:(t,e,s)=>("boolean"!=typeof t&&(s=e,e=t,t=!1),y(t,e,s)),clone:x,createObject:Object.create||(t=>{const e=()=>{};return e.prototype=t,new e}),inheritClass:(t,e,s)=>{const r=e.prototype,n=t.prototype;"object"==typeof e&&(s=e,e.constructor==Object.prototype.constructor&&(e.constructor=function(){t.apply(this,arguments)}),e=e.constructor),e.prototype=b.createObject(n),r&&r!=Object.prototype&&m(e.prototype,r);for(const s in t)e[s]=t[s];return s&&m(e.prototype,s),e},isFunction:t=>"function"==typeof t,isNumeric:t=>!isNaN(+t)&&isFinite(t),isPlainObject:t=>{if(!t||"object"!=typeof t||t.nodeType||t==t.window)return!1;try{if(t.constructor&&!t.hasOwnProperty("constructor")&&!t.constructor.prototype.hasOwnProperty("isPrototypeOf"))return!1}catch(t){return!1}let e;for(e in t);return undefined===e||t.hasOwnProperty(e)},String:{round:(t,e)=>e?Number(t.toFixed(e)):Math.round(t),random:t=>{t=t||16;let e="";const s="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz";for(let r=0;r<t;r++)e+=s.charAt(62*Math.random()^0);return e}}},v=Math.PI/180,E=180/Math.PI,_=6371e3;let k;const M=(t,e)=>{const s=v*(e[1]-t[1]),r=v*(e[0]-t[0]),n=Math.sin(s/2)*Math.sin(s/2)+Math.cos(v*t[1])*Math.cos(v*e[1])*Math.sin(r/2)*Math.sin(r/2),i=2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n));let o=_*i;if(t[2]!=k&&e[2]!=k){const s=t[2]-e[2];o=Math.sqrt(o*o+s*s)}return o};var w={calcBearing:(t,e)=>{const s=t[1]*v,r=e[1]*v,n=(e[0]-t[0])*v,i=Math.sin(n)*Math.cos(r),o=Math.cos(s)*Math.sin(r)-Math.sin(s)*Math.cos(r)*Math.cos(n);return(Math.atan2(i,o)*E+360)%360},movePoint:(t,e,s,r)=>{const n=e/(r=r===k?_:r),i=s*v,o=t[1]*v,a=t[0]*v,l=Math.asin(Math.sin(o)*Math.cos(n)+Math.cos(o)*Math.sin(n)*Math.cos(i));let h=a+Math.atan2(Math.sin(i)*Math.sin(n)*Math.cos(o),Math.cos(n)-Math.sin(o)*Math.sin(l));return h=(h+3*Math.PI)%(2*Math.PI)-Math.PI,[h*E,l*E]},getPointBBox:(t,e)=>{const s=t[1],r=t[0],n=Math.asin(e/(_*Math.cos(Math.PI*s/180)))*E,i=Math.asin(e/_)*E;return[r-n,s-i,r+n,s+i]},mergeBBoxes:(t,e)=>(t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[2]&&(t[2]=e[2]),t[3]<e[3]&&(t[3]=e[3]),t),extendBBox:(t,e)=>{const s=Math.abs(Math.asin(e/(_*Math.cos(t[0]*v))))*E,r=Math.abs(Math.asin(e/(_*Math.cos(t[2]*v))))*E,n=Math.abs(Math.asin(e/_))*E;return[t[0]-s,t[1]-n,t[2]+r,t[3]+n]},distance:M};const O=(t,e,s)=>(t[0]=e[0]-s[0],t[1]=e[1]-s[1],t[2]=e[2]-s[2],t),j=(t,e,s)=>(t[0]=e[0]+s[0],t[1]=e[1]+s[1],t[2]=e[2]+s[2],t),N=(t,e,s)=>(t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t),S=(t,e)=>t[0]*e[0]+t[1]*e[1]+t[2]*e[2];var P=Object.freeze({__proto__:null,add:j,cross:(t,e,s)=>{const r=e[0],n=e[1],i=e[2],o=s[0],a=s[1],l=s[2];return t[0]=n*l-i*a,t[1]=i*o-r*l,t[2]=r*a-n*o,t},dot:S,length:t=>{const[e,s,r]=t;return Math.sqrt(e*e+s*s+r*r)},multiply:(t,e,s)=>(t[0]=e[0]*s[0],t[1]=e[1]*s[1],t[2]=e[2]*s[2],t),normalize:(t,e)=>{const s=e[0],r=e[1],n=e[2];let i=s*s+r*r+n*n;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},scale:N,sub:O,transform:(t,e,s)=>{const r=e[0],n=e[1],i=e[2]||0;let o=s[3]*r+s[7]*n+s[11]*i+s[15];return o||(o=1),t[0]=(s[0]*r+s[4]*n+s[8]*i+s[12])/o,t[1]=(s[1]*r+s[5]*n+s[9]*i+s[13])/o,t[2]=(s[2]*r+s[6]*n+s[10]*i+s[14])/o,t}});const A={centroid(t){const e=t[0],s=e[0][0],r=e[0][1];let n,i,o=0,a=0,l=0;for(let t,h,c,u=0,{length:p}=e,d=p-1;u<p;d=u,u++)n=e[u][0]-s,i=e[u][1]-r,t=e[d][0]-s,h=e[d][1]-r,c=i*t-h*n,a+=(n+t)*c,l+=(i+h)*c,o+=c;return o*=3,o?[a/o+s,l/o+r]:[n,i]},findPointOnLineString(t,e,s=!1){var r,n,i;e=[e[0],e[1],s?0:null!==(r=e[2])&&void 0!==r?r:0];let o,a=1/0,l=null;for(let r=1,h=0,c=[0,0,0],u=[0,0,0],p=t.length;r<p;h=r++){c[0]=t[h][0],c[1]=t[h][1],u[0]=t[r][0],u[1]=t[r][1],s?(c[2]=0,u[2]=0):(c[2]=null!==(n=t[h][2])&&void 0!==n?n:0,u[2]=null!==(i=t[r][2])&&void 0!==i?i:0);const p=A.getClosestPntOnLine(c,u,e,!0),d=M(p,e);d<a&&(o=p,a=d,l=h)}return{point:o,segment:l}},getClosestPntOnLine(t,e,s,r){const n=O([],s,t),i=O([],e,t),o=O([],e,t);let a=S(i,n)/S(i,i);return r&&(a=Math.max(0,Math.min(1,a))),N(o,o,a),j(o,o,t)},intersectBBox:(t,e,s,r,n,i,o,a)=>t<=i&&n<=e&&s<=a&&o<=r};class D{constructor(t){if(this.size=0,this._=[],t)for(var e=0;e<t.length;e++)this.add(t[e])}add(t){const e=!this.has(t);return e&&(this.size=this._.push(t)),e}clear(){this.size=this._.length=0}delete(t){const e=this._.indexOf(t),s=-1!=e;return s&&(this._.splice(e,1),this.size--),s}has(t){return-1!=this._.indexOf(t)}toArray(){return this._.slice(0)}}let C=class{constructor(t){if(this._={},this.size=0,t)for(let e=0;e<t.length;e++)this.set(t[e][0],t[e][1])}clear(){this.size=0,this._={}}delete(t){const e=this.has(t);return e&&(delete this._[t],this.size--),e}get(t){return this._[t]}has(t){return null!=this._[t]}set(t,e){let s=!this.has(t);return s&&(this.size++,this._[t]=e),s}values(){const t=this._,e=[];for(let s in t)e[e.length]=t[s];return e}keys(){const t=this._,e=[];for(let s in t)e[e.length]=s;return e}forEach(t){const e=this._;for(let s in e)t(e[s],s,this)}};class q{constructor(){this.queue=[]}add(t){if("function"==typeof t)return this.queue.push(t)}done(t,e,s){let r=this.queue;for(;r.length;)r.shift()(...arguments)}}class T{constructor(t){this.heap=[],this.compare=t}get(t){return this.heap[t]}find(t){return this.heap.find(t)}findIndex(t){return this.heap.findIndex(t)}includes(t){return this.heap.includes(t)}push(t){this.heap.push(t),this.bubbleUp(this.heap.length-1)}pop(){const{heap:t}=this;if(!t.length)return;const e=t[0],s=t.pop();return t.length&&(t[0]=s,this.sinkDown(0)),e}adjustElement(t){const e=this.heap[t],s=Math.floor((t-1)/2),r=this.heap[s];s>0&&this.compare(e,r)<0?this.bubbleUp(t):this.sinkDown(t)}remove(t){const e=this.heap.findIndex((e=>e===t));if(-1!==e){const t=this.heap.pop();e!==this.heap.length&&(this.heap[e]=t,this.adjustElement(e))}}size(){return this.heap.length}bubbleUp(t){const e=this.heap[t];for(;t>0;){const s=Math.floor((t-1)/2),r=this.heap[s];if(this.compare(e,r)>=0)break;this.heap[s]=e,this.heap[t]=r,t=s}}sinkDown(t){const e=this.heap.length,s=this.heap[t];for(;;){let r=2*t+1,n=2*t+2,i=null;if(r<e){const t=this.heap[r];this.compare(t,s)<0&&(i=r)}if(n<e){const t=this.heap[n];(null===i&&this.compare(t,s)<0||null!==i&&this.compare(t,this.heap[i])<0)&&(i=n)}if(null===i)break;this.heap[t]=this.heap[i],this.heap[i]=s,t=i}}}class I{constructor(t,e,s,r=null,n){this.point=t,this.g=e,this.h=s,this.f=e+s,this.parent=r,this.data=n}}class R{static calculateDistance(t,e){const s=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(s*s+r*r)}static weight(t,e){return R.calculateDistance(t.point,e.point)}static isPointEqual(t,e){const s=R.precision;return(t[0]*s^0)==(e[0]*s^0)&&(t[1]*s^0)==(e[1]*s^0)}static pointKey(t){const e=R.precision,s=t.point;return 1e7*(s[0]*e^0)+(s[1]*e^0)}static reconstructPath(t){const e=[];for(;null!==t;)e.unshift(t),t=t.parent;return e}static findPath(t,e,s,r=R.weight,n=R.pointKey,i=(t,e)=>t.id===e.id){const o=(t,e,s,r=null,i)=>{const o=new I(t,e,s,r,i);return o.id=n(o),o},a=new T(((t,e)=>t.f-e.f)),l=new Map,h=o(e.point,0,1/0,null,e.data);for(h.id,a.push(o(t.point,0,1/0,null,t.data));a.size()>0;){const t=a.pop();if(i(t,h))return this.reconstructPath(t);l.set(t.id,!0);const e=s(t);for(const s of e){const{point:e,data:i}=s,c=n(s);if(l.has(c))continue;const u=t.g+r(t,s),p=r(s,h),d=a.findIndex((t=>R.isPointEqual(t.point,e)));if(-1!=d){const e=a.get(d);if(u>=e.g)continue;e.g=u,e.h=p,e.f=u+p,e.parent=t,e.data=i,a.adjustElement(d)}else{const s=o(e,u,p,t,i);a.push(s)}}}return null}}var B;R.precision=1e5,function(t){t[t.static=0]="static",t[t.dynamic=1]="dynamic"}(B||(B={}));let z=0;class J{constructor(t,e){this.json=t,this.env=e}static isExpression(t){return t instanceof J}static isDynamicExpression(t,e){return this.isExpression(t)&&t.dynamic(e)}clone(t){return new this.constructor(t||this.toJSON(),this.env)}dynamic(t,e=1,s=1,r){const n=[this.json[0]];let i=!1,o=!1;for(let a=e,{json:l}=this,h=r||l.length;a<h;a+=s){let e=this.compileOperand(a);if(J.isExpression(e)){let s=e.dynamic(t);if(s){o=this,s!=e&&(i=!0,e=s)}}n[a]=e}return i?this.clone(n):o}compileOperand(t){return this.json[t]=this.env.parseJSON(this.json[t])}operand(t,e){return this.env.evaluateParsed(this.compileOperand(t),e)}toJSON(){return this.json.map((t=>J.isExpression(t)?t.toJSON():t))}resolve(t,e){const{env:s}=this;let r;return void 0===t&&(t=s.context,r=s.dynamicResultCache),s.evaluate(this,t,e,r)}id(){return this._id||(this._id=++z)}}const L=J;class F extends L{eval(t){const{json:e}=this;let s=0;for(let r=1,{length:n}=e;r<n;r++){let e=this.operand(r,t);s+=Number(e)||0}return s}}F.operator="+";class $ extends L{eval(t){let e=this.operand(1,t),s=this.operand(2,t);return Number(e)-Number(s)}}$.operator="-";class K extends L{eval(t){let e=this.operand(1,t),s=this.operand(2,t);return Number(e)*Number(s)}}K.operator="*";class U extends L{eval(t){let e=this.operand(1,t),s=this.operand(2,t);return Number(e)/Number(s)}}U.operator="/";class W extends L{eval(t){let e=this.operand(1,t),s=this.operand(2,t);return Number(e)%Number(s)}}W.operator="%";class G extends Error{constructor(t){super(t),Object.setPrototypeOf(this,G.prototype),this.name=this.constructor.name}}class H extends J{eval(t){const e=this.operand(1,t);if("number"!=typeof e)throw new G("invalid operand type "+this.json);return Math.floor(e)}}H.operator="floor";class Q extends J{eval(t){const{json:e}=this;let s=1/0;for(let r=1,{length:n}=e;r<n;r++){let e=this.operand(r,t);e<s&&(s=e)}return s}}Q.operator="min";class Z extends J{eval(t){const{json:e}=this;let s=-1/0;for(let r=1,{length:n}=e;r<n;r++){let e=this.operand(r,t);e>s&&(s=e)}return s}}Z.operator="max";class V extends J{eval(t){const{json:e}=this;for(let s=1,{length:r}=e;s<r;s++)if(!Boolean(this.operand(s,t)))return!1;return!0}}V.operator="all";class X extends J{eval(t){const{json:e}=this;for(let s=1,{length:r}=e;s<r;s++)if(Boolean(this.operand(s,t)))return!0;return!1}}X.operator="any";class Y extends J{eval(t){return!this.operand(1,t)}}Y.operator="!";class tt extends J{eval(t){var e;const{json:s}=this,r=s[1];let n=this.operand(2,t);return!(null===(e=null!=n?n:t)||void 0===e?void 0:e.hasOwnProperty(r))}}tt.operator="!has";class et extends tt{}et.operator="!has";class st extends J{dynamic(t){return!1}eval(t){var e;const{json:s}=this,r=s[1];let n=this.operand(2,t);return(null===(e=null!=n?n:t)||void 0===e?void 0:e.hasOwnProperty(r))||!1}}st.operator="has";class rt extends J{eval(t){const{json:e}=this;for(let s=1,{length:r}=e;s<r;s++){if(this.operand(1,t))return!1}return!0}}rt.operator="none";const nt=J;class it extends nt{eval(t){return this.operand(1,t)==this.operand(2,t)}}it.operator="==";class ot extends nt{eval(t){return this.operand(1,t)!=this.operand(2,t)}}ot.operator="!=";class at extends nt{eval(t){return this.operand(1,t)>this.operand(2,t)}}at.operator=">";class lt extends nt{eval(t){return this.operand(1,t)>=this.operand(2,t)}}lt.operator=">=";class ht extends nt{eval(t){return this.operand(1,t)<=this.operand(2,t)}}ht.operator="<=";class ct extends nt{eval(t){return this.operand(1,t)<this.operand(2,t)}}ct.operator="<";class ut extends J{eval(t){let e=this.operand(1,t),s=this.operand(2,t);return"string"==typeof e&&"string"==typeof s&&e.startsWith(s)}}ut.operator="^=";class pt extends J{eval(t){let e=this.operand(1,t),s=this.operand(2,t);return"string"==typeof e&&"string"==typeof s&&e.endsWith(s)}}pt.operator="$=";class dt extends J{eval(t){let e=this.operand(1,t),s=this.operand(2,t);return e.split(s)}}dt.operator="split";class ft extends J{eval(t){let e=this.operand(1,t);return String(e)}}ft.operator="to-string";class gt extends J{eval(t){const{json:e}=this;let s="";for(let r=1,n=e.length;r<n;r++)s+=String(this.operand(r,t));return s}}gt.operator="concat";class yt extends J{eval(t){let e=this.operand(1,t);if("string"!=typeof e)return e;let s=this.operand(2,t);if("string"!=typeof s)return e;let r=this.operand(3,t);return"string"!=typeof r?e:e.replace(new RegExp(s,"g"),r)}}yt.operator="regex-replace";class mt extends J{eval(t){const e=this.operand(1,t),s=this.operand(2,t),r=this.operand(3,t);return e.slice(s,r)}}mt.operator="slice";class xt extends J{eval(t){const e=this.operand(1,t);return this.operand(2,t)[e]}}xt.operator="at";class bt extends J{eval(t){return this.operand(1,t).length}}bt.operator="length";class vt extends Error{constructor(t){super(t),Object.setPrototypeOf(this,vt.prototype),this.name=this.constructor.name}}class Et extends J{constructor(t,e){if(t.length<4)throw new vt("invalid arguments");if(t.length%2)throw new vt("missing fallback");super(t,e)}dynamic(t){this.start=1;const e=["case"];let s=!1,r=!1;for(let n=1,{json:i}=this,o=i.length;n<o;n++){let i,a=this.compileOperand(n),l=n==o-1;if(Boolean(n%2)&&!l){if(i=this.operand(n,t),!i){n++,r=!0;continue}{let e=J.isDynamicExpression(a,t);if(!e&&!s)return J.isDynamicExpression(this.compileOperand(n+1),t)||this.operand(n+1,t);s||(s=e)}}else if(i=J.isDynamicExpression(a,t)||this.operand(n,t),l&&1==e.length)return i;a!=i&&(r=!0),e.push(i)}return r?this.clone(e):this}eval(t){const{json:e}=this;let s=e.length-1;for(let e=this.start||1;e<s;e+=2){if(this.operand(e,t))return this.operand(e+1,t)}return this.operand(s,t)}}Et.operator="case";class _t extends J{eval(t){let e=this.operand(1,t),s=this.operand(2,t);if(e<this.operand(3,t))return s;const{json:r}=this;for(let t=r.length-2;t>2;t-=2)if(e>=r[t])return r[t+1]}}_t.operator="step";class kt extends J{dynamic(t){for(let e=1,s=this.json.length-2;e<s;e+=2)if(J.isDynamicExpression(this.compileOperand(e),t))return this;return!!J.isDynamicExpression(this.compileOperand(this.json.length-1),t)&&this}eval(t){const{json:e}=this,s=this.operand(1,t),r=e.length-2;for(let n=2;n<r;n+=2){let r=e[n];Array.isArray(r)||(r=[r]);for(let e of r)if(e==s)return this.operand(n+1,t)}return this.operand(e.length-1,t)}}kt.operator="match";class Mt extends J{dynamic(t){return!1}eval(t){return this.json[1]}}Mt.operator="literal";class wt extends Error{constructor(t){super(t),Object.setPrototypeOf(this,wt.prototype),this.name=this.constructor.name}}class Ot extends J{getLookupTable(t){let e=Ot._lookupTableCache.get(t);if(e&&!Array.isArray(e))return e;e=new Map;for(const s of t){if(!(null==s?void 0:s.keys)||!(null==s?void 0:s.attributes))throw new wt("invalid lookup table");const t=Object.getOwnPropertyNames(s.keys).sort();for(let e=0,r=t.length;e<r;e++){const r=t[e];t[e]=`${r}=${s.keys[r]}`}e.set(t.join(";"),s.attributes)}return Ot._lookupTableCache.set(t,e),e}getCombinations(t){const e=t.length,s=[];for(let r=0;r<1<<e;r++){const n=[];for(let s=0;s<e;s++)r&1<<s&&n.push(t[s]);s.push(n)}return s}getLookupMapSearchKeys(t){let e=[];for(let s=0,r=t.length;s<r;s+=2)e.push(t[s]+"="+t[s+1]);const s=e.join(";");let r=Ot._lookupSearchKeyCache.get(s);if(!r){e.sort(),r=this.getCombinations(e).sort(((t,e)=>e.length-t.length));for(let t=0,e=r.length;t<e;t++)r[t]=r[t].join(";");Ot._lookupSearchKeyCache.set(s,r)}return r}eval(t){const{json:e}=this;let s=this.operand(1,t);const r=[];for(let s=2;s<e.length;s++)r.push(this.operand(s,t));let n=this.getLookupTable(s),i=this.getLookupMapSearchKeys(r);for(let t of i){let e=n.get(t);if(e)return e}return null}}Ot.operator="lookup",Ot._lookupSearchKeyCache=new Map,Ot._lookupTableCache=new Map;class jt extends Error{constructor(t){super(t),Object.setPrototypeOf(this,jt.prototype),this.name=this.constructor.name}}class Nt extends J{eval(t){const{json:e}=this,s=e[0];for(let r=1,n=e.length;r<n;r++){let e=this.operand(r,t);if(typeof e==s)return e}throw new jt("expected type: "+s)}}class St extends Nt{}St.operator="number";class Pt extends Nt{}Pt.operator="boolean";class At extends Error{constructor(t){super(t),Object.setPrototypeOf(this,At.prototype),this.name=this.constructor.name}}class Dt extends J{eval(t){const{json:e}=this;for(let s=1;s<e.length;s++){let e=this.operand(s,t);if(e=Number(e),!isNaN(e))return e}throw new At("convert error: "+e)}}Dt.operator="to-number";class Ct extends J{eval(t){let e=this.operand(1,t);return Boolean(e)}}Ct.operator="to-boolean";class qt extends J{dynamic(t){return!1}eval(t){return this.env.evaluate(this.env.resolveReference(this.json),t,this.env.getMode())}}qt.operator="ref";class Tt extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Tt.prototype),this.name=this.constructor.name}}class It extends J{constructor(t,e){if("string"!=typeof t[1])throw new Tt("Name parameter must be of type string");super(t,e)}dynamic(t){return!1}eval(t){this.json[2]&&(t=this.operand(2,t));const e=this.json[1];let s=null==t?void 0:t[e];return void 0===s&&(s=this.env.context[e]),null!=s?s:null}}It.operator="get";var Rt,Bt=Object.freeze({__proto__:null,AllExpression:V,AnyExpression:X,AtArrayExpression:xt,BooleanExpression:Pt,CaseExpression:Et,ConcatExpression:gt,DevideExpression:U,EndsWithExpression:pt,EqualsExpression:it,FloorExpression:H,GetExpression:It,GreaterExpression:at,GreaterOrEqualExpression:lt,HasExpression:st,HasNotExpression:tt,LengthExpression:bt,LiteralExpression:Mt,LookupExpression:Ot,MatchExpression:kt,MaxExpression:Z,MinExpression:Q,ModulusExpression:W,MultiplyExpression:K,NoneExpression:rt,NotEqualsExpression:ot,NotInExpression:et,NumberExpression:St,ReferenceExpression:qt,RegexReplaceExpression:yt,SliceExpression:mt,SmallerExpression:ct,SmallerOrEqualExpression:ht,SplitExpression:dt,StartsWithExpression:ut,StepExpression:_t,SubtractExpression:$,SumExpression:F,ToBooleanExpression:Ct,ToNumberExpression:Dt,ToStringExpression:ft,isFalseExpression:Y});!function(t){const e={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgrey:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",grey:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"778899",lightslategrey:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"},s=t=>{const e=t.length;return e<5?[parseInt(t.charAt(0),16)/15,parseInt(t.charAt(1),16)/15,parseInt(t.charAt(2),16)/15,4==e?parseInt(t.charAt(3),16)/15:1]:r(parseInt(t,16),8==e)},r=(t,e)=>e?[(t>>24&255)/255,(t>>16&255)/255,(t>>8&255)/255,(255&t)/255]:[(t>>16&255)/255,(t>>8&255)/255,(255&t)/255,1];for(let t in e)e[t]=s(e[t]);t.toRGB=(t,n)=>{let i;return t&&(Array.isArray(t)?(i=t,3==i.length&&(i[3]=1)):"number"==typeof t?n||(i=r(t)):"#"==t[0]?i=s(t.slice(1)):/^([A-Fa-f\d]+)$/.test(t)?i=s(t):t.startsWith("rgb")?i=(t=>{const e=t.match(/^rgba?\s*\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d*(?:\.\d+)?))?\)$/);return(null==e?void 0:e.length)>3&&[e[1]/255,e[2]/255,e[3]/255,null==e[4]?1:Number(e[4])]})(t):(i=e[t],i=i&&[i[0],i[1],i[2],i[3]])),i||null},t.rgbaToHexString=t=>{const[e,s,r,n=1]=t,i=t=>Math.round(255*t).toString(16).padStart(2,"0"),o=`#${i(e)}${i(s)}${i(r)}`;return n<1?`${o}${i(n)}`:o}}(Rt||(Rt={}));var zt=Rt.toRGB;class Jt extends J{dynamic(){return this}eval(t){return this.env.context.zoom}}Jt.operator="zoom";const Lt=(t,e,s)=>t+(e-t)*s;class Ft extends J{dynamic(t){return super.dynamic(t,2,2)}eval(t){var e;const{json:s}=this,r=null===(e=s[1])||void 0===e?void 0:e[0],n=Ft.supported[r];if(!n)return;const i=this.operand(2,t);let o,a,l,h,c,u=3,p=s.length;for(;u<p;u+=2){if(h=this.operand(u,t),h>i){a=this.operand(u+1,t);break}l=h}if(3==u)return a;if(u==p)return this.operand(p-1,t);if(o=this.operand(u-1,t),"linear"==r)c=(i-l)/(h-l);else if("exponential"==r){const t=s[1][1];c=1==t?(i-l)/(h-l):(Math.pow(t,i-l)-1)/(Math.pow(t,h-l)-1)}let d=zt(o,!0);return null!=d?"number"==typeof c?(a=zt(a,!0),[n(d[0],a[0],c),n(d[1],a[1],c),n(d[2],a[2],c),n(d[3],a[3],c)]):d:n(o,a,c)}}Ft.operator="interpolate",Ft.supported={linear:Lt,discrete:t=>t,exponential:Lt};var $t,Kt=Object.freeze({__proto__:null,InterpolateExpression:Ft,ZoomExpression:Jt});class Ut{constructor(t={},e={}){this.cache=new Map,this.defaultResultCache=new Map,this.dynamicResultCache=new Map,this.definitions=t,this.context=e,this.setMode(B.static),this.defaultResultCache.hits=0,this.dynamicResultCache.hits=0,this.cache.hits=0}static isJSONExp(t){return Array.isArray(t)&&"string"==typeof t[0]}static isSupported(t){return null!=this.Expressions[t]}init(t,e){this.clearCache(),this.setDefinitions(t),this.context=e}setDefinitions(t){this.definitions=t}clearCache(){this.cache.hits=0,this.cache.clear()}evaluate(t,e,s=B.static,r){let n;t=this.parseJSON(t);try{this.setMode(s,r),n=this.evaluateParsed(t,e)}catch(t){throw t}return n}evaluateParsed(t,e){if(t instanceof J){if(this.getMode()===Ut.Mode.dynamic){let s=t.dynamic(e);if(s)return s}let s=this.resultCache.get(t);return void 0!==s?(this.resultCache.hits++,s):(s=t.eval(e),this.resultCache.set(t,s),s)}return t}resolveReference(t,e=this.definitions){let s=e[null==t?void 0:t[1]];if(null!=s)for(null!=s.value&&(s=s.value);Ut.isJSONExp(s)&&"ref"==s[0];)s=e[s[1]],void 0!==s.value&&(s=s.value);return s}parseJSON(t,e){if(!Ut.isJSONExp(t))return t;let[s]=t;const r="ref"==s,n=r?t[1]:t;let i=this.cache.get(n);if(null!=i)return this.cache.hits++,i;if(r){if(i=this.resolveReference(t),!Ut.isJSONExp(i))return this.cache.set(n,i),i;t=i,[s]=i}const o=Ut.Expressions[s];if(o)return i=new o(t,this),this.cache.set(n,i),i;if(!1!==e)throw new Error(`Expression ${s} unsupported`)}createExpression(t){const e=Ut.Expressions[t[0]];return e&&new e(t,this)}clearResultCache(){this.defaultResultCache.clear()}clearDynamicResultCache(){this.dynamicResultCache.clear()}isSupported(t){return Boolean(Ut.Expressions[t[0]])}setMode(t,e){this._mode=t,this.context.mode=t,this.resultCache=e||this.defaultResultCache}getMode(){return this._mode}}$t=Ut,Ut.Mode=B,(()=>{let t={};for(let e of[...Object.values(Bt),...Object.values(Kt)])t[e.operator]=e;$t.Expressions=t})();let Wt=t;"here.xyz.maps".split(".").forEach((t=>Wt=Wt[t]=Wt[t]||{})),t.HERE=t.here;const Gt={AStar:R,BinaryHeap:T,Color:Rt,Expression:J,ExpressionMode:B,ExpressionParser:Ut,LRU:d,TaskManager:a,Task:s,TaskSequence:l,Listener:u,parseJSONArray:g,JSUtils:b,geotools:w,global:t,Queue:q,Set:D,Map:C,vec3:P,geometry:A};Wt.common=Gt;export{R as AStar,T as BinaryHeap,Rt as Color,J as Expression,B as ExpressionMode,Ut as ExpressionParser,b as JSUtils,d as LRU,u as Listener,C as Map,q as Queue,D as Set,s as Task,a as TaskManager,l as TaskSequence,Gt as default,A as geometry,w as geotools,t as global,g as parseJSONArray,P as vec3};
