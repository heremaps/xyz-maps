/*
 * @here/xyz-maps-common
 * (c) 2019-2022 HERE
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).here=e.here||{},e.here.xyz=e.here.xyz||{},e.here.xyz.maps=e.here.xyz.maps||{},e.here.xyz.maps.common={}))}(this,(function(e){"use strict";var t="undefined"!=typeof window?window:global;let s=0;class r{constructor(e={},t){this.id=++s,e.exec&&(this.exec=e.exec),e.init&&(this.init=e.init),e.onDone&&(this.onDone=e.onDone),this.name=e.name,this.time=e.time||3,this.setPriority(e.priority),this.manager=t||l.getInstance()}setPriority(e){this.priority=Math.max(Math.min(0^e,5),1)}setManager(e){this.manager=e}start(e){return this._initData=e,this.manager.start(this)}pause(){return this.paused=!0,this.CONTINUE}resume(){this.paused=!1,this.start(this._initData)}restart(e={}){const{_initData:t}=this;this.cancel(),this.paused=!1,this.canceled=!1,this.yield=!1,this._data=null,e.init&&(this.init=e.init),e.priority&&this.setPriority(e.priority),e.onDone&&(this.onDone=e.onDone),this.start(t)}init(e){return e}exec(e){}onDone(e){return e}cancel(){return this._initData=null,this.manager.cancel(this)}isInterrupted(){return this.started&&this.yield}}r.prototype.CONTINUE=!0,r.prototype.BREAK=!1,r.prototype.onDone=null,r.prototype._data=null,r.prototype.yield=!1,r.prototype.canceled=!1;const n=1e3/60-4;let i,o=0;class a{constructor(e){this.time=n,this.now=()=>performance.now();const s=this;if(s.queue=[[],[],[],[],[],[]],s.id=o++,s.active=!1,e>1&&(s.time=e||n),t.postMessage){const e="tm-"+s.id;t.addEventListener("message",(r=>{r.source==t&&r.data==e&&(r.stopPropagation(),s.runner())}),!0),s._resume=()=>{s.active=!0,t.postMessage(e,"*")}}else s._resume=()=>{s.active=!0,setTimeout(s.runner.bind(s),0)}}runner(e){const t=this;if(!t.active)return t._resume();for(e||(e=t.now());;){const s=t._next();if(!s)break;let r,n,i,o=!1;for(s.yield?(s.yield=!1,i=s._data):(n=t.now(),i=s.init(s._initData));!o;){const a=n||t.now();if(n=null,o=!s.exec(i)||s.canceled,t.task=null,o){s.yield=!1,s._data=null,this.completeTask(s,i),r=t.now();break}if(r=t.now(),s.paused){s._data=i,s.started=!1,s.yield=!0;break}if(s.yield||r-a>s.time||r-e>t.time)return this.resumeTask(s,i),t._resume()}if(!(r-e<t.time))return t._resume()}t.active=!1}completeTask(e,t){var s;e.started=!1,e.canceled||null===(s=e.onDone)||void 0===s||s.call(e,t)}resumeTask(e,t){this._insert(this.task=e,!0),e.yield=!0,e._data=t}setExclusiveTime(e){this.time=0^e}_next(){const e=this.queue;let t=null;for(let s=1,{length:r}=e;s<r&&!(t=e[s].shift());s++);return this.task=t}create(e){return new r(e,this)}_insert(e,t){const s=this.queue[e.priority];t?s.unshift(e):s.push(e)}isWaiting(e){return-1!=this.queue[e.priority].indexOf(e)}start(e,t){const s=this.task;e.started||e.paused||(e.started=!0,e!=s&&(e.canceled=!1,this._insert(e),this.active?s&&s.priority>e.priority&&(s.yield=!0):(this.active=!!t,this.runner())))}cancel(e){e.canceled=!0,e.yield=!1,e.started=!1;const t=e==this.task,s=e.priority,r=this.queue[s],n=r.indexOf(e);return-1!=n&&r.splice(n,1),t&&(this.task=null),t}}var l={getInstance:function(e){return i?"number"==typeof e&&(i.time=e):i=this.createInstance(e),i},createInstance:function(e){return this.active=!0,new a(e)},active:!1};class h extends r{constructor(e,t){const s=e.tasks;super({name:e.name,priority:e.priority},t),this.results=[],this.tasks=s,this.onAllDone=e.onDone,this.initSequence()}setActiveTask(e){this.current=e,this.priority=this.tasks[e].priority,this.time=this.tasks[e].time}initSequence(){this.setActiveTask(0),this.results.length=0}curTask(){return this.tasks[this.current]}nextTask(){const e=this.current+1;if(e<this.tasks.length)return this.setActiveTask(e),this.tasks[e]}init(e){return this.curTask().init(e)}exec(e){return this.curTask().exec(e)}cancel(){return this.initSequence(),super.cancel()}onDone(e){var t,s;let r=this.curTask();const n=null===(t=r.onDone)||void 0===t?void 0:t.call(r,e);e=void 0===n?e:n,this.results.push(e);if(this.nextTask())this._initData=e,this.manager._insert(this,!0);else{const e=this.results.slice();this.initSequence(),null===(s=this.onAllDone)||void 0===s||s.call(this,e)}}}let c;const u=(e,t,s)=>{let r=-1;for(let n=0;n<e.length;n++)if(e[n][0]==t&&e[n][1]==s){r=n;break}return r};class p{constructor(e){this._l={},this._sync=!1,this._exec={};for(let t=0;t<e.length;t++)this.addEvent(e[t])}addEvent(e){this._l[e]||(this._l[e]=[],this._exec[e]=c)}sync(e){return this._sync=!!e,this}removeEvent(e){delete this._l[e]}getEvents(){const e=[];for(const t in this._l)e[e.length]=t;return e}get(e){let t=this._l[e];return t&&t.slice()}isDefined(e){return!!this._l[e]}isListened(e){return this._l[e]&&this._l[e].length}add(e,t,s){let r,n=!1;return this._l.hasOwnProperty(e)&&(r=u(this._l[e],t,s),-1==r&&(this._l[e].push([t,s]),n=!0)),n}remove(e,t,s){if(this._l.hasOwnProperty(e)){const r=u(this._l[e],t,s);if(-1!=r)return this._exec[e]--,this._l[e].splice(r,1),!0}return!1}trigger(e,t,s,r){let n,i=!1;if(this._l[e]){const o=this._l[e].length;for(this._exec[e]=0;this._exec[e]<o;this._exec[e]++)if(i=!0,n=this._l[e][this._exec[e]]){if(r&&!r(n))continue;const e=n[0],i=n[1];s||this._sync?Array.isArray(t)?e.apply(i,t):e.call(i,t):((e,t,s)=>{setTimeout((()=>{Array.isArray(s)?e.apply(t,s):e.call(t,s)}),0)})(e,i,t)}this._exec[e]=c}return i}}class d{constructor(e,t){this.key=e,this.data=t}}d.prototype.data=null,d.prototype.next=null,d.prototype.prev=null;class f{constructor(e){this.length=0,this.head=null,this.tail=null,this.max=e||5e3,this._={},this.tail=null}setSize(e){if(this.length>e){let t=this.length-e;for(;t--;)this.remove(this.tail.key)}this.max=e}get(e){let t,s,r;return(t=this._[e])&&(t!=this.head&&(this.tail==t&&(this.tail=t.next),s=t.prev,r=t.next,s&&(s.next=t.next||t),r&&(r.prev=s),(s=this.head)&&(s.next=t),t.prev=this.head,t.next=null,this.head=t),t=t.data),t}toArray(){let e=[],t=this.tail,s=0;for(;t;)e[s++]=t.data,t=t.next;return e}forEach(e){let t=this.tail,s=0;for(;t;)e(t.data,s++),t=t.next}clear(){this._={},this.head=null,this.tail=null,this.length=0}remove(e){let t,s,r;return(t=this._[e])&&(s=t.prev,r=t.next,s&&(s.next=r),r&&(r.prev=s),r||(this.head=s),s||(this.tail=r),delete this._[e],t=t.data,this.length--),t}set(e,t){let s,r,n;return(s=this._[e])?(s.data=t,s!=this.head&&this.get(e)):(this.length==this.max?(n=this.tail.data,delete this._[this.tail.key],this.tail=this.tail.next,this.tail.prev=null):this.length++,s=new d(e,t),this._[e]=s,r=this.head,r?(s.prev=r,r.next=s):this.tail=s,this.head=s),n}}const g=l.getInstance();var y=(e,t,s)=>{s=s||g;const r=e.indexOf("["),n=e.lastIndexOf("]"),i=(t,s)=>{t.grp=20,t.elements.push.apply(t.elements,JSON.parse("["+e.slice(t.start,s)+"]")),t.start=null};s.create({name:"PJA",priority:4,time:4,onDone:function(s){if(t){let i;const o=s.elements;if(o.length)if(-1!=e.indexOf('"type":"FeatureCollection"')){const t=JSON.parse(e.substr(0,r+1)+e.substr(n));t.features=o,i=t}else i=o;else i=JSON.parse(e);t(i)}},init:function(){return{i:r,open:0,start:null,len:n,elements:[],grp:20,last:null}},exec:function(t){const s=t.elements,r=t.len;let n,o;if(t.i<r){for(;(n=t.i++)<r;)if(o=e.charAt(n),'"'!=o){if("{"==o)t.open++,null==t.start&&(t.start=n);else if("}"==o){if(0==--t.open)return--t.grp&&n<r-2||(t.grp=20,s.push.apply(s,JSON.parse("["+e.slice(t.start,t.last=n+1)+"]")),t.start=null),this.CONTINUE}else if(0==t.open&&!isNaN(o)){20!=t.grp&&i(t,n-1);const r=e.substr(n),o=r.search("[0-9](]|,)")+1;s.push(parseFloat(r.substring(0,o))),t.i=n+o}}else t.i=e.indexOf('"',n+1)+1;20!=t.grp&&null!=t.last&&s.push.apply(s,JSON.parse("["+e.slice(t.last+1,e.lastIndexOf("]"))+"]"))}}}).start()};const m=(e,t,s)=>{if(null==s||"object"!=typeof s)return s;if(s.constructor!=Object&&s.constructor!=Array)return s;if(s.constructor==Date||s.constructor==RegExp||s.constructor==Function||s.constructor==String||s.constructor==Number||s.constructor==Boolean)return new s.constructor(s);t=t||new s.constructor;for(const r in s)t[r]=m(e,e?t[r]:null,s[r]);return t},x=(e,t)=>{for(const s in t)"constructor"!=s&&(e[s]=t[s]);return e},b=e=>{if("object"!=typeof e||!e)return e;if(Array.isArray(e)){const t=[];for(let s=0;s<e.length;s+=1)t[s]=b(e[s]);return t}const t={};for(let s in e)e.hasOwnProperty(s)&&(t[s]=b(e[s]));return t},v={loglevel:"debug",dump:function(e,t){const s=!!v.loglevel,{console:r}=window;if(s&&r){const e=Array.prototype.slice.call(arguments);let t=e[e.length-1];if(t in r?e.pop():t="log",!0===s||s===t)if(Function.prototype.bind&&"object"==typeof r.log){Function.prototype.bind.call(r[t],r).apply(r,e)}else r[t].apply(r,e)}return v},extend:(e,t,s)=>("boolean"!=typeof e&&(s=t,t=e,e=!1),m(e,t,s)),clone:b,createObject:Object.create||(e=>{const t=()=>{};return t.prototype=e,new t}),inheritClass:(e,t,s)=>{const r=t.prototype,n=e.prototype;"object"==typeof t&&(s=t,t.constructor==Object.prototype.constructor&&(t.constructor=function(){e.apply(this,arguments)}),t=t.constructor),t.prototype=v.createObject(n),r&&r!=Object.prototype&&x(t.prototype,r);for(const s in e)t[s]=e[s];return s&&x(t.prototype,s),t},isFunction:e=>"function"==typeof e,isNumeric:e=>!isNaN(+e)&&isFinite(e),isPlainObject:e=>{if(!e||"object"!=typeof e||e.nodeType||e==e.window)return!1;try{if(e.constructor&&!e.hasOwnProperty("constructor")&&!e.constructor.prototype.hasOwnProperty("isPrototypeOf"))return!1}catch(e){return!1}let t;for(t in e);return undefined===t||e.hasOwnProperty(t)},String:{round:(e,t)=>t?Number(e.toFixed(t)):Math.round(e),random:e=>{e=e||16;let t="";const s="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz";for(let r=0;r<e;r++)t+=s.charAt(62*Math.random()^0);return t}}},E=Math.PI/180,M=180/Math.PI,_=6371e3;let k;const w=(e,t)=>{const s=E*(t[1]-e[1]),r=E*(t[0]-e[0]),n=Math.sin(s/2)*Math.sin(s/2)+Math.cos(E*e[1])*Math.cos(E*t[1])*Math.sin(r/2)*Math.sin(r/2),i=2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n));let o=_*i;if(e[2]!=k&&t[2]!=k){const s=e[2]-t[2];o=Math.sqrt(o*o+s*s)}return o};var O={calcBearing:(e,t)=>{const s=e[1]*E,r=t[1]*E,n=(t[0]-e[0])*E,i=Math.sin(n)*Math.cos(r),o=Math.cos(s)*Math.sin(r)-Math.sin(s)*Math.cos(r)*Math.cos(n);return(Math.atan2(i,o)*M+360)%360},movePoint:(e,t,s,r)=>{const n=t/(r=r===k?_:r),i=s*E,o=e[1]*E,a=e[0]*E,l=Math.asin(Math.sin(o)*Math.cos(n)+Math.cos(o)*Math.sin(n)*Math.cos(i));let h=a+Math.atan2(Math.sin(i)*Math.sin(n)*Math.cos(o),Math.cos(n)-Math.sin(o)*Math.sin(l));return h=(h+3*Math.PI)%(2*Math.PI)-Math.PI,[h*M,l*M]},getPointBBox:(e,t)=>{const s=e[1],r=e[0],n=Math.asin(t/(_*Math.cos(Math.PI*s/180)))*M,i=Math.asin(t/_)*M;return[r-n,s-i,r+n,s+i]},mergeBBoxes:(e,t)=>(e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[2]&&(e[2]=t[2]),e[3]<t[3]&&(e[3]=t[3]),e),extendBBox:(e,t)=>{const s=Math.abs(Math.asin(t/(_*Math.cos(e[0]*E))))*M,r=Math.abs(Math.asin(t/(_*Math.cos(e[2]*E))))*M,n=Math.abs(Math.asin(t/_))*M;return[e[0]-s,e[1]-n,e[2]+r,e[3]+n]},distance:w};const j=(e,t,s)=>(e[0]=t[0]-s[0],e[1]=t[1]-s[1],e[2]=t[2]-s[2],e),S=(e,t,s)=>(e[0]=t[0]+s[0],e[1]=t[1]+s[1],e[2]=t[2]+s[2],e),N=(e,t,s)=>(e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e),P=(e,t)=>e[0]*t[0]+e[1]*t[1]+e[2]*t[2];var A=Object.freeze({__proto__:null,add:S,cross:(e,t,s)=>{const r=t[0],n=t[1],i=t[2],o=s[0],a=s[1],l=s[2];return e[0]=n*l-i*a,e[1]=i*o-r*l,e[2]=r*a-n*o,e},dot:P,length:e=>{const[t,s,r]=e;return Math.sqrt(t*t+s*s+r*r)},multiply:(e,t,s)=>(e[0]=t[0]*s[0],e[1]=t[1]*s[1],e[2]=t[2]*s[2],e),normalize:(e,t)=>{const s=t[0],r=t[1],n=t[2];let i=s*s+r*r+n*n;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e},scale:N,sub:j,transform:(e,t,s)=>{const r=t[0],n=t[1],i=t[2]||0;let o=s[3]*r+s[7]*n+s[11]*i+s[15];return o||(o=1),e[0]=(s[0]*r+s[4]*n+s[8]*i+s[12])/o,e[1]=(s[1]*r+s[5]*n+s[9]*i+s[13])/o,e[2]=(s[2]*r+s[6]*n+s[10]*i+s[14])/o,e}});const C={centroid(e){const t=e[0],s=t[0][0],r=t[0][1];let n,i,o=0,a=0,l=0;for(let e,h,c,u=0,{length:p}=t,d=p-1;u<p;d=u,u++)n=t[u][0]-s,i=t[u][1]-r,e=t[d][0]-s,h=t[d][1]-r,c=i*e-h*n,a+=(n+e)*c,l+=(i+h)*c,o+=c;return o*=3,o?[a/o+s,l/o+r]:[n,i]},findPointOnLineString(e,t,s=!1){var r,n,i;t=[t[0],t[1],s?0:null!==(r=t[2])&&void 0!==r?r:0];let o,a=1/0,l=null;for(let r=1,h=0,c=[0,0,0],u=[0,0,0],p=e.length;r<p;h=r++){c[0]=e[h][0],c[1]=e[h][1],u[0]=e[r][0],u[1]=e[r][1],s?(c[2]=0,u[2]=0):(c[2]=null!==(n=e[h][2])&&void 0!==n?n:0,u[2]=null!==(i=e[r][2])&&void 0!==i?i:0);const p=C.getClosestPntOnLine(c,u,t,!0),d=w(p,t);d<a&&(o=p,a=d,l=h)}return{point:o,segment:l}},getClosestPntOnLine(e,t,s,r){const n=j([],s,e),i=j([],t,e),o=j([],t,e);let a=P(i,n)/P(i,i);return r&&(a=Math.max(0,Math.min(1,a))),N(o,o,a),S(o,o,e)},intersectBBox:(e,t,s,r,n,i,o,a)=>e<=i&&n<=t&&s<=a&&o<=r};class D{constructor(e){if(this.size=0,this._=[],e)for(var t=0;t<e.length;t++)this.add(e[t])}add(e){const t=!this.has(e);return t&&(this.size=this._.push(e)),t}clear(){this.size=this._.length=0}delete(e){const t=this._.indexOf(e),s=-1!=t;return s&&(this._.splice(t,1),this.size--),s}has(e){return-1!=this._.indexOf(e)}toArray(){return this._.slice(0)}}let T=class{constructor(e){if(this._={},this.size=0,e)for(let t=0;t<e.length;t++)this.set(e[t][0],e[t][1])}clear(){this.size=0,this._={}}delete(e){const t=this.has(e);return t&&(delete this._[e],this.size--),t}get(e){return this._[e]}has(e){return null!=this._[e]}set(e,t){let s=!this.has(e);return s&&(this.size++,this._[e]=t),s}values(){const e=this._,t=[];for(let s in e)t[t.length]=e[s];return t}keys(){const e=this._,t=[];for(let s in e)t[t.length]=s;return t}forEach(e){const t=this._;for(let s in t)e(t[s],s,this)}};class q{constructor(){this.queue=[]}add(e){if("function"==typeof e)return this.queue.push(e)}done(e,t,s){let r=this.queue;for(;r.length;)r.shift()(...arguments)}}class I{constructor(e){this.heap=[],this.compare=e}get(e){return this.heap[e]}find(e){return this.heap.find(e)}findIndex(e){return this.heap.findIndex(e)}includes(e){return this.heap.includes(e)}push(e){this.heap.push(e),this.bubbleUp(this.heap.length-1)}pop(){const{heap:e}=this;if(!e.length)return;const t=e[0],s=e.pop();return e.length&&(e[0]=s,this.sinkDown(0)),t}adjustElement(e){const t=this.heap[e],s=Math.floor((e-1)/2),r=this.heap[s];s>0&&this.compare(t,r)<0?this.bubbleUp(e):this.sinkDown(e)}remove(e){const t=this.heap.findIndex((t=>t===e));if(-1!==t){const e=this.heap.pop();t!==this.heap.length&&(this.heap[t]=e,this.adjustElement(t))}}size(){return this.heap.length}bubbleUp(e){const t=this.heap[e];for(;e>0;){const s=Math.floor((e-1)/2),r=this.heap[s];if(this.compare(t,r)>=0)break;this.heap[s]=t,this.heap[e]=r,e=s}}sinkDown(e){const t=this.heap.length,s=this.heap[e];for(;;){let r=2*e+1,n=2*e+2,i=null;if(r<t){const e=this.heap[r];this.compare(e,s)<0&&(i=r)}if(n<t){const e=this.heap[n];(null===i&&this.compare(e,s)<0||null!==i&&this.compare(e,this.heap[i])<0)&&(i=n)}if(null===i)break;this.heap[e]=this.heap[i],this.heap[i]=s,e=i}}}class z{constructor(e,t,s,r=null,n){this.point=e,this.g=t,this.h=s,this.f=t+s,this.parent=r,this.data=n}}class R{static calculateDistance(e,t){const s=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(s*s+r*r)}static weight(e,t){return R.calculateDistance(e.point,t.point)}static isPointEqual(e,t){const s=R.precision;return(e[0]*s^0)==(t[0]*s^0)&&(e[1]*s^0)==(t[1]*s^0)}static pointKey(e){const t=R.precision,s=e.point;return 1e7*(s[0]*t^0)+(s[1]*t^0)}static reconstructPath(e){const t=[];for(;null!==e;)t.unshift(e),e=e.parent;return t}static findPath(e,t,s,r=R.weight,n=R.pointKey,i=(e,t)=>e.id===t.id){const o=(e,t,s,r=null,i)=>{const o=new z(e,t,s,r,i);return o.id=n(o),o},a=new I(((e,t)=>e.f-t.f)),l=new Map,h=o(t.point,0,1/0,null,t.data);for(h.id,a.push(o(e.point,0,1/0,null,e.data));a.size()>0;){const e=a.pop();if(i(e,h))return this.reconstructPath(e);l.set(e.id,!0);const t=s(e);for(const s of t){const{point:t,data:i}=s,c=n(s);if(l.has(c))continue;const u=e.g+r(e,s),p=r(s,h),d=a.findIndex((e=>R.isPointEqual(e.point,t)));if(-1!=d){const t=a.get(d);if(u>=t.g)continue;t.g=u,t.h=p,t.f=u+p,t.parent=e,t.data=i,a.adjustElement(d)}else{const s=o(t,u,p,e,i);a.push(s)}}}return null}}var B;R.precision=1e5,e.ExpressionMode=void 0,(B=e.ExpressionMode||(e.ExpressionMode={}))[B.static=0]="static",B[B.dynamic=1]="dynamic";let J=0;class L{constructor(e,t){this.json=e,this.env=t}static isExpression(e){return e instanceof L}static isDynamicExpression(e,t){return this.isExpression(e)&&e.dynamic(t)}clone(e){return new this.constructor(e||this.toJSON(),this.env)}dynamic(e,t=1,s=1,r){const n=[this.json[0]];let i=!1,o=!1;for(let a=t,{json:l}=this,h=r||l.length;a<h;a+=s){let t=this.compileOperand(a);if(L.isExpression(t)){let s=t.dynamic(e);if(s){o=this,s!=t&&(i=!0,t=s)}}n[a]=t}return i?this.clone(n):o}compileOperand(e){return this.json[e]=this.env.parseJSON(this.json[e])}operand(e,t){return this.env.evaluateParsed(this.compileOperand(e),t)}toJSON(){return this.json.map((e=>L.isExpression(e)?e.toJSON():e))}resolve(e,t){const{env:s}=this;let r;return void 0===e&&(e=s.context,r=s.dynamicResultCache),s.evaluate(this,e,t,r)}id(){return this._id||(this._id=++J)}}const F=L;class U extends F{eval(e){const{json:t}=this;let s=0;for(let r=1,{length:n}=t;r<n;r++){let t=this.operand(r,e);s+=Number(t)||0}return s}}U.operator="+";class $ extends F{eval(e){let t=this.operand(1,e),s=this.operand(2,e);return Number(t)-Number(s)}}$.operator="-";class K extends F{eval(e){let t=this.operand(1,e),s=this.operand(2,e);return Number(t)*Number(s)}}K.operator="*";class H extends F{eval(e){let t=this.operand(1,e),s=this.operand(2,e);return Number(t)/Number(s)}}H.operator="/";class W extends F{eval(e){let t=this.operand(1,e),s=this.operand(2,e);return Number(t)%Number(s)}}W.operator="%";class G extends Error{constructor(e){super(e),Object.setPrototypeOf(this,G.prototype),this.name=this.constructor.name}}class Q extends L{eval(e){const t=this.operand(1,e);if("number"!=typeof t)throw new G("invalid operand type "+this.json);return Math.floor(t)}}Q.operator="floor";class Z extends L{eval(e){const{json:t}=this;let s=1/0;for(let r=1,{length:n}=t;r<n;r++){let t=this.operand(r,e);t<s&&(s=t)}return s}}Z.operator="min";class V extends L{eval(e){const{json:t}=this;let s=-1/0;for(let r=1,{length:n}=t;r<n;r++){let t=this.operand(r,e);t>s&&(s=t)}return s}}V.operator="max";class X extends L{eval(e){const{json:t}=this;for(let s=1,{length:r}=t;s<r;s++)if(!Boolean(this.operand(s,e)))return!1;return!0}}X.operator="all";class Y extends L{eval(e){const{json:t}=this;for(let s=1,{length:r}=t;s<r;s++)if(Boolean(this.operand(s,e)))return!0;return!1}}Y.operator="any";class ee extends L{eval(e){return!this.operand(1,e)}}ee.operator="!";class te extends L{eval(e){var t;const{json:s}=this,r=s[1];let n=this.operand(2,e);return!(null===(t=null!=n?n:e)||void 0===t?void 0:t.hasOwnProperty(r))}}te.operator="!has";class se extends te{}se.operator="!has";class re extends L{dynamic(e){return!1}eval(e){var t;const{json:s}=this,r=s[1];let n=this.operand(2,e);return(null===(t=null!=n?n:e)||void 0===t?void 0:t.hasOwnProperty(r))||!1}}re.operator="has";class ne extends L{eval(e){const{json:t}=this;for(let s=1,{length:r}=t;s<r;s++){if(this.operand(1,e))return!1}return!0}}ne.operator="none";const ie=L;class oe extends ie{eval(e){return this.operand(1,e)==this.operand(2,e)}}oe.operator="==";class ae extends ie{eval(e){return this.operand(1,e)!=this.operand(2,e)}}ae.operator="!=";class le extends ie{eval(e){return this.operand(1,e)>this.operand(2,e)}}le.operator=">";class he extends ie{eval(e){return this.operand(1,e)>=this.operand(2,e)}}he.operator=">=";class ce extends ie{eval(e){return this.operand(1,e)<=this.operand(2,e)}}ce.operator="<=";class ue extends ie{eval(e){return this.operand(1,e)<this.operand(2,e)}}ue.operator="<";class pe extends L{eval(e){let t=this.operand(1,e),s=this.operand(2,e);return"string"==typeof t&&"string"==typeof s&&t.startsWith(s)}}pe.operator="^=";class de extends L{eval(e){let t=this.operand(1,e),s=this.operand(2,e);return"string"==typeof t&&"string"==typeof s&&t.endsWith(s)}}de.operator="$=";class fe extends L{eval(e){let t=this.operand(1,e),s=this.operand(2,e);return t.split(s)}}fe.operator="split";class ge extends L{eval(e){let t=this.operand(1,e);return String(t)}}ge.operator="to-string";class ye extends L{eval(e){const{json:t}=this;let s="";for(let r=1,n=t.length;r<n;r++)s+=String(this.operand(r,e));return s}}ye.operator="concat";class me extends L{eval(e){let t=this.operand(1,e);if("string"!=typeof t)return t;let s=this.operand(2,e);if("string"!=typeof s)return t;let r=this.operand(3,e);return"string"!=typeof r?t:t.replace(new RegExp(s,"g"),r)}}me.operator="regex-replace";class xe extends L{eval(e){const t=this.operand(1,e),s=this.operand(2,e),r=this.operand(3,e);return t.slice(s,r)}}xe.operator="slice";class be extends L{eval(e){const t=this.operand(1,e);return this.operand(2,e)[t]}}be.operator="at";class ve extends L{eval(e){return this.operand(1,e).length}}ve.operator="length";class Ee extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Ee.prototype),this.name=this.constructor.name}}class Me extends L{constructor(e,t){if(e.length<4)throw new Ee("invalid arguments");if(e.length%2)throw new Ee("missing fallback");super(e,t)}dynamic(e){this.start=1;const t=["case"];let s=!1,r=!1;for(let n=1,{json:i}=this,o=i.length;n<o;n++){let i,a=this.compileOperand(n),l=n==o-1;if(Boolean(n%2)&&!l){if(i=this.operand(n,e),!i){n++,r=!0;continue}{let t=L.isDynamicExpression(a,e);if(!t&&!s)return L.isDynamicExpression(this.compileOperand(n+1),e)||this.operand(n+1,e);s||(s=t)}}else if(i=L.isDynamicExpression(a,e)||this.operand(n,e),l&&1==t.length)return i;a!=i&&(r=!0),t.push(i)}return r?this.clone(t):this}eval(e){const{json:t}=this;let s=t.length-1;for(let t=this.start||1;t<s;t+=2){if(this.operand(t,e))return this.operand(t+1,e)}return this.operand(s,e)}}Me.operator="case";class _e extends L{eval(e){let t=this.operand(1,e),s=this.operand(2,e);if(t<this.operand(3,e))return s;const{json:r}=this;for(let e=r.length-2;e>2;e-=2)if(t>=r[e])return r[e+1]}}_e.operator="step";class ke extends L{dynamic(e){for(let t=1,s=this.json.length-2;t<s;t+=2)if(L.isDynamicExpression(this.compileOperand(t),e))return this;return!!L.isDynamicExpression(this.compileOperand(this.json.length-1),e)&&this}eval(e){const{json:t}=this,s=this.operand(1,e),r=t.length-2;for(let n=2;n<r;n+=2){let r=t[n];Array.isArray(r)||(r=[r]);for(let t of r)if(t==s)return this.operand(n+1,e)}return this.operand(t.length-1,e)}}ke.operator="match";class we extends L{dynamic(e){return!1}eval(e){return this.json[1]}}we.operator="literal";class Oe extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Oe.prototype),this.name=this.constructor.name}}class je extends L{getLookupTable(e){let t=je._lookupTableCache.get(e);if(t&&!Array.isArray(t))return t;t=new Map;for(const s of e){if(!(null==s?void 0:s.keys)||!(null==s?void 0:s.attributes))throw new Oe("invalid lookup table");const e=Object.getOwnPropertyNames(s.keys).sort();for(let t=0,r=e.length;t<r;t++){const r=e[t];e[t]=`${r}=${s.keys[r]}`}t.set(e.join(";"),s.attributes)}return je._lookupTableCache.set(e,t),t}getCombinations(e){const t=e.length,s=[];for(let r=0;r<1<<t;r++){const n=[];for(let s=0;s<t;s++)r&1<<s&&n.push(e[s]);s.push(n)}return s}getLookupMapSearchKeys(e){let t=[];for(let s=0,r=e.length;s<r;s+=2)t.push(e[s]+"="+e[s+1]);const s=t.join(";");let r=je._lookupSearchKeyCache.get(s);if(!r){t.sort(),r=this.getCombinations(t).sort(((e,t)=>t.length-e.length));for(let e=0,t=r.length;e<t;e++)r[e]=r[e].join(";");je._lookupSearchKeyCache.set(s,r)}return r}eval(e){const{json:t}=this;let s=this.operand(1,e);const r=[];for(let s=2;s<t.length;s++)r.push(this.operand(s,e));let n=this.getLookupTable(s),i=this.getLookupMapSearchKeys(r);for(let e of i){let t=n.get(e);if(t)return t}return null}}je.operator="lookup",je._lookupSearchKeyCache=new Map,je._lookupTableCache=new Map;class Se extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Se.prototype),this.name=this.constructor.name}}class Ne extends L{eval(e){const{json:t}=this,s=t[0];for(let r=1,n=t.length;r<n;r++){let t=this.operand(r,e);if(typeof t==s)return t}throw new Se("expected type: "+s)}}class Pe extends Ne{}Pe.operator="number";class Ae extends Ne{}Ae.operator="boolean";class Ce extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Ce.prototype),this.name=this.constructor.name}}class De extends L{eval(e){const{json:t}=this;for(let s=1;s<t.length;s++){let t=this.operand(s,e);if(t=Number(t),!isNaN(t))return t}throw new Ce("convert error: "+t)}}De.operator="to-number";class Te extends L{eval(e){let t=this.operand(1,e);return Boolean(t)}}Te.operator="to-boolean";class qe extends L{dynamic(e){return!1}eval(e){return this.env.evaluate(this.env.resolveReference(this.json),e,this.env.getMode())}}qe.operator="ref";class Ie extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Ie.prototype),this.name=this.constructor.name}}class ze extends L{constructor(e,t){if("string"!=typeof e[1])throw new Ie("Name parameter must be of type string");super(e,t)}dynamic(e){return!1}eval(e){this.json[2]&&(e=this.operand(2,e));const t=this.json[1];let s=null==e?void 0:e[t];return void 0===s&&(s=this.env.context[t]),null!=s?s:null}}ze.operator="get";var Re=Object.freeze({__proto__:null,AllExpression:X,AnyExpression:Y,AtArrayExpression:be,BooleanExpression:Ae,CaseExpression:Me,ConcatExpression:ye,DevideExpression:H,EndsWithExpression:de,EqualsExpression:oe,FloorExpression:Q,GetExpression:ze,GreaterExpression:le,GreaterOrEqualExpression:he,HasExpression:re,HasNotExpression:te,LengthExpression:ve,LiteralExpression:we,LookupExpression:je,MatchExpression:ke,MaxExpression:V,MinExpression:Z,ModulusExpression:W,MultiplyExpression:K,NoneExpression:ne,NotEqualsExpression:ae,NotInExpression:se,NumberExpression:Pe,ReferenceExpression:qe,RegexReplaceExpression:me,SliceExpression:xe,SmallerExpression:ue,SmallerOrEqualExpression:ce,SplitExpression:fe,StartsWithExpression:pe,StepExpression:_e,SubtractExpression:$,SumExpression:U,ToBooleanExpression:Te,ToNumberExpression:De,ToStringExpression:ge,isFalseExpression:ee});e.Color=void 0,function(e){const t={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgrey:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",grey:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"778899",lightslategrey:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"},s=e=>{const t=e.length;return t<5?[parseInt(e.charAt(0),16)/15,parseInt(e.charAt(1),16)/15,parseInt(e.charAt(2),16)/15,4==t?parseInt(e.charAt(3),16)/15:1]:r(parseInt(e,16),8==t)},r=(e,t)=>t?[(e>>24&255)/255,(e>>16&255)/255,(e>>8&255)/255,(255&e)/255]:[(e>>16&255)/255,(e>>8&255)/255,(255&e)/255,1];for(let e in t)t[e]=s(t[e]);e.toRGB=(e,n)=>{let i;return e&&(Array.isArray(e)?(i=e,3==i.length&&(i[3]=1)):"number"==typeof e?n||(i=r(e)):"#"==e[0]?i=s(e.slice(1)):/^([A-Fa-f\d]+)$/.test(e)?i=s(e):e.startsWith("rgb")?i=(e=>{const t=e.match(/^rgba?\s*\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d*(?:\.\d+)?))?\)$/);return(null==t?void 0:t.length)>3&&[t[1]/255,t[2]/255,t[3]/255,null==t[4]?1:Number(t[4])]})(e):(i=t[e],i=i&&[i[0],i[1],i[2],i[3]])),i||null},e.rgbaToHexString=e=>{const[t,s,r,n=1]=e,i=e=>Math.round(255*e).toString(16).padStart(2,"0"),o=`#${i(t)}${i(s)}${i(r)}`;return n<1?`${o}${i(n)}`:o}}(e.Color||(e.Color={}));var Be=e.Color.toRGB;class Je extends L{dynamic(){return this}eval(e){return this.env.context.zoom}}Je.operator="zoom";const Le=(e,t,s)=>e+(t-e)*s;class Fe extends L{dynamic(e){return super.dynamic(e,2,2)}eval(e){var t;const{json:s}=this,r=null===(t=s[1])||void 0===t?void 0:t[0],n=Fe.supported[r];if(!n)return;const i=this.operand(2,e);let o,a,l,h,c,u=3,p=s.length;for(;u<p;u+=2){if(h=this.operand(u,e),h>i){a=this.operand(u+1,e);break}l=h}if(3==u)return a;if(u==p)return this.operand(p-1,e);if(o=this.operand(u-1,e),"linear"==r)c=(i-l)/(h-l);else if("exponential"==r){const e=s[1][1];c=1==e?(i-l)/(h-l):(Math.pow(e,i-l)-1)/(Math.pow(e,h-l)-1)}let d=Be(o,!0);return null!=d?"number"==typeof c?(a=Be(a,!0),[n(d[0],a[0],c),n(d[1],a[1],c),n(d[2],a[2],c),n(d[3],a[3],c)]):d:n(o,a,c)}}Fe.operator="interpolate",Fe.supported={linear:Le,discrete:e=>e,exponential:Le};var Ue,$e=Object.freeze({__proto__:null,InterpolateExpression:Fe,ZoomExpression:Je});class Ke{constructor(t={},s={}){this.cache=new Map,this.defaultResultCache=new Map,this.dynamicResultCache=new Map,this.definitions=t,this.context=s,this.setMode(e.ExpressionMode.static),this.defaultResultCache.hits=0,this.dynamicResultCache.hits=0,this.cache.hits=0}static isJSONExp(e){return Array.isArray(e)&&"string"==typeof e[0]}static isSupported(e){return null!=this.Expressions[e]}init(e,t){this.clearCache(),this.setDefinitions(e),this.context=t}setDefinitions(e){this.definitions=e}clearCache(){this.cache.hits=0,this.cache.clear()}evaluate(t,s,r=e.ExpressionMode.static,n){let i;t=this.parseJSON(t);try{this.setMode(r,n),i=this.evaluateParsed(t,s)}catch(e){throw e}return i}evaluateParsed(e,t){if(e instanceof L){if(this.getMode()===Ke.Mode.dynamic){let s=e.dynamic(t);if(s)return s}let s=this.resultCache.get(e);return void 0!==s?(this.resultCache.hits++,s):(s=e.eval(t),this.resultCache.set(e,s),s)}return e}resolveReference(e,t=this.definitions){let s=t[null==e?void 0:e[1]];if(null!=s)for(null!=s.value&&(s=s.value);Ke.isJSONExp(s)&&"ref"==s[0];)s=t[s[1]],void 0!==s.value&&(s=s.value);return s}parseJSON(e,t){if(!Ke.isJSONExp(e))return e;let[s]=e;const r="ref"==s,n=r?e[1]:e;let i=this.cache.get(n);if(null!=i)return this.cache.hits++,i;if(r){if(i=this.resolveReference(e),!Ke.isJSONExp(i))return this.cache.set(n,i),i;e=i,[s]=i}const o=Ke.Expressions[s];if(o)return i=new o(e,this),this.cache.set(n,i),i;if(!1!==t)throw new Error(`Expression ${s} unsupported`)}createExpression(e){const t=Ke.Expressions[e[0]];return t&&new t(e,this)}clearResultCache(){this.defaultResultCache.clear()}clearDynamicResultCache(){this.dynamicResultCache.clear()}isSupported(e){return Boolean(Ke.Expressions[e[0]])}setMode(e,t){this._mode=e,this.context.mode=e,this.resultCache=t||this.defaultResultCache}getMode(){return this._mode}}Ue=Ke,Ke.Mode=e.ExpressionMode,(()=>{let e={};for(let t of[...Object.values(Re),...Object.values($e)])e[t.operator]=t;Ue.Expressions=e})();let He=t;"here.xyz.maps".split(".").forEach((e=>He=He[e]=He[e]||{})),t.HERE=t.here;const We={AStar:R,BinaryHeap:I,Color:e.Color,Expression:L,ExpressionMode:e.ExpressionMode,ExpressionParser:Ke,LRU:f,TaskManager:l,Task:r,TaskSequence:h,Listener:p,parseJSONArray:y,JSUtils:v,geotools:O,global:t,Queue:q,Set:D,Map:T,vec3:A,geometry:C};He.common=We,e.AStar=R,e.BinaryHeap=I,e.Expression=L,e.ExpressionParser=Ke,e.JSUtils=v,e.LRU=f,e.Listener=p,e.Map=T,e.Queue=q,e.Set=D,e.Task=r,e.TaskManager=l,e.TaskSequence=h,e.default=We,e.geometry=C,e.geotools=O,e.global=t,e.parseJSONArray=y,e.vec3=A,Object.defineProperty(e,"__esModule",{value:!0})}));
