/*
 * @here/xyz-maps-core
 * (c) 2019-2022 HERE
 */

(function (global, factory) {
	typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
	typeof define === 'function' && define.amd ? define(factory) :
	(global = typeof globalThis !== 'undefined' ? globalThis : global || self, (global.here = global.here || {}, global.here.xyz = global.here.xyz || {}, global.here.xyz.maps = factory()));
})(this, (function () { 'use strict';

	let shared;
	let worker;
	function define(dep, factory) {
	    if (!shared) {
	        shared = factory;
	    } else if (!worker) {
	        worker = factory;
	    } else {
	        const xyz = here.xyz.maps;
	        const sharedExports = {};
	        shared(sharedExports);
	        xyz.__workerURL = URL.createObjectURL(new Blob(['var shared={};('+shared+')(shared);('+worker+')(shared);'], {type: 'text/javascript'}));
	        factory(xyz, sharedExports, xyz.common);
	    }
	}


	define(["exports"],(function(t){"use strict";class e{constructor(t,e){this.x=t,this.y=e;}}class r{constructor(t,e,r){this.longitude=t,this.latitude=e,r&&(this.altitude=r);}}class i{constructor(t,e=!1){this.bO=0,this.contains32BitData=!1,"number"==typeof t&&(t=new ArrayBuffer(t)),this.dV=new DataView(t),this.aB=t,this.contains32BitData=e;}static get BYTES_LAYER(){return this.BYTES_LAYER_INDEX+this.BYTES_LAYER_LENGTH}static fromLayers(t){let e=0,r=!1;for(let s of t)s.features.length&&(s.length=s.features.reduce(((t,e)=>{const{requires32Bit:s}=e;r||(r=s);let n=e.data.length*(s?4:2)+i.BYTES_TRIANGLES_LENGTH+i.BYTES_FEATURE_METADATA;return n%4&&(n+=2),t+n}),0),e+=s.length+i.BYTES_LAYER);const s=new i(e,r);return s.setLayers(t),s}setLayers(t){for(let e of t){let{index:t,length:r,features:i}=e;if(r){this.setLayer(t,r);for(let t of i)this.setFeature(t.index,t.data,t.requires32Bit);}}}setLayer(t,e){const r=this.dV;r.setUint16(this.bO,Number(t)),this.bO+=i.BYTES_LAYER_INDEX,r.setUint32(this.bO,e),this.bO+=i.BYTES_LAYER_LENGTH;}setFeatureMetaData(t,e){this.dV.setUint32(this.bO,t<<1|e),this.bO+=i.BYTES_FEATURE_METADATA;}setFeatureData(t,e){const r=t.length;this.dV.setUint32(this.bO,r),this.bO+=i.BYTES_TRIANGLES_LENGTH;new(e?Uint32Array:Uint16Array)(this.aB,this.bO,r).set(t);let s=2*(e+1)*r;this.bO+=s,this.bO%4&&(this.bO+=2);}setFeature(t,e,r){const i=Number(r);this.setFeatureMetaData(t,i),this.setFeatureData(e,i);}getLayers(){const t=this.dV;let e=t.byteLength,r=0;const s={};for(;r<e;){let e=t.getUint16(r);r+=i.BYTES_LAYER_INDEX;let n=t.getUint32(r);r+=i.BYTES_LAYER_LENGTH,s[e]={offset:r,length:n,features:null},r+=n;}return s}getFeatures(t){const e={},r=this.dV,s=this.aB;let n=t.offset,o=n+t.length;for(;n<o;){const t=r.getUint32(n),o=t>>1,a=1&t;n+=i.BYTES_FEATURE_METADATA;let h=r.getUint32(n);n+=i.BYTES_TRIANGLES_LENGTH;const u=a?Uint32Array:Uint16Array;e[o]=new u(s,n,h),n+=h*(a+1)*2,n%4&&(n+=2);}return e}getBuffer(){return this.aB}}i.BYTES_LAYER_INDEX=4,i.BYTES_LAYER_LENGTH=4,i.BYTES_FEATURE_METADATA=4,i.BYTES_TRIANGLES_LENGTH=4;class s{constructor(t){this.withCredentials=!1,this.responseType="";for(const e in t)this[e]=t[e];}send(t){const e=t.success,r=t.error,i=t.responseType||this.responseType,s=t.headers,n=new XMLHttpRequest,o=t.withCredentials;if(n.withCredentials=null!=o?o:this.withCredentials,n.responseType="json"==i?"text":i,n.onload=function(){const t=this.responseType;let r,s;""==t||"text"==t?(r=this.responseText,s=r.length,"json"==i&&204!=this.status&&(r=JSON.parse(r))):(r=this.response,s=r.byteLength),this.status>=200&&this.status<=226&&e(r,s);},n.onreadystatechange=function(){4==this.readyState&&(this.status<200||this.status>=300)&&(this.onload=null,0!==this.status&&r&&r(this));},n.open(t.type||"GET",t.url,!0),s)for(const t in s)n.setRequestHeader(t,s[t]);return n.send(t.data||null),n}}const n={},o=/{([xX]|(COL))}/,a=/{([yY]|(ROW))}/,h=/{([zZ]|(LEVEL))}/,u=/{((qk)|(QK)|(quadkey)|(QUADKEY))}/,l=/{SUBDOMAIN_INT_1_4}/,c=/{SUBDOMAIN_INT}/,d=/{SUBDOMAIN_CHAR}/;class f extends Error{constructor(t){super("Service request failed with HTTP status: '"+t.status+" "+t.statusText+"'"),this.name="NetworkError";const e=this,{responseType:r}=t;e.statusCode=t.status,""!=r&&"text"!=r||(e.responseText=t.responseText||null);}}class p{constructor(t){this.withCredentials=!1,this.headers=null,this.store=null,this.baseUrl=null,this.q={};let e=t.responseType||"json";const r=t.src||t.url,i=!!t.withCredentials;this.withCredentials=i,this.baseUrl=r,this.headers=Object.assign(Object.assign({},n),t.headers||{}),"function"==typeof r&&(this.getUrl=t=>r(t.z,t.y,t.x,t.quadkey)),this.http=new s({responseType:e,withCredentials:i}),this.responseType=e;}static async createImageFromBlob(t,e){createImageBitmap(t).then((t=>{null==e||e(t);}));}getUrl(t){const e=4*Math.random()^0;return this.baseUrl.replace(l,e+1).replace(c,e).replace(d,"abcd"[e]).replace(u,t.quadkey).replace(h,t.z).replace(o,t.x).replace(a,t.y)}setUrl(t){this.baseUrl=t;}load(t,e,r){const i=this.getUrl(t),s=t.quadkey,n=this.q,o={id:s,url:i,success:e,error:r};let a;const h=this.responseType||t.type;"image"==h?(o.responseType="blob",o.success=t=>{n[s]=a,p.createImageFromBlob(t,(t=>{delete n[s],a._aborted||e(t);}));}):("json"==h&&(o.success=(t,r)=>{e("FeatureCollection"==t.type?t.features:t,r);}),o.headers=this.headers),a=this.send(o);}abort(t){var e;const r=this.q,i=t.quadkey,s=r[i];s&&(s.onload=null,s._aborted=!0,null===(e=s.abort)||void 0===e||e.call(s),delete r[i]);}send(t){const e=t.id||t.key||Math.random(),r=this.q,i=t.success,s=t;s.success=(t,s)=>{delete r[e],i(t,s);};const n=t.error;return s.error=t=>{delete r[e],n&&n(new f(t),t);},r[e]=this.http.send(s)}}var g={read:function(t,e,r,i,s){var n,o,a=8*s-i-1,h=(1<<a)-1,u=h>>1,l=-7,c=r?s-1:0,d=r?-1:1,f=t[e+c];for(c+=d,n=f&(1<<-l)-1,f>>=-l,l+=a;l>0;n=256*n+t[e+c],c+=d,l-=8);for(o=n&(1<<-l)-1,n>>=-l,l+=i;l>0;o=256*o+t[e+c],c+=d,l-=8);if(0===n)n=1-u;else {if(n===h)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,i),n-=u;}return (f?-1:1)*o*Math.pow(2,n-i)},write:function(t,e,r,i,s,n){var o,a,h,u=8*n-s-1,l=(1<<u)-1,c=l>>1,d=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,f=i?0:n-1,p=i?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=l):(o=Math.floor(Math.log(e)/Math.LN2),e*(h=Math.pow(2,-o))<1&&(o--,h*=2),(e+=o+c>=1?d/h:d*Math.pow(2,1-c))*h>=2&&(o++,h/=2),o+c>=l?(a=0,o=l):o+c>=1?(a=(e*h-1)*Math.pow(2,s),o+=c):(a=e*Math.pow(2,c-1)*Math.pow(2,s),o=0));s>=8;t[r+f]=255&a,f+=p,a/=256,s-=8);for(o=o<<s|a,u+=s;u>0;t[r+f]=255&o,f+=p,o/=256,u-=8);t[r+f-p]|=128*g;}},y=w,x=g;function w(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length;}w.Varint=0,w.Fixed64=1,w.Bytes=2,w.Fixed32=5;var M=4294967296,T=1/M,v="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function b(t){return t.type===w.Bytes?t.readVarint()+t.pos:t.pos+1}function m(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function F(t,e,r){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(i);for(var s=r.pos-1;s>=t;s--)r.buf[s+i]=r.buf[s];}function E(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r]);}function S(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r]);}function _(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r]);}function B(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r]);}function V(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r]);}function A(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r]);}function k(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r]);}function I(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r]);}function N(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r]);}function L(t,e){return (t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function U(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24;}function P(t,e){return (t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}w.prototype={destroy:function(){this.buf=null;},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var i=this.readVarint(),s=i>>3,n=this.pos;this.type=7&i,t(s,e,this),this.pos===n&&this.skip(i);}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=L(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=P(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=L(this.buf,this.pos)+L(this.buf,this.pos+4)*M;return this.pos+=8,t},readSFixed64:function(){var t=L(this.buf,this.pos)+P(this.buf,this.pos+4)*M;return this.pos+=8,t},readFloat:function(){var t=x.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=x.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,i=this.buf;return e=127&(r=i[this.pos++]),r<128?e:(e|=(127&(r=i[this.pos++]))<<7,r<128?e:(e|=(127&(r=i[this.pos++]))<<14,r<128?e:(e|=(127&(r=i[this.pos++]))<<21,r<128?e:function(t,e,r){var i,s,n=r.buf;if(s=n[r.pos++],i=(112&s)>>4,s<128)return m(t,i,e);if(s=n[r.pos++],i|=(127&s)<<3,s<128)return m(t,i,e);if(s=n[r.pos++],i|=(127&s)<<10,s<128)return m(t,i,e);if(s=n[r.pos++],i|=(127&s)<<17,s<128)return m(t,i,e);if(s=n[r.pos++],i|=(127&s)<<24,s<128)return m(t,i,e);if(s=n[r.pos++],i|=(1&s)<<31,s<128)return m(t,i,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=i[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&v?function(t,e,r){return v.decode(t.subarray(e,r))}(this.buf,e,t):function(t,e,r){var i="",s=e;for(;s<r;){var n,o,a,h=t[s],u=null,l=h>239?4:h>223?3:h>191?2:1;if(s+l>r)break;1===l?h<128&&(u=h):2===l?128==(192&(n=t[s+1]))&&(u=(31&h)<<6|63&n)<=127&&(u=null):3===l?(n=t[s+1],o=t[s+2],128==(192&n)&&128==(192&o)&&((u=(15&h)<<12|(63&n)<<6|63&o)<=2047||u>=55296&&u<=57343)&&(u=null)):4===l&&(n=t[s+1],o=t[s+2],a=t[s+3],128==(192&n)&&128==(192&o)&&128==(192&a)&&((u=(15&h)<<18|(63&n)<<12|(63&o)<<6|63&a)<=65535||u>=1114112)&&(u=null)),null===u?(u=65533,l=1):u>65535&&(u-=65536,i+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),i+=String.fromCharCode(u),s+=l;}return i}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==w.Bytes)return t.push(this.readVarint(e));var r=b(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==w.Bytes)return t.push(this.readSVarint());var e=b(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==w.Bytes)return t.push(this.readBoolean());var e=b(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==w.Bytes)return t.push(this.readFloat());var e=b(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==w.Bytes)return t.push(this.readDouble());var e=b(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==w.Bytes)return t.push(this.readFixed32());var e=b(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==w.Bytes)return t.push(this.readSFixed32());var e=b(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==w.Bytes)return t.push(this.readFixed64());var e=b(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==w.Bytes)return t.push(this.readSFixed64());var e=b(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===w.Varint)for(;this.buf[this.pos++]>127;);else if(e===w.Bytes)this.pos=this.readVarint()+this.pos;else if(e===w.Fixed32)this.pos+=4;else {if(e!==w.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8;}},writeTag:function(t,e){this.writeVarint(t<<3|e);},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e;}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),U(this.buf,t,this.pos),this.pos+=4;},writeSFixed32:function(t){this.realloc(4),U(this.buf,t,this.pos),this.pos+=4;},writeFixed64:function(t){this.realloc(8),U(this.buf,-1&t,this.pos),U(this.buf,Math.floor(t*T),this.pos+4),this.pos+=8;},writeSFixed64:function(t){this.realloc(8),U(this.buf,-1&t,this.pos),U(this.buf,Math.floor(t*T),this.pos+4),this.pos+=8;},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var r,i;t>=0?(r=t%4294967296|0,i=t/4294967296|0):(i=~(-t/4294967296),4294967295^(r=~(-t%4294967296))?r=r+1|0:(r=0,i=i+1|0));if(t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,r){r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos]=127&t;}(r,0,e),function(t,e){var r=(7&t)<<4;if(e.buf[e.pos++]|=r|((t>>>=3)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;e.buf[e.pos++]=127&t;}(i,e);}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))));},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t);},writeBoolean:function(t){this.writeVarint(Boolean(t));},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,r){for(var i,s,n=0;n<e.length;n++){if((i=e.charCodeAt(n))>55295&&i<57344){if(!s){i>56319||n+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):s=i;continue}if(i<56320){t[r++]=239,t[r++]=191,t[r++]=189,s=i;continue}i=s-55296<<10|i-56320|65536,s=null;}else s&&(t[r++]=239,t[r++]=191,t[r++]=189,s=null);i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:(i<65536?t[r++]=i>>12|224:(t[r++]=i>>18|240,t[r++]=i>>12&63|128),t[r++]=i>>6&63|128),t[r++]=63&i|128);}return r}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&F(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r;},writeFloat:function(t){this.realloc(4),x.write(this.buf,t,this.pos,!0,23,4),this.pos+=4;},writeDouble:function(t){this.realloc(8),x.write(this.buf,t,this.pos,!0,52,8),this.pos+=8;},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r];},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var i=this.pos-r;i>=128&&F(r,i,this),this.pos=r-1,this.writeVarint(i),this.pos+=i;},writeMessage:function(t,e,r){this.writeTag(t,w.Bytes),this.writeRawMessage(e,r);},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,E,e);},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,S,e);},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,V,e);},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,_,e);},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,B,e);},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,A,e);},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,k,e);},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,I,e);},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,N,e);},writeBytesField:function(t,e){this.writeTag(t,w.Bytes),this.writeBytes(e);},writeFixed32Field:function(t,e){this.writeTag(t,w.Fixed32),this.writeFixed32(e);},writeSFixed32Field:function(t,e){this.writeTag(t,w.Fixed32),this.writeSFixed32(e);},writeFixed64Field:function(t,e){this.writeTag(t,w.Fixed64),this.writeFixed64(e);},writeSFixed64Field:function(t,e){this.writeTag(t,w.Fixed64),this.writeSFixed64(e);},writeVarintField:function(t,e){this.writeTag(t,w.Varint),this.writeVarint(e);},writeSVarintField:function(t,e){this.writeTag(t,w.Varint),this.writeSVarint(e);},writeStringField:function(t,e){this.writeTag(t,w.Bytes),this.writeString(e);},writeFloatField:function(t,e){this.writeTag(t,w.Fixed32),this.writeFloat(e);},writeDoubleField:function(t,e){this.writeTag(t,w.Fixed64),this.writeDouble(e);},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e));}};var O={},q=G;function G(t,e){this.x=t,this.y=e;}G.prototype={clone:function(){return new G(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,r=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),i=e*this.x-r*this.y,s=r*this.x+e*this.y;return this.x=i,this.y=s,this},_rotateAround:function(t,e){var r=Math.cos(t),i=Math.sin(t),s=e.x+r*(this.x-e.x)-i*(this.y-e.y),n=e.y+i*(this.x-e.x)+r*(this.y-e.y);return this.x=s,this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},G.convert=function(t){return t instanceof G?t:Array.isArray(t)?new G(t[0],t[1]):t};var R=q,Y=H;function H(t,e,r,i,s){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=s,t.readFields(D,this,e);}function D(t,e,r){1==t?e.id=r.readVarint():2==t?function(t,e){var r=t.readVarint()+t.pos;for(;t.pos<r;){var i=e._keys[t.readVarint()],s=e._values[t.readVarint()];e.properties[i]=s;}}(r,e):3==t?e.type=r.readVarint():4==t&&(e._geometry=r.pos);}function z(t){for(var e,r,i=0,s=0,n=t.length,o=n-1;s<n;o=s++)e=t[s],i+=((r=t[o]).x-e.x)*(e.y+r.y);return i}H.types=["Unknown","Point","LineString","Polygon"],H.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,i=1,s=0,n=0,o=0,a=[];t.pos<r;){if(s<=0){var h=t.readVarint();i=7&h,s=h>>3;}if(s--,1===i||2===i)n+=t.readSVarint(),o+=t.readSVarint(),1===i&&(e&&a.push(e),e=[]),e.push(new R(n,o));else {if(7!==i)throw new Error("unknown command "+i);e&&e.push(e[0].clone());}}return e&&a.push(e),a},H.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,i=0,s=0,n=0,o=1/0,a=-1/0,h=1/0,u=-1/0;t.pos<e;){if(i<=0){var l=t.readVarint();r=7&l,i=l>>3;}if(i--,1===r||2===r)(s+=t.readSVarint())<o&&(o=s),s>a&&(a=s),(n+=t.readSVarint())<h&&(h=n),n>u&&(u=n);else if(7!==r)throw new Error("unknown command "+r)}return [o,h,a,u]},H.prototype.toGeoJSON=function(t,e,r){var i,s,n=this.extent*Math.pow(2,r),o=this.extent*t,a=this.extent*e,h=this.loadGeometry(),u=H.types[this.type];function l(t){for(var e=0;e<t.length;e++){var r=t[e],i=180-360*(r.y+a)/n;t[e]=[360*(r.x+o)/n-180,360/Math.PI*Math.atan(Math.exp(i*Math.PI/180))-90];}}switch(this.type){case 1:var c=[];for(i=0;i<h.length;i++)c[i]=h[i][0];l(h=c);break;case 2:for(i=0;i<h.length;i++)l(h[i]);break;case 3:for(h=function(t){var e=t.length;if(e<=1)return [t];for(var r,i,s=[],n=0;n<e;n++){var o=z(t[n]);0!==o&&(void 0===i&&(i=o<0),i===o<0?(r&&s.push(r),r=[t[n]]):r.push(t[n]));}r&&s.push(r);return s}(h),i=0;i<h.length;i++)for(s=0;s<h[i].length;s++)l(h[i][s]);}1===h.length?h=h[0]:u="Multi"+u;var d={type:"Feature",geometry:{type:u,coordinates:h},properties:this.properties};return "id"in this&&(d.id=this.id),d};var C=Y,j=X;function X(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(W,this,e),this.length=this._features.length;}function W(t,e,r){15===t?e.version=r.readVarint():1===t?e.name=r.readString():5===t?e.extent=r.readVarint():2===t?e._features.push(r.pos):3===t?e._keys.push(r.readString()):4===t&&e._values.push(function(t){var e=null,r=t.readVarint()+t.pos;for(;t.pos<r;){var i=t.readVarint()>>3;e=1===i?t.readString():2===i?t.readFloat():3===i?t.readDouble():4===i?t.readVarint64():5===i?t.readVarint():6===i?t.readSVarint():7===i?t.readBoolean():null;}return e}(r));}X.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new C(this._pbf,e,this.extent,this._keys,this._values)};var K=j,Q=function(t,e){this.layers=t.readFields(J,{},e);};function J(t,e,r){if(3===t){var i=new K(r,r.readVarint()+r.pos);i.length&&(e[i.name]=i);}}var Z=O.VectorTile=Q;O.VectorTileFeature=Y,O.VectorTileLayer=j;const $=Math.PI,tt=$/180,et=2*$*(19113026/3),rt=Array.from({length:33},((t,e)=>40075017/256/(1<<e))),it=(t,e)=>(t+180)/360*e,st=(t,e)=>(180-180/$*Math.log(Math.tan($/4+t*$/360)))*e/360,nt=(t,e)=>360*t/e-180,ot=(t,e)=>{const r=180-360*t/e;return 360/$*Math.atan(Math.exp(r*tt))-90},at=(t=0)=>et*Math.cos(t*tt);var ht={mapSizePixel:(t,e)=>Math.pow(2,e)*t,lon2x:it,lat2y:st,x2lon:nt,y2lat:ot,pixelToGeo:(t,e,i)=>new r(nt(t,i),ot(e,i)),geoToPixel:(t,r,i)=>new e(it(t,i),st(r,i)),meterToPixel:(t,e)=>t/rt[e],pixelToMeter:(t,e)=>t*rt[e],getGroundResolution:t=>rt[t],alt2z:(t,e)=>t/at(e),earthCircumference:at};const ut=256,lt=85.05112878,ct=-85.05112878,dt=(t,e,r)=>{const i=1<<r;return [Math.floor(ht.lon2x(t,i)),Math.floor(ht.lat2y(e,i)),r]},ft=t=>{"number"==typeof t&&(t=String(t));const e=t.length;let r=0,i=0;for(let s=0;s<e;++s)switch(r*=2,i*=2,t[s]){case"1":i++;break;case"3":i++;case"2":r++;}return [e,r,i]},pt=(t,e,r)=>{let i,s="";for(;t-- >0;)i=1<<t,s+=!!(r&i)+2*!!(e&i);return s},gt=(t,e,r)=>{const i=ut<<t,s=ut*r,n=ut*e;return [ht.x2lon(s,i),ht.y2lat(n+ut,i),ht.x2lon(s+ut,i),ht.y2lat(n,i)]},yt=(t,e)=>{const r=[t];let i=0,s=r.length,n=t.length;if(e<=n)return [t.substring(0,e)];for(;n<e;){for(;i<s;i++)r.push(r[i]+"0",r[i]+"1",r[i]+"2",r[i]+"3");i=s,s=r.length,n++;}return r.slice(i)},xt=(t,e)=>{const r=[],i=e[1]-t[1]+1,s=e[0]-t[0]+1,n=t[2];for(let e=0;e<i;e++)for(let i=0;i<s;i++)r[r.length]=pt(n,t[1]+e,t[0]+i);return r},wt={geoToGrid:dt,pixelToGrid:(t,e,r)=>[Math.floor(t),Math.floor(e),r],quadToGrid:ft,tileXYToQuadKey:pt,getGeoBounds:gt,getTilesOfLevel:yt,getTilesIds:xt,getTilesInRect:(t,e,r,i,s)=>{r>=180&&(r=179.999999),t<=-180&&(t=-180),i>=lt&&(i=85.05112778),e<ct&&(e=-85.05112778);const n=dt(t,i,s),o=dt(r,e,s);return xt(n,o)}};class Mt{constructor(t){const{responseType:e}=t,r=this.loader=new p({responseType:e});this.customHandlers=new Set,self.addEventListener("message",(t=>{const{msg:e,quadkey:i,url:s,x:n,y:o,z:a}=t.data;switch(e){case"abort":r.abort({quadkey:i});break;case"load":r.baseUrl=s,this.load(n,o,a,i,s);break;default:if(this.customHandlers.has(e)){const r=this[e](t.data.custom);(null==r?void 0:r.data)&&self.postMessage({msg:e,key:t.data.key,data:r.data},r.transfer);}}}));}registerCustomMsgHandler(t){"function"==typeof this[t]&&this.customHandlers.add(t);}load(t,e,r,i,s){const n=this;n.loader.load({quadkey:i},(o=>{const{data:a,transfer:h}=n.process(o,t,e,r);self.postMessage({msg:"success",url:s,key:i,data:a},h);}),(t=>{self.postMessage({msg:"error",url:s,key:i,data:t});}));}process(t,e,r,i){return {data:t,transfer:[t]}}}class Tt{constructor(){this.transfer=new Set;}add(t){const e=null==t?void 0:t.buffer;if(e)this.transfer.add(e);else if(!Array.isArray(t)&&"object"==typeof t)for(let e in t)this.add(t[e]);}getTransferables(){return Array.from(this.transfer)}}class vt{constructor(t=257,e=2){this.skirtToMainVertexMap=new Map,this.size=t,this.vertexStride=e;const r=t-1;if(r&r-1)throw new Error(`Expected grid size to be 2^n+1, got ${t}.`);this.totalLeafNodes=r*r,this.totalNodes=2*this.totalLeafNodes-2,this.totalBranchNodes=this.totalNodes-this.totalLeafNodes,this.triangleTree=new Uint16Array(4*this.totalNodes);const i=t*t;this.errorsLUT=new Float32Array(i),this.vertexIndexMap=new Int32Array(i);const s=4*r*2;this.meshVertices=new Float32Array(i*this.vertexStride+3*s),this.meshIndices=new Uint32Array(3*this.totalLeafNodes*2+3*s),this.initTree();}initTree(){const t=(e,r,i,s,n=0)=>{if(n<this.totalNodes){const o=4*n;this.triangleTree[o]=e,this.triangleTree[o+1]=r,this.triangleTree[o+2]=i,this.triangleTree[o+3]=s;const a=e+i>>1,h=r+s>>1,u=a+h-r,l=h+e-a,c=2*(n+1),d=c+1;t(i,s,u,l,c),t(u,l,e,r,d);}},e=this.size-1;t(0,0,e,e,0),t(e,e,0,0,1);}computeError(t,e,r){const i=(t+e)/2;return Math.abs(r-i)}calculateErrors(t,e=!1,r){const{totalNodes:i,totalBranchNodes:s,triangleTree:n}=this;r||(r=this.errorsLUT.fill(0));const o=e?0:-1e9,a=e?this.size-1:1e9,h=s-1;for(let e=i-1;e>=0;e--){const i=4*e,s=n[i],u=n[i+1],l=n[i+2],c=n[i+3],d=s+l>>1,f=u+c>>1,p=this.index(d,f),g=+(d===o)|+(d===a)|+(f===o)|+(f===a);if(r[p]=g?1e9:Math.max(r[p],this.computeError(t[this.index(s,u)],t[this.index(l,c)],t[p])),e>h)continue;const y=d+f-u,x=f+s-d,w=this.index(s+y>>1,u+x>>1),M=this.index(l+y>>1,c+x>>1);r[p]=Math.max(r[p],r[w],r[M]);}return r}index(t,e){return e*this.size+t}resetTmpMesh(){this.curMeshIndex=0,this.vertexIndexMap.fill(-1),this.curMeshVertexIndex=0,this.skirtToMainVertexMap.clear();}isBorderEdge(t,e,r,i){const s=this.size-1;return 0===t&&0===r||t===s&&r===s||0===e&&0===i||e===s&&i===s}addMeshVertex(t,e,r){const i=this.index(t,e),{vertexStride:s,vertexIndexMap:n,meshVertices:o}=this;let a=n[i];if(-1==a){a=this.curMeshVertexIndex++,n[i]=a;const h=s*a;o[h]=t,o[h+1]=e,3==s&&(o[h+2]=r[i]);}return a}addSkirtForEdge(t,e){const r=t=>{const e=this.meshVertices,r=3*t,i=this.curMeshVertexIndex++,s=3*i;e[s]=e[r],e[s+1]=e[r+1];const n=e[r+2];return e[s+2]=n-.2*n,i},i=(t,e,r)=>{const i=this.curMeshIndex++,s=this.curMeshIndex++,n=this.curMeshIndex++;this.meshIndices[i]=t,this.meshIndices[s]=e,this.meshIndices[n]=r;},s=r(t),n=r(e);this.skirtToMainVertexMap.set(s,t),this.skirtToMainVertexMap.set(n,e),i(e,t,n),i(t,s,n);}triangulate(t,e={}){var r;const i=null!==(r=e.maxError)&&void 0!==r?r:1,s=e.enableSkirts&&3==this.vertexStride,n=e.maxEdgeDetails||!1,o=e.errors||this.calculateErrors(t,n),a=this.size-1,h=this.meshIndices;this.resetTmpMesh();const u=(e,r,n,a,l,c)=>{const d=e+n>>1,f=r+a>>1;if(o[this.index(d,f)]>i&&Math.abs(e-l)+Math.abs(r-c)>1)u(l,c,e,r,d,f),u(n,a,l,c,d,f);else {const i=h[this.curMeshIndex++]=this.addMeshVertex(e,r,t),o=h[this.curMeshIndex++]=this.addMeshVertex(n,a,t),u=h[this.curMeshIndex++]=this.addMeshVertex(l,c,t);s&&(this.isBorderEdge(e,r,n,a)&&this.addSkirtForEdge(i,o),this.isBorderEdge(n,a,l,c)&&this.addSkirtForEdge(o,u),this.isBorderEdge(l,c,e,r)&&this.addSkirtForEdge(u,i));}};u(0,0,a,a,0,a),u(a,a,0,0,a,0);const l={vertices:this.meshVertices.slice(0,this.curMeshVertexIndex*this.vertexStride),indices:h.slice(0,this.curMeshIndex),stride:this.vertexStride};return s&&(l.skirtToMainVertexMap=this.skirtToMainVertexMap),l}}t.Neighbor=void 0,function(t){t.LEFT="left",t.RIGHT="right",t.TOP="top",t.BOTTOM="bottom";}(t.Neighbor||(t.Neighbor={}));const bt=e=>({left:t.Neighbor.RIGHT,right:t.Neighbor.LEFT,top:t.Neighbor.BOTTOM,bottom:t.Neighbor.TOP}[e]),mt=(t,e,r,i,s,n=1)=>{const o=t[e],a=t[e+1],h=t[e+2],u=t[r],l=t[r+1],c=t[r+2],d=t[i],f=t[i+1],p=t[i+2],g=(u-d)*n,y=(l-f)*n,x=c-p,w=(o-d)*n,M=(a-f)*n,T=h-p,v=x*M-y*T,b=g*T-x*w,m=y*w-g*M;s[e]+=v,s[e+1]+=b,s[e+2]+=m,s[r]+=v,s[r+1]+=b,s[r+2]+=m,s[i]+=v,s[i+1]+=b,s[i+2]+=m;};var Ft;!function(t){t.LEFT="left",t.RIGHT="right",t.TOP="top",t.BOTTOM="bottom";}(Ft||(Ft={}));function Et(t,e,r="extrapolate",i=1,s=1){const{width:n,height:o,data:a}=t,h=n+Number(!(t=>{const e=t-1;return !(e&e-1)})(n)),u=new Float32Array(h*h),l={terrarium:(t,e,r,i)=>256*t+e+r/256-32768,mtk:(t,e,r,i)=>.03*(256*t*256+256*e+r)-1e4,mapboxrgb:(t,e,r,i)=>(256*t*256+256*e+r)/10-1e4,xyztrn:(t,e,r,i)=>9500/16777215*(t<<16|e<<8|r)-500}[e.toLowerCase()];if(!l)throw new Error(`Unsupported Terrain encoding: ${e}`);for(let t=0;t<o;t++)for(let e=0;e<n;e++){const r=4*(t*n+e);u[t*h+e]=l(a[r],a[r+1],a[r+2],a[r+3])*i+s;}return h===n?u:"extrapolate"===r?function(t,e){const r=e-1;for(let i=0;i<e;i++){const s=i*e+(r-1),n=i*e+(r-2);t[i*e+r]=2*t[s]-t[n];}for(let i=0;i<e;i++){const s=(r-1)*e+i,n=(r-2)*e+i;t[r*e+i]=2*t[s]-t[n];}return t}(u,Math.sqrt(u.length)):(t=>{const e=Math.sqrt(t.length),r=e-1,i=e*r;for(let s=0;s<e;s++)t[i+s]=t[i-e+s],t[s*e+r]=t[s*e+r-1];return t})(u)}const St=(t,e)=>{const r=t.getUint32(e);e+=4;const i=(t=>{const e=t>>4;switch(15&t){case 0:return new Uint8Array(e);case 1:return new Uint16Array(e);case 2:return new Uint32Array(e);case 3:return new Int8Array(e);case 4:return new Int16Array(e);case 5:return new Int32Array(e);case 6:return new Float32Array(e);case 7:return new Float64Array(e)}})(r),s=i.length,n=i.BYTES_PER_ELEMENT,o=(t=>{switch(t[Symbol.toStringTag]){case"Int8Array":return "getInt8";case"Int16Array":return "getInt16";case"Int32Array":return "getInt32";case"Uint8Array":return "getUint8";case"Uint16Array":return "getUint16";case"Uint32Array":return "getUint32";case"Float32Array":return "getFloat32";case"Float64Array":return "getFloat64"}})(i);for(let r=0;r<s;r++)i[r]=t[o](e),e+=n;return [e,i]};class _t{static decode(t){const e=new DataView(t),[r,i]=St(e,0);return {indices:i,vertices:St(e,r)[1]}}}const Bt=65535,Vt=-500,At=9e3,kt=(t,e,r,i,s,n="binary")=>{let o=pt(r,e,t);const a=gt(r,e,t),[h,u,l,c]=a;return {id:o,type:"Feature",properties:{isTerrain:!0,source:{type:n,tile:[t,e,r]},indices:i,vertices:s},geometry:{type:"Polygon",coordinates:[[[h,c],[l,c],[l,u],[h,u],[h,c]]]}}},It={stride:3,meshBuilder:{},get(t){var e;return (e=this.meshBuilder)[t]||(e[t]=new vt(t,this.stride))}},Nt=(t,e=1)=>{const r=Math.sqrt(t.length);((t,e,r)=>{for(let i=0;i<t.length;i++)t[i]=Math.max(e,Math.min(r,t[i]));})(t,Vt,At);return It.get(r).triangulate(t,{maxError:e,enableSkirts:!0,maxEdgeDetails:!0})},Lt=(t,e)=>{const r=Math.sqrt(e.length),i=r%2==0?r:r-1;return ((t,e=1,r=t=>t,i)=>{const s=!i,n=s?t:new Float32Array(t.length/2*3),o=Math.sqrt(null==i?void 0:i.length),a=2+Number(s),h=t.length/a;for(let u=0;u<h;u++){const h=u*a,l=t[h],c=t[h+1],d=s?t[h+2]:i[c*o+l];n[h]=l*e,n[h+1]=c*e,n[h+2]=r(d);}return n})(t.vertices,Bt/i,(t=>(t-Vt)*Bt/9500),3!==t.stride&&e)};function Ut(t,e,r,i,s){var n,o,a,h,u,l,c,d,f,p;if(t){const{properties:e}=t;if(Array.isArray(e.indices)){const t=e.indices.reduce(((t,e)=>Math.max(t,e)),-1/0);e.indices=new(t>65535?Uint32Array:Uint16Array)(e.indices);}Array.isArray(e.vertices)&&(e.vertices=new Uint16Array(e.vertices)),s||(s={});const g=null!==(n=s.quantizedRange)&&void 0!==n?n:Bt,y=null!==(o=s.quantizedMinHeight)&&void 0!==o?o:Vt,x=null!==(a=s.quantizedMaxHeight)&&void 0!==a?a:At,w=x-y,M=(p=e.source).normalizeScale||(p.normalizeScale=1/(Math.pow(2,8*e.vertices.BYTES_PER_ELEMENT)-1));null!==(h=e.normalizeScale)&&void 0!==h||(e.normalizeScale={x:M,y:M,z:M*w}),null!==(u=e.quantizationRange)&&void 0!==u||(e.quantizationRange=g),null!==(l=e.quantizedMinHeight)&&void 0!==l||(e.quantizedMinHeight=y),null!==(c=e.quantizedMaxHeight)&&void 0!==c||(e.quantizedMaxHeight=x),null!==(d=e.quantizationStep)&&void 0!==d||(e.quantizationStep=w/g),null!==(f=e.heightScale)&&void 0!==f||(e.heightScale=(x-y)/g),r&&(e.heightMap=(t=>{const e=Math.sqrt(t.length),r=e+2,i=new Float32Array(r*r),s=(r,i)=>t[i*e+r],n=(t,e,s)=>i[e*r+t]=s;for(let s=0;s<e;s++){const n=s*e,o=(s+1)*r+1;for(let r=0;r<e;r++)i[o+r]=t[n+r];}for(let t=0;t<e;t++)i[0*r+(t+1)]=s(t,0),i[(r-1)*r+(t+1)]=s(t,e-1);for(let t=0;t<e;t++)i[(t+1)*r+0]=s(0,t),i[(t+1)*r+(r-1)]=s(e-1,t);return n(0,0,s(0,0)),n(r-1,0,s(e-1,0)),n(0,r-1,s(0,e-1)),n(r-1,r-1,s(e-1,e-1)),i})(r));const T=t.geometry.coordinates[0][3][1],v=T+(t.geometry.coordinates[0][4][1]-T)/2,b=256*Math.pow(2,t.id.length);Pt(e,ht.earthCircumference(v)/b,i);}return t}function Pt(t,e,r){if(t.normals||(t.normals=(({vertex:t,scaleXY:e,index:r,skipIndices:i,normals:s})=>{const n=t.length;if(null!=e||(e=1),s=(null==s?void 0:s.fill(0))||new Float32Array(n),r)for(let n=0;n<r.length;n+=3){const o=r[n],a=r[n+1],h=r[n+2];(null==i?void 0:i.has(h))||mt(t,3*o,3*a,3*h,s,e);}else for(let r=0;r<n;)mt(t,r,r+3,r+=6,s,e);const o=new Int16Array(n);for(let t=0;t<n;t+=3){const e=s[t],r=s[t+1],i=s[t+2],n=32767/Math.sqrt(e*e+r*r+i*i)||0;o[t]=e*n,o[t+1]=r*n,o[t+2]=i*n;}return o})({vertex:t.vertices,index:t.indices,skipIndices:r,scaleXY:e})),r)for(const[e,i]of r){const r=3*e,s=3*i;t.normals[r]=t.normals[s],t.normals[r+1]=t.normals[s+1],t.normals[r+2]=t.normals[s+2];}return t.edgeIndices||(t.edgeIndices=((t,e=2,r=Uint16Array,i=65535,s)=>{const n=[],o=[],a=[],h=[],u=(t,e)=>{(null==s?void 0:s.has(e))||t.push(e);};for(let r=0,{length:s}=t;r<s;r+=e){const s=t[r],l=t[r+1],c=r/e;0===s?u(n,c):s===i&&u(o,c),0===l?u(a,c):l===i&&u(h,c);}return {left:new r(n),right:new r(o),top:new r(a),bottom:new r(h)}})(t.vertices,3,t.indices.constructor,Bt,r)),{normals:t.normals,edgeIndices:t.edgeIndices}}var Ot={id:"TerrainWorker",Worker:class extends Mt{constructor(t={}){var e,r;super(t=Object.assign({responseType:"json"},t)),this.encoding=t.encoding||"terrarium",this.decodeScale=null!==(e=t.heightScale)&&void 0!==e?e:1,this.decodeOffset=null!==(r=t.heightOffset)&&void 0!==r?r:0,this.maxGeometricError=t.maxGeometricError,this.registerCustomMsgHandler("setMaxGeometricError"),this.registerCustomMsgHandler("createMeshFromHeightMap");}setMaxGeometricError(t){this.maxGeometricError=t;}createMeshFromHeightMap(t){let e=t.heightMap;const r=((t,e,r,i,s)=>{const n=Math.sqrt(t.length),o=n-s-r,a=n-i-e,h=new Float32Array(o*a);for(let e=0;e<o;e++){const r=(e+s)*n+i,o=e*a;for(let e=0;e<a;e++)h[o+e]=t[r+e];}return h})(e,1,1,1,1),i=Nt(r,t.error),s=i.indices,n=Lt(i,r),o=256*Math.pow(2,t.zoom),a=ht.earthCircumference(t.centerLatitude)/o,h={vertices:n,indices:s},{normals:u,edgeIndices:l}=Pt(h,a,i.skirtToMainVertexMap);return {data:{vertices:n,indices:s,normals:u,heightMap:e},transfer:[n,s,u,e].map((t=>t.buffer))}}process(t,e,r,i){const s=new Tt;let n,o;const a=this.encoding;let h=null;if(t instanceof ArrayBuffer){const{indices:s,vertices:o}=_t.decode(t);n=kt(e,r,i,s,o,a),t=[n];}else {if(t instanceof ImageBitmap){h=Et((t=>{const e=new OffscreenCanvas(t.width,t.height).getContext("2d");return e.drawImage(t,0,0),e.getImageData(0,0,t.width,t.height)})(t),a,"extrapolate",this.decodeScale,this.decodeOffset);const s=Nt(h,this.maxGeometricError[i]);o=s.skirtToMainVertexMap,t=function(t,e,r,i,s){return kt(t,e,r,i.indices,Lt(i,s),"terrarium")}(e,r,i,s,h);let n=1/0,u=-n;for(let t of h)t<n?n=t:t>u&&(u=t);Object.assign(t.properties,{minHeight:n,maxHeight:u});}n="Feature"==t.type?t:t.features[0];}return n&&(Ut(n,0,h,o),s.add(n.properties)),{data:t,transfer:s.getTransferables()}}}};t.GeoPoint=r,t.HTTPLoader=p,t.HTTPWorker=Mt,t.NetworkError=f,t.PixelPoint=e,t.RTINMeshBuilder=vt,t.TerrainWorker=Ot,t.VectorTile=Z,t.XYZBin=i,t.createTerrainTile=(t,e,r,i,s,n,o)=>{const a=kt(t,e,r,i,s);return n&&(a.properties.normals=n),Ut(a,r,null,null,o)},t.getGeoBounds=gt,t.getOppositeNeighbor=bt,t.getTilesOfLevel=yt,t.pbf=y,t.quadToGrid=ft,t.stitchHeightmapBorders=(t,e,r,i=0,s=1)=>{const n=Math.sqrt(t.length),o=n-1,a=(t,r)=>e[r*n+t],h=(e,r,i)=>{t[r*n+e]=i;};if(r===Ft.BOTTOM)for(let t=0;t<s;t++)for(let e=0;e<n;e++)h(e,o-t,a(e,s-1+i-t));else if(r===Ft.TOP)for(let t=0;t<s;t++)for(let e=0;e<n;e++)h(e,t,a(e,n-s-i+t));if(r===Ft.RIGHT)for(let t=0;t<n;t++)for(let e=0;e<s;e++)h(o-e,t,a(s-1+i-e,t));else if(r===Ft.LEFT)for(let t=0;t<n;t++)for(let e=0;e<s;e++)h(s-1-e,t,a(o-i-e,t));return t},t.stitchMeshBorders=(e,r,i)=>{const{edgeIndices:s,vertices:n,normals:o}=r,{vertices:a,normals:h,edgeIndices:u}=i;if(!s||!u)return;const l=s[e],c=u[bt(e)],d=65535,f=e===t.Neighbor.RIGHT?-65535:e===t.Neighbor.LEFT?d:0,p=e===t.Neighbor.BOTTOM?-65535:e===t.Neighbor.TOP?d:0,g=new Map;for(let t of l){const e=3*t,r=n[e]+f,i=n[e+1]+p;g.set(r<<16|i,e);}for(let t=0,{length:e}=c;t<e;t++){const e=3*c[t],r=a[e],i=a[e+1],s=g.get(r<<16|i);if(void 0===s)continue;if(n[s+2]=a[e+2],!o)continue;const u=.5*(o[s]+h[e]),l=.5*(o[s+1]+h[e+1]),d=.5*(o[s+2]+h[e+2]);o[s]=u,o[s+1]=l,o[s+2]=d,h[e]=u,h[e+1]=l,h[e+2]=d;}},t.tileUtils=wt,t.tileXYToQuadKey=pt,t.vectorTile=O,t.webMercatorPrj=ht;}));

	define(["./shared"],(function(e){"use strict";function t(e,t,r=2){const i=t&&t.length,o=i?t[0]*r:e.length;let u=n(e,0,o,r,!0);const l=[];if(!u||u.next===u.prev)return l;let c,p,v;if(i&&(u=function(e,t,r,x){const i=[];for(let r=0,o=t.length;r<o;r++){const u=n(e,t[r]*x,r<o-1?t[r+1]*x:e.length,x,!1);u===u.next&&(u.steiner=!0),i.push(y(u));}i.sort(f);for(let e=0;e<i.length;e++)r=s(i[e],r);return r}(e,t,u,r)),e.length>80*r){c=e[0],p=e[1];let t=c,n=p;for(let x=r;x<o;x+=r){const r=e[x],i=e[x+1];r<c&&(c=r),i<p&&(p=i),r>t&&(t=r),i>n&&(n=i);}v=Math.max(t-c,n-p),v=0!==v?32767/v:0;}return x(u,l,r,c,p,v,0),l}function n(e,t,n,r,x){let i;if(x===function(e,t,n,r){let x=0;for(let i=t,o=n-r;i<n;i+=r)x+=(e[o]-e[i])*(e[i+1]+e[o+1]),o=i;return x}(e,t,n,r)>0)for(let x=t;x<n;x+=r)i=z(x/r|0,e[x],e[x+1],i);else for(let x=n-r;x>=t;x-=r)i=z(x/r|0,e[x],e[x+1],i);return i&&Z(i,i.next)&&(b(i),i=i.next),i}function r(e,t){if(!e)return e;t||(t=e);let n,r=e;do{if(n=!1,r.steiner||!Z(r,r.next)&&0!==d(r.prev,r,r.next))r=r.next;else {if(b(r),r=t=r.prev,r===r.next)break;n=!0;}}while(n||r!==t);return t}function x(e,t,n,f,s,c,y){if(!e)return;!y&&c&&function(e,t,n,r){let x=e;do{0===x.z&&(x.z=p(x.x,x.y,t,n,r)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next;}while(x!==e);x.prevZ.nextZ=null,x.prevZ=null,function(e){let t,n=1;do{let r,x=e;e=null;let i=null;for(t=0;x;){t++;let o=x,u=0;for(let e=0;e<n&&(u++,o=o.nextZ,o);e++);let l=n;for(;u>0||l>0&&o;)0!==u&&(0===l||!o||x.z<=o.z)?(r=x,x=x.nextZ,u--):(r=o,o=o.nextZ,l--),i?i.nextZ=r:e=r,r.prevZ=i,i=r;x=o;}i.nextZ=null,n*=2;}while(t>1)}(x);}(e,f,s,c);let v=e;for(;e.prev!==e.next;){const p=e.prev,a=e.next;if(c?o(e,f,s,c):i(e))t.push(p.i,e.i,a.i),b(e),e=a.next,v=a.next;else if((e=a)===v){y?1===y?x(e=u(r(e),t),t,n,f,s,c,2):2===y&&l(e,t,n,f,s,c):x(r(e),t,n,f,s,c,1);break}}}function i(e){const t=e.prev,n=e,r=e.next;if(d(t,n,r)>=0)return !1;const x=t.x,i=n.x,o=r.x,u=t.y,l=n.y,f=r.y,s=Math.min(x,i,o),c=Math.min(u,l,f),p=Math.max(x,i,o),y=Math.max(u,l,f);let v=r.next;for(;v!==t;){if(v.x>=s&&v.x<=p&&v.y>=c&&v.y<=y&&a(x,u,i,l,o,f,v.x,v.y)&&d(v.prev,v,v.next)>=0)return !1;v=v.next;}return !0}function o(e,t,n,r){const x=e.prev,i=e,o=e.next;if(d(x,i,o)>=0)return !1;const u=x.x,l=i.x,f=o.x,s=x.y,c=i.y,y=o.y,v=Math.min(u,l,f),h=Math.min(s,c,y),Z=Math.max(u,l,f),g=Math.max(s,c,y),m=p(v,h,t,n,r),w=p(Z,g,t,n,r);let M=e.prevZ,k=e.nextZ;for(;M&&M.z>=m&&k&&k.z<=w;){if(M.x>=v&&M.x<=Z&&M.y>=h&&M.y<=g&&M!==x&&M!==o&&a(u,s,l,c,f,y,M.x,M.y)&&d(M.prev,M,M.next)>=0)return !1;if(M=M.prevZ,k.x>=v&&k.x<=Z&&k.y>=h&&k.y<=g&&k!==x&&k!==o&&a(u,s,l,c,f,y,k.x,k.y)&&d(k.prev,k,k.next)>=0)return !1;k=k.nextZ;}for(;M&&M.z>=m;){if(M.x>=v&&M.x<=Z&&M.y>=h&&M.y<=g&&M!==x&&M!==o&&a(u,s,l,c,f,y,M.x,M.y)&&d(M.prev,M,M.next)>=0)return !1;M=M.prevZ;}for(;k&&k.z<=w;){if(k.x>=v&&k.x<=Z&&k.y>=h&&k.y<=g&&k!==x&&k!==o&&a(u,s,l,c,f,y,k.x,k.y)&&d(k.prev,k,k.next)>=0)return !1;k=k.nextZ;}return !0}function u(e,t){let n=e;do{const r=n.prev,x=n.next.next;!Z(r,x)&&g(r,n,n.next,x)&&M(r,x)&&M(x,r)&&(t.push(r.i,n.i,x.i),b(n),b(n.next),n=e=x),n=n.next;}while(n!==e);return r(n)}function l(e,t,n,i,o,u){let l=e;do{let e=l.next.next;for(;e!==l.prev;){if(l.i!==e.i&&h(l,e)){let f=k(l,e);return l=r(l,l.next),f=r(f,f.next),x(l,t,n,i,o,u,0),void x(f,t,n,i,o,u,0)}e=e.next;}l=l.next;}while(l!==e)}function f(e,t){let n=e.x-t.x;if(0===n&&(n=e.y-t.y,0===n)){n=(e.next.y-e.y)/(e.next.x-e.x)-(t.next.y-t.y)/(t.next.x-t.x);}return n}function s(e,t){const n=function(e,t){let n=t;const r=e.x,x=e.y;let i,o=-1/0;if(Z(e,n))return n;do{if(Z(e,n.next))return n.next;if(x<=n.y&&x>=n.next.y&&n.next.y!==n.y){const e=n.x+(x-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=r&&e>o&&(o=e,i=n.x<n.next.x?n:n.next,e===r))return i}n=n.next;}while(n!==t);if(!i)return null;const u=i,l=i.x,f=i.y;let s=1/0;n=i;do{if(r>=n.x&&n.x>=l&&r!==n.x&&v(x<f?r:o,x,l,f,x<f?o:r,x,n.x,n.y)){const t=Math.abs(x-n.y)/(r-n.x);M(n,e)&&(t<s||t===s&&(n.x>i.x||n.x===i.x&&c(i,n)))&&(i=n,s=t);}n=n.next;}while(n!==u);return i}(e,t);if(!n)return t;const x=k(n,e);return r(x,x.next),r(n,n.next)}function c(e,t){return d(e.prev,e,t.prev)<0&&d(t.next,e,e.next)<0}function p(e,t,n,r,x){return (e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*x|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*x|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function y(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;}while(t!==e);return n}function v(e,t,n,r,x,i,o,u){return (x-o)*(t-u)>=(e-o)*(i-u)&&(e-o)*(r-u)>=(n-o)*(t-u)&&(n-o)*(i-u)>=(x-o)*(r-u)}function a(e,t,n,r,x,i,o,u){return !(e===o&&t===u)&&v(e,t,n,r,x,i,o,u)}function h(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&g(n,n.next,e,t))return !0;n=n.next;}while(n!==e);return !1}(e,t)&&(M(e,t)&&M(t,e)&&function(e,t){let n=e,r=!1;const x=(e.x+t.x)/2,i=(e.y+t.y)/2;do{n.y>i!=n.next.y>i&&n.next.y!==n.y&&x<(n.next.x-n.x)*(i-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;}while(n!==e);return r}(e,t)&&(d(e.prev,e,t.prev)||d(e,t.prev,t))||Z(e,t)&&d(e.prev,e,e.next)>0&&d(t.prev,t,t.next)>0)}function d(e,t,n){return (t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Z(e,t){return e.x===t.x&&e.y===t.y}function g(e,t,n,r){const x=w(d(e,t,n)),i=w(d(e,t,r)),o=w(d(n,r,e)),u=w(d(n,r,t));return x!==i&&o!==u||(!(0!==x||!m(e,n,t))||(!(0!==i||!m(e,r,t))||(!(0!==o||!m(n,e,r))||!(0!==u||!m(n,t,r)))))}function m(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function w(e){return e>0?1:e<0?-1:0}function M(e,t){return d(e.prev,e,e.next)<0?d(e,t,e.next)>=0&&d(e,e.prev,t)>=0:d(e,t,e.prev)<0||d(e,e.next,t)<0}function k(e,t){const n=T(e.i,e.x,e.y),r=T(t.i,t.x,t.y),x=e.next,i=t.prev;return e.next=t,t.prev=e,n.next=x,x.prev=n,r.next=n,n.prev=r,i.next=r,r.prev=i,r}function z(e,t,n,r){const x=T(e,t,n);return r?(x.next=r.next,x.prev=r,r.next.prev=x,r.next=x):(x.prev=x,x.next=x),x}function b(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ);}function T(e,t,n){return {i:e,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}const V=e=>{var t=e._pbf;t.pos=e._geometry;for(var n,r=t.readVarint()+t.pos,x=1,i=0,o=0,u=0,l=[];t.pos<r;){if(i<=0){var f=t.readVarint();x=7&f,i=f>>3;}if(i--,1===x||2===x)o+=t.readSVarint(),u+=t.readSVarint(),1===x&&(n&&l.push(n),n=[]),n.push([o,u]);else {if(7!==x)throw new Error("unknown command "+x);n&&n.push(n[0].slice());}}return n&&l.push(n),l};function W(e){var t=e.length;if(t<=1)return [e];for(var n,r,x=[],i=0;i<t;i++){var o=B(e[i]);0!==o&&(void 0===r&&(r=o<0),r===o<0?(n&&x.push(n),n=[e[i]]):n.push(e[i]));}return n&&x.push(n),x}function B(e){let t=0;for(var n,r,x=0,i=e.length,o=i-1;x<i;o=x++)n=e[x],t+=((r=e[o])[0]-n[0])*(n[1]+r[1]);return t}const E=(e,t=[])=>{const n=[];let r=0;for(let x=0;x<e.length;x++){for(let n=0;n<e[x].length;n++)t[t.length]=e[x][n][0],t[t.length]=e[x][n][1];x>0&&(r+=e[x-1].length,n[n.length]=r);}return {vertices:t,holes:n,dimensions:e[0][0].length}};let L=[{id:"MVTWorker",Worker:class extends e.HTTPWorker{constructor(){super({responseType:"arraybuffer"});}process(n,r,x,i){const o=(n=>{const r=new e.VectorTile(new e.pbf(n));let x=[],i=0;for(let e in r.layers){let n=r.layers[e],o=0;const u={index:i++,features:[]};for(;o<n.length;){const e=n.feature(o);if(3==e.type){const n=V(e),r=[];let x=0,i=!1;for(let e of W(n)){let n=E(e),o=t(n.vertices,n.holes,n.dimensions);for(let e of o){const t=x+e;i||(i=t>65535),r[r.length]=t;}x+=n.vertices.length/n.dimensions;}u.features.push({index:o,data:r,requires32Bit:i});}o++;}u.features.length&&x.push(u);}return e.XYZBin.fromLayers(x).getBuffer()})(n);return {data:{mvt:n,triangles:o},transfer:[n,o]}}}},e.TerrainWorker];self.addEventListener("message",(function e(t){const{msg:n,worker:r,options:x}=t.data;if("init"==n){let{Worker:t}=L.find((e=>e.id==r));t&&(new t(x),t=null),L=null,self.removeEventListener("message",e);}}));}));

	define(["exports","./shared","@here/xyz-maps-common"],(function(e,t,r){"use strict";function i(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return e[r]}});}})),t.default=e,Object.freeze(t)}var s=i(r);class o{constructor(e,t,r,i){this.minX=e,this.minY=t,this.maxX=r,this.maxY=i;}}class n{constructor(e,t,r,i){this.minLon=e,this.minLat=t,this.maxLon=r,this.maxLat=i;}}const a=[{zIndex:0,type:"Circle",radius:6,fill:"#ff0000"}],l=[{zIndex:0,type:"Line",strokeWidth:10,stroke:"#ff0000"}],h=[{zIndex:0,type:"Polygon",strokeWidth:1,stroke:"#ffffff",fill:"#ff0000"}];var d={styleGroups:{Point:a,MultiPoint:a,LineString:l,MultiLineString:l,Polygon:h,MultiPolygon:h},assign:e=>e.geometry.type};const c=(()=>{const e=Object.getPrototypeOf(Uint8Array);return t=>t instanceof e})();function u(e,t){for(const r in t)e[r]=t[r];return e}const p=[];let g;const f=e=>{if("object"!=typeof e||null===e)return e;let t;if(Array.isArray(e)){t=new Array(e.length);for(let r=0,i=e.length;r<i;r++)t[r]=f(e[r]);}else if(c(e))t=e.slice();else {t={};for(let r in e)t[r]=f(e[r]);}return t};class m{constructor(e){if(this.styleGroups=null,this._c=null,this.lights={},this.expContext={$geometryType:null,$layer:null,$zoom:0,$id:null},e)for(let t in e){const r=e[t];this[t]="styleGroups"==t?f(r):r;}if(this.definitions||(this.definitions={}),this.expParser=new r.ExpressionParser(this.definitions,this.expContext),(null==e?void 0:e.assign)==g){const e=[];for(let t in this.styleGroups){let i=this.styleGroups[t];Array.isArray(i)||(i=[i]);for(let t of i)t.filter&&(r.ExpressionParser.isJSONExp(t.filter)&&(t.filter=this.expParser.parseJSON(t.filter)),e.push(t));}this.flatStyles=e,this._filteredStyleGrp=[];}const t=e||this;this._style=t,this.setBgColor(t.backgroundColor),t.lights&&this.setLights(t.lights);}setLights(e){this.lights={};for(let t in e){let r=[];const i=e[t];for(let e of i)(null==e?void 0:e.type)&&e.color&&("ambient"==e.type||Array.isArray(e.direction))&&r.push(e);r.length&&(this.lights[t]=r);}}getLights(e){return e?this.lights[e]:this.lights}setBgColor(e){if(r.ExpressionParser.isJSONExp(e)){const t=this.expParser.evaluate(e,this.expContext,r.ExpressionMode.dynamic);this.backgroundColor=t instanceof r.Expression?()=>t.resolve():t;}else this.backgroundColor=e;}assign(e,t){let i=this._filteredStyleGrp,s=0;for(let o of this.flatStyles){const{filter:n}=o;(n instanceof r.Expression?n.resolve(e.properties):"function"==typeof n?o.filter(e,t):n)&&(i[s++]=o);}if(s>0)return i.length=s,i}getDefinitions(){return this.definitions}getExpressionParser(){return this.expParser}getExpressionContext(){return this.expContext}getCustomStyles(){return this._c}getCustomStyleGroup(e){return this._c[e.id]}initMapContext(e,t){var r;const i=e.geometry.type,{expContext:s}=this;return s.$geometryType="Point"==i||"MultiPoint"==i?"point":"LineString"==i||"MultiLineString"==i?"line":"polygon",s.$id=null!==(r=e.properties.$id)&&void 0!==r?r:e.id,s.$layer=e.getDataSourceLayer(this.layer),s.$zoom=t,this.expParser.clearResultCache(),s}getStyleGroup(e,t,r){let i=this._c[e.id];return this.initMapContext(e,t),(i==g||r)&&(i=this.assign(e,t),"object"!=typeof i&&(i=this.styleGroups[i])),i}setStyleGroup(e,t,r){const i=e.id,s=this._c;return this.expParser.clearResultCache(),t&&r&&(t=this.merge(this.getStyleGroup(e),t)),t?s[i]=t:null===t||!1===t?t=s[i]=p:s[i]&&delete s[i],t}merge(e,t){if(null===t||!1===t)return null;const r=[];let i;for(let s=0,o=e.length;s<o;s++)i=u({},e[s]),t[s]&&u(i,t[s]),r[s]=i;return r}init(e,t){this.layer=e,this._c=t||{};}clearCache(){var e,t;null===(t=(e=this.expParser).clearCache)||void 0===t||t.call(e);}getLayerStyle(){return this._style}initZoom(e){const{expParser:t,expContext:r}=this;if(r.zoom!=e)return r.zoom=e,r.$zoom=0^e,t.clearDynamicResultCache(),!0}}var y;let v;!function(e){e.REMOVE="layerRemove",e.ADD="layerAdd",e.VISIBILITY_CHANGE="layerVisibilityChange";}(y||(y={}));class x{constructor(e){this.name="",this.__type="Layer";const t=this;e=Object.assign({visible:!0},e);for(const r in e)t[r]=e[r];t.id==v&&(t.id="L-"+(1e8*Math.random()^0)),t._l=new r.Listener(Object.values(y));}addEventListener(e,t,r){const i=this._l;if(i.isDefined(e))return i.add(e,t,r)}removeEventListener(e,t,r){const i=this._l;if(i.isDefined(e))return i.remove(e,t,r)}dispatchEvent(e,t,r=!1){t.layer=this;const i=new CustomEvent(e,{detail:t});this._l.trigger(e,i,!r);}setVisible(e){if("boolean"==typeof e){const{visible:t}=this;this.visible=!!e,t!=e&&this._l.trigger(y.VISIBILITY_CHANGE,new CustomEvent(y.VISIBILITY_CHANGE,{detail:{visible:e,layer:this}}),!1);}}isVisible(e){return this.visible&&e!=v?e>=this.min&&e<=this.max:this.visible}_initZoom(e){}}const b="featureRemove",_="featureAdd",T="featureCoordinatesChange",L="styleGroupChange",w="styleChange",P="viewportReady",M="clear";function S(e){return Math.round(Math.log(e)/Math.log(2)-8)}class C extends x{constructor(e){var t;const{pointerEvents:r,attribution:i}=e;delete e.pointerEvents,delete e.attribution,super(Object.assign({min:15,max:32,margin:20,tiled:!0,adaptiveGrid:!1},e)),this._p=[],this._styleManager=null,this._pev=!0,this.__type="Layer",this.custom=!1;const s=this;s.attribution=i?Array.isArray(i)?i:"string"==typeof i?[{label:i}]:[i]:[],[_,"featuresAdd",b,"featuresRemove",T,M,L,P,w].forEach((e=>s._l.addEvent(e))),"boolean"==typeof r&&s.pointerEvents(r);const o=e.providers||e.provider;let n=256;const a=(e,t,r)=>{for(let i=e;i<=t;i++)s._p[i]=r;};if(o instanceof Array)for(let e of o)a(e.min,e.max,e.provider);else {n=this.tileSize?o.size=this.tileSize:Math.max(n,o.size);const e=Number(512==n);a(s.min-e,s.max-e,o),s._fp=o;}let l;this.tileSize||n%256||(s.tileSize=n),null!==(t=s.levelOffset)&&void 0!==t||(s.levelOffset=S(this.tileSize)),s._p.forEach(((e,t)=>{if(e){const t=[M];"FeatureProvider"==e.__type&&t.push(_,"featuresAdd",b,"featuresRemove",T);for(let r of t)e.addEventListener(r,s._eventProxy,s);}})),s.setMargin(s.getMargin());const h=s._fp&&s._fp.styles;(l=e.style||e.styles||h||d)&&s.setStyle(l),["style","styles","provider","providers"].forEach((e=>{delete s[e];}));}getProvider(e){return e?this._p[Math.floor(e)-this.levelOffset]:this._fp}addEventListener(e,t,r){var i;return this._l.isDefined(e)?super.addEventListener(e,t,r):null===(i=this._fp)||void 0===i?void 0:i.addEventListener(e,t,r)}removeEventListener(e,t,r){return this._l.isDefined(e)?super.removeEventListener(e,t,r):this._fp.removeEventListener(e,t,r)}_eventProxy(e){const{type:t,detail:r}=e;r.layer=this,this._l.trigger(t,e,!0);}setFeatureCoordinates(e,t){return this._fp.setFeatureCoordinates(e,t)}addFeature(e,t){const r=this._fp;if(r.addFeature){const i=r.addFeature(e);return t&&this.setStyleGroup(i,t),i}}removeFeature(e){const t=this._fp;if(t.removeFeature)return t.removeFeature(e)}setStyleGroup(e,t,r){this._styleManager&&this.dispatchEvent(L,{feature:e,styleGroup:this._styleManager.setStyleGroup(e,t,r)});}getStyleGroup(e,t,r){var i;return null===(i=this._styleManager)||void 0===i?void 0:i.getStyleGroup(e,t,r)}_getCustomStyleGroup(e){var t;return null===(t=this._styleManager)||void 0===t?void 0:t.getCustomStyleGroup(e)}search(e,t){const r=this._fp;if(r&&r.search)return r.search.apply(this._fp,arguments)}getTile(e,t){const r=e.length,i=this._p[r];if(i)return i.getTile(e,t)}cancelTile(e,t){const r="string"==typeof e?e.length:e.quadkey.length,i=this._p[r];if(i&&i.cancel)return i.cancel(e,t)}getCachedTile(e){const t=e.length,r=this._p[t];if(r)return r.getCachedTile(e)}setStyle(e,t=!1){var r,i,s;const o=t&&(null===(r=this._styleManager)||void 0===r?void 0:r.getCustomStyles());e instanceof m||(e=new m(e)),null===(s=(i=e).init)||void 0===s||s.call(i,this,o),this._styleManager=e,this.dispatchEvent(w,{style:e});}getStyleManager(){return this._styleManager}getStyle(){return this._styleManager.getLayerStyle()}getMargin(){return this.margin}setMargin(e=0){e=Number(e);const t=this._p;let r=t.length;for(;r--;)t[r]&&t[r].setMargin(e);return this.margin=e}pointerEvents(e){return null!=e&&(this._pev=!!e),this._pev}getAttribution(e){const t=this._p.filter(((e,t,r)=>r.indexOf(e)===t)),r=[...this.attribution];let i,s=0;const o=t=>{t.length&&r.push(...t),--s||null==e||e(r);};for(;i=t.pop();)(null==i?void 0:i.getAttribution)&&(s++,i.getAttribution(o));}getStyleDefinitions(){var e;return null===(e=this._styleManager)||void 0===e?void 0:e.getDefinitions()}_initZoom(e){this.getStyleManager().initZoom(e);}}C.prototype.modifyFeatureCoordinates=C.prototype.setFeatureCoordinates;class E extends t.HTTPLoader{constructor(e,t,r){super(t),this.pendingResponses=new Map,r||(r=new ArrayBuffer(0)),this.worker=new Worker(window.here.xyz.maps.__workerURL),this.worker.postMessage({msg:"init",worker:e,options:JSON.parse(JSON.stringify(t)),payload:r},[r]),this.worker.addEventListener("message",this.receiveMessage.bind(this));}processData(e){return e.data}receiveMessage(e){var r,i;const s=e.data,o=s.msg,n=s.key||o,a=this.pendingResponses.get(n);if(a)switch(this.pendingResponses.delete(n),o){case"success":a.success(this.processData(s.data));break;case"error":const{tile:e}=a;e.error=new t.NetworkError(s.data),null===(i=(r=a).error)||void 0===i||i.call(r,e.error,e);break;default:a.resolve(s.data);}}load(e,t,r){const i=this.getUrl(e),{quadkey:s,x:o,y:n,z:a}=e;this.pendingResponses.set(s,{tile:e,success:t,error:r}),this.worker.postMessage({msg:"load",url:i,quadkey:s,x:o,y:n,z:a});}abort(e){const t=this.getUrl(e),{quadkey:r,x:i,y:s,z:o}=e;this.pendingResponses.get(r)&&(this.pendingResponses.delete(r),this.worker.postMessage({msg:"abort",url:t,quadkey:r,x:i,y:s,z:o}));}addPendingResponse(e){return new Promise((async(t,r)=>{this.pendingResponses.set(e,{resolve:t,reject:r});}))}async call(e){var t;const{method:r,data:i,transfer:s}=e,o=null!==(t=e.method+e.key)&&void 0!==t?t:"",n=this.addPendingResponse(o);return this.worker.postMessage({msg:r,key:o,custom:i},s),n}}class R extends E{constructor(e){super("MVTWorker",e);}processData(e){const r=new t.XYZBin(e.triangles),i=r.getLayers(),s={};for(let e in i)s[e]=r.getFeatures(i[e]);return {mvt:e.mvt,triangles:s}}}class F{constructor(e,t){this._m=0,this.id=e.id,this.properties=e.properties,this.geometry=e.geometry,this.bbox=e.bbox,this._provider=t;}toJSON(){return r.JSUtils.clone({id:this.id,type:this.type,bbox:this.bbox,properties:this.properties,geometry:{type:this.geometry.type,coordinates:this.geometry.coordinates}})}getProvider(){return this._provider}getBBox(){return this._provider.decBBox(this)}getDataSourceLayer(e){var t;return null!==(t=e.name)&&void 0!==t?t:e.id}}F.prototype.type="Feature";"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;const O=t.vectorTile.VectorTile,z=t.vectorTile.VectorTileFeature;z.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,i=1,s=0,o=0,n=0,a=[];e.pos<r;){if(s<=0){var l=e.readVarint();i=7&l,s=l>>3;}if(s--,1===i||2===i)o+=e.readSVarint(),n+=e.readSVarint(),1===i&&(t&&a.push(t),t=[]),t.push([o,n]);else {if(7!==i)throw new Error("unknown command "+i);t&&t.push(t[0].slice());}}return t&&a.push(t),a};let k=r.TaskManager.getInstance();var A=0;function B(e){let t=0;for(var r,i,s=0,o=e.length,n=o-1;s<o;n=s++)r=e[s],t+=((i=e[n])[0]-r[0])*(r[1]+i[1]);return t}const j=(e,t)=>360*e/t-180,U=(e,t)=>{const r=180-360*e/t;return 360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90},I=(e,t,r,i,s)=>{let o=e.loadGeometry();switch(e.type){case 1:var n=[];for(let e=0;e<o.length;e++)n[e]=o[e][0];o=n,s(o,t,r,i,e);break;case 2:for(let n=0;n<o.length;n++)s(o[n],t,r,i,e);break;case 3:o=function(e){var t=e.length;if(t<=1)return [e];for(var r,i,s=[],o=0;o<t;o++){var n=B(e[o]);0!==n&&(void 0===i&&(i=n<0),i===n<0?(r&&s.push(r),r=[e[o]]):r.push(e[o]));}return r&&s.push(r),s}(o);for(let n=0;n<o.length;n++)for(let a=0;a<o[n].length;a++)s(o[n][a],t,r,i,e);}return o};function q(e,t,r){const i=((e,t,r,i)=>{let s=1/0,o=-s,n=s,a=-n,l=e.extent*(1<<i),h=e.extent*t,d=e.extent*r,c=z.types[e.type];const u=I(e,t,r,i,(e=>{for(let t of e){let e=t[0],r=t[1];e<s&&(s=e),e>o&&(o=e),r<n&&(n=r),r>a&&(a=r);}}));return u.length>1&&(c="Multi"+c),{bbox:[j(s+h,l),U(a+d,l),j(o+h,l),U(n+d,l)],type:c}})(e,t.x,t.y,t.z),s={type:"Feature",geometry:new G(i.type,e,t),properties:e.properties};return "id"in e&&(s.id=e.id),r&&(s.bbox=i.bbox),s}const D=(e,t,r,i,s)=>{const{extent:o}=s,n=1<<i;for(let i of e)i[0]=(t+i[0]/o)/n,i[1]=(r+i[1]/o)/n;};class G{constructor(e,t,r){this.type=e,this._vtf=t,this.__xyz=r;}_coordinates(){const e=this.type,{x:t,y:r,z:i}=this.__xyz;let s=I(this._vtf,t,r,i,D);return "Point"!=e&&"Polygon"!=e&&"LineString"!=e||(s=s[0]),s}get coordinates(){const{x:e,y:t,z:r}=this.__xyz;return ((e,t,r,i)=>{var s=e.extent*(1<<i),o=e.extent*t,n=e.extent*r;let a=I(e,t,r,i,(e=>{for(var t=0;t<e.length;t++){var r=e[t],i=j(r[0]+o,s),a=U(r[1]+n,s);e[t]=[i,a];}}));return 1===a.length&&(a=a[0]),a})(this._vtf,e,t,r)}}function Y(e){k.create({init:function(){const r=[],i=new O(new t.pbf(e.data.mvt)),{tile:s}=e;for(var o in i.layers)r.push(o);return {xyz:{x:s.x,y:s.y,z:s.z},mvt:i,triangles:e.data.triangles,layers:r,l:0,f:0,geojson:[]}},priority:4,exec:function(e){var t,r,i,s;let{mvt:o,xyz:n,layers:a,triangles:l,l:h,f:d,geojson:c}=e;for(;h<a.length;){let u=o.layers[a[h]],p=l[h],g=u.name,f={x:n.x,y:n.y,z:n.z,l:g};for(;d<u.length;){let o=q(u.feature(d),f,!0),n=o.geometry.type;if("MultiPolygon"!=n&&"Polygon"!=n||(o.geometry._xyz=null==p?void 0:p[d]),o.id=++A,d++,null!==(t=(i=o.properties).layer)&&void 0!==t||(i.layer=u.name),null!==(r=(s=o.properties).$layer)&&void 0!==r||(s.$layer=u.name),c.push(o),!(d%16))return e.f=d,this.CONTINUE}return e.l=++h,e.f=0,this.CONTINUE}return this.BREAK},onDone:function(t){e.ready(t.geojson);}}).start();}var N={exports:{}};N.exports=function(){function e(e,i,s,o,n){!function e(r,i,s,o,n){for(;o>s;){if(o-s>600){var a=o-s+1,l=i-s+1,h=Math.log(a),d=.5*Math.exp(2*h/3),c=.5*Math.sqrt(h*d*(a-d)/a)*(l-a/2<0?-1:1);e(r,i,Math.max(s,Math.floor(i-l*d/a+c)),Math.min(o,Math.floor(i+(a-l)*d/a+c)),n);}var u=r[i],p=s,g=o;for(t(r,s,i),n(r[o],u)>0&&t(r,s,o);p<g;){for(t(r,p,g),p++,g--;n(r[p],u)<0;)p++;for(;n(r[g],u)>0;)g--;}0===n(r[s],u)?t(r,s,g):t(r,++g,o),g<=i&&(s=g+1),i<=g&&(o=g-1);}}(e,i,s||0,o||e.length-1,n||r);}function t(e,t,r){var i=e[t];e[t]=e[r],e[r]=i;}function r(e,t){return e<t?-1:e>t?1:0}var i=function(e){void 0===e&&(e=9),this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear();};function s(e,t,r){if(!r)return t.indexOf(e);for(var i=0;i<t.length;i++)if(r(e,t[i]))return i;return -1}function o(e,t){n(e,0,e.children.length,t,e);}function n(e,t,r,i,s){s||(s=g(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(var o=t;o<r;o++){var n=e.children[o];a(s,e.leaf?i(n):n);}return s}function a(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function l(e,t){return e.minX-t.minX}function h(e,t){return e.minY-t.minY}function d(e){return (e.maxX-e.minX)*(e.maxY-e.minY)}function c(e){return e.maxX-e.minX+(e.maxY-e.minY)}function u(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function p(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function g(e){return {children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function f(t,r,i,s,o){for(var n=[r,i];n.length;)if(!((i=n.pop())-(r=n.pop())<=s)){var a=r+Math.ceil((i-r)/s/2)*s;e(t,a,r,i,o),n.push(r,a,a,i);}}return i.prototype.all=function(){return this._all(this.data,[])},i.prototype.search=function(e){var t=this.data,r=[];if(!p(e,t))return r;for(var i=this.toBBox,s=[];t;){for(var o=0;o<t.children.length;o++){var n=t.children[o],a=t.leaf?i(n):n;p(e,a)&&(t.leaf?r.push(n):u(e,a)?this._all(n,r):s.push(n));}t=s.pop();}return r},i.prototype.collides=function(e){var t=this.data;if(!p(e,t))return !1;for(var r=[];t;){for(var i=0;i<t.children.length;i++){var s=t.children[i],o=t.leaf?this.toBBox(s):s;if(p(e,o)){if(t.leaf||u(e,o))return !0;r.push(s);}}t=r.pop();}return !1},i.prototype.load=function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0;t<e.length;t++)this.insert(e[t]);return this}var r=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else {if(this.data.height<r.height){var i=this.data;this.data=r,r=i;}this._insert(r,this.data.height-r.height-1,!0);}else this.data=r;return this},i.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},i.prototype.clear=function(){return this.data=g([]),this},i.prototype.remove=function(e,t){if(!e)return this;for(var r,i,o,n=this.data,a=this.toBBox(e),l=[],h=[];n||l.length;){if(n||(n=l.pop(),i=l[l.length-1],r=h.pop(),o=!0),n.leaf){var d=s(e,n.children,t);if(-1!==d)return n.children.splice(d,1),l.push(n),this._condense(l),this}o||n.leaf||!u(n,a)?i?(r++,n=i.children[r],o=!1):n=null:(l.push(n),h.push(r),r=0,i=n,n=n.children[0]);}return this},i.prototype.toBBox=function(e){return e},i.prototype.compareMinX=function(e,t){return e.minX-t.minX},i.prototype.compareMinY=function(e,t){return e.minY-t.minY},i.prototype.toJSON=function(){return this.data},i.prototype.fromJSON=function(e){return this.data=e,this},i.prototype._all=function(e,t){for(var r=[];e;)e.leaf?t.push.apply(t,e.children):r.push.apply(r,e.children),e=r.pop();return t},i.prototype._build=function(e,t,r,i){var s,n=r-t+1,a=this._maxEntries;if(n<=a)return o(s=g(e.slice(t,r+1)),this.toBBox),s;i||(i=Math.ceil(Math.log(n)/Math.log(a)),a=Math.ceil(n/Math.pow(a,i-1))),(s=g([])).leaf=!1,s.height=i;var l=Math.ceil(n/a),h=l*Math.ceil(Math.sqrt(a));f(e,t,r,h,this.compareMinX);for(var d=t;d<=r;d+=h){var c=Math.min(d+h-1,r);f(e,d,c,l,this.compareMinY);for(var u=d;u<=c;u+=l){var p=Math.min(u+l-1,c);s.children.push(this._build(e,u,p,i-1));}}return o(s,this.toBBox),s},i.prototype._chooseSubtree=function(e,t,r,i){for(;i.push(t),!t.leaf&&i.length-1!==r;){for(var s=1/0,o=1/0,n=void 0,a=0;a<t.children.length;a++){var l=t.children[a],h=d(l),c=(u=e,p=l,(Math.max(p.maxX,u.maxX)-Math.min(p.minX,u.minX))*(Math.max(p.maxY,u.maxY)-Math.min(p.minY,u.minY))-h);c<o?(o=c,s=h<s?h:s,n=l):c===o&&h<s&&(s=h,n=l);}t=n||t.children[0];}var u,p;return t},i.prototype._insert=function(e,t,r){var i=r?e:this.toBBox(e),s=[],o=this._chooseSubtree(i,this.data,t,s);for(o.children.push(e),a(o,i);t>=0&&s[t].children.length>this._maxEntries;)this._split(s,t),t--;this._adjustParentBBoxes(i,s,t);},i.prototype._split=function(e,t){var r=e[t],i=r.children.length,s=this._minEntries;this._chooseSplitAxis(r,s,i);var n=this._chooseSplitIndex(r,s,i),a=g(r.children.splice(n,r.children.length-n));a.height=r.height,a.leaf=r.leaf,o(r,this.toBBox),o(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(r,a);},i.prototype._splitRoot=function(e,t){this.data=g([e,t]),this.data.height=e.height+1,this.data.leaf=!1,o(this.data,this.toBBox);},i.prototype._chooseSplitIndex=function(e,t,r){for(var i,s,o,a,l,h,c,u=1/0,p=1/0,g=t;g<=r-t;g++){var f=n(e,0,g,this.toBBox),m=n(e,g,r,this.toBBox),y=(s=f,o=m,a=void 0,l=void 0,h=void 0,c=void 0,a=Math.max(s.minX,o.minX),l=Math.max(s.minY,o.minY),h=Math.min(s.maxX,o.maxX),c=Math.min(s.maxY,o.maxY),Math.max(0,h-a)*Math.max(0,c-l)),v=d(f)+d(m);y<u?(u=y,i=g,p=v<p?v:p):y===u&&v<p&&(p=v,i=g);}return i||r-t},i.prototype._chooseSplitAxis=function(e,t,r){var i=e.leaf?this.compareMinX:l,s=e.leaf?this.compareMinY:h;this._allDistMargin(e,t,r,i)<this._allDistMargin(e,t,r,s)&&e.children.sort(i);},i.prototype._allDistMargin=function(e,t,r,i){e.children.sort(i);for(var s=this.toBBox,o=n(e,0,t,s),l=n(e,r-t,r,s),h=c(o)+c(l),d=t;d<r-t;d++){var u=e.children[d];a(o,e.leaf?s(u):u),h+=c(o);}for(var p=r-t-1;p>=t;p--){var g=e.children[p];a(l,e.leaf?s(g):g),h+=c(l);}return h},i.prototype._adjustParentBBoxes=function(e,t,r){for(var i=r;i>=0;i--)a(t[i],e);},i.prototype._condense=function(e){for(var t=e.length-1,r=void 0;t>=0;t--)0===e[t].children.length?t>0?(r=e[t-1].children).splice(r.indexOf(e[t]),1):this.clear():o(e[t],this.toBBox);},i}();var X=N.exports;class H extends X{constructor(e){super(e);}toBBox(e){const{bbox:t}=e;return {minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]}}compareMinX(e,t){return e.bbox[0]-t.bbox[0]}compareMinY(e,t){return e.bbox[1]-t.bbox[1]}import(e){super.fromJSON(e);}}const J=256,Z=null;class ${constructor(e,r,i,s){const o=t.quadToGrid(e);this.quadkey=e,this.z=o[0],this.y=o[1],this.x=o[2],this.type=r,this.bounds=t.getGeoBounds(o[0],o[1],o[2]),this.expire=s,this.clipped=i;}expired(e){return (e=e||Date.now())-this.loadStopTs>1e3*this.expire}add(e){var t;const r=this.data;-1==(null==r?void 0:r.indexOf(e))&&(r.push(e),null===(t=this.tree)||void 0===t||t.insert(e));}remove(e){var t;const r=this.data.indexOf(e);-1!==r&&(this.data.splice(r,1),null===(t=this.tree)||void 0===t||t.remove(e));}search(e){if(this.data)return this.tree||(this.tree=new H(9),this.tree.load(this.data)),this.tree.search(e)}isLoaded(){return "number"==typeof this.loadStopTs}getContentBounds(){if(!this.cbnds){const{bounds:e,provider:r}=this,{margin:i}=r;if(i){const s=r.size,o=s<<this.z,n=t.webMercatorPrj.lon2x(e[0],o),a=t.webMercatorPrj.lat2y(e[1],o);this.cbnds=[t.webMercatorPrj.x2lon(n-i,o),t.webMercatorPrj.y2lat(a+i,o),t.webMercatorPrj.x2lon(n+i+s,o),t.webMercatorPrj.y2lat(a-i-s,o)];}else this.cbnds=this.bounds;}return this.cbnds}getCenter(){const[e,t,r,i]=this.bounds;return [(e+r)/2,(t+i)/2]}project(e,r){const i=J<<this.z,s=this.x*J,o=this.y*J;return [Math.round(t.webMercatorPrj.lon2x(e,i)-s),Math.round(t.webMercatorPrj.lat2y(r,i)-o)]}lon2x(e,r=256){const i=r<<this.z,s=this.x*r;return t.webMercatorPrj.lon2x(e,i)-s}lat2y(e,r=256){const i=r<<this.z,s=this.y*r;return t.webMercatorPrj.lat2y(e,i)-s}isInside(e){const[t,r,i,s]=this.bounds,[o,n]=e;return o>=t&&o<i&&n>r&&n<=s}}const V=$.prototype;V.expire=1/0,V.error=Z,V.canvasX=Z,V.canvasY=Z;class W extends ${constructor(e,t,r,i){super(e,t,r,i),this.s=1<<this.z;}lon2x(e,t=256){return (e*this.s-this.x)*t}lat2y(e,t=256){return (e*this.s-this.y)*t}isInside(e){const t=e[0]*this.s-this.x,r=e[1]*this.s-this.y;return !(t<0||t>1||r<0||r>1)}}class Q{constructor(e,t,i){this.lvl=e,this.main="object"==typeof t?t:new r.LRU(t||256),this.sub="object"==typeof i?i:new r.LRU(t||1024);}forEach(e){this.main.forEach(e),this.sub.forEach(e);}clear(){this.main.clear(),this.sub.clear();}getCache(e){return e==this.lvl?this.main:this.sub}remove(e){this.getCache(e.z).remove(e.quadkey);}get(e){return this.getCache(e.length).get(e)}set(e){const t=this.getCache(e.z).set(e.quadkey,e),r=this._onDrop;t&&r&&r(t);}onDrop(e){this._onDrop=e;}}const K=1/0;class ee{constructor(e){this.margin=0,this.Tile=$,this.size=256,this.expire=K,this.clipped=!1;const t=this;for(var i in e=e||{})this[i]=e[i];null==this.id&&(this.id="TP-"+(1e6*Math.random()^0)),t.storage=e.storage||new Q(t.level),t.initStorage(t.storage),this.listeners=new r.Listener(["clear","error","tileInitialized","tileDestroyed"]),this.attribution=this.normalizeAttribution(e.attribution);}normalizeAttribution(e){return (Array.isArray(e)?e:[e]).map((e=>"string"==typeof e?{label:e}:(null==e?void 0:e.label)?e:null)).filter((e=>null!==e))}dispatchEvent(e,t,r=!0){t.provider=this;const i=new CustomEvent(e,{detail:t});this.listeners.trigger(e,i,r);}initStorage(e){e.onDrop((e=>e.provider._removeTile(e)));}addEventListener(e,t,r){return this.listeners.add(e,t,r)}removeEventListener(e,t,r){return this.listeners.remove(e,t,r)}clear(e,t=!0){const r=this;let i=null;if(e){if(e instanceof $&&(e=[e]),Array.isArray(e)){i="number"==typeof e[0]?r.getCachedTiles(e,r.level):e;for(let e,t=0;t<i.length;t++)e=i[t],this._removeTile(e),i[t]=e.quadkey;}}else r.storage.clear();return t&&this.dispatchEvent("clear",{tiles:i}),i}getCachedTile(e){return this.storage.get(e)}setMargin(e=0){this.margin=Number(e),this.storage.forEach((e=>e.cbnds=null));}getCachedTiles(e,t){const r=[];return t^=0,this.storage.forEach((i=>{const s=i.getContentBounds();var o,n,a,l,h,d,c,u;t&&i.z!=t||e&&(o=s[0],n=s[2],a=s[1],l=s[3],h=e[0],d=e[2],c=e[1],u=e[3],!(o<=d&&h<=n&&a<=u&&c<=l))||(r[r.length]=i);})),r}getCachedTilesOfBBox(e,t){return this.getCachedTiles(e,t)}config(e,t){if("string"==typeof e){if(void 0===t)return this[e];this[e]=t;}else if(e)for(const t in e)this[t]=e[t];return this}createTile(e){const t=new this.Tile(e,this.dataType,this.clipped,this.expire);return t.provider=this,t}getAttribution(e,t){e(this.config("attribution"));}}ee.prototype.__type="Provider";const te=(e,t)=>{let r,i;t&&((r=e[0])<t[0]&&(t[0]=r),r>t[2]&&(t[2]=r),(i=e[1])<t[1]&&(t[1]=i),i>t[3]&&(t[3]=i));},re=(e,t)=>{let r=e.length;for(;r--;)te(e[r],t);},ie=(e,t)=>{const r=e.geometry.type;if("Point"==r){const r=e.geometry.coordinates;if(t)te(r,t);else {const e=r[0],i=r[1];t=[e,i,e,i];}}else {t=t||[1/0,1/0,-1/0,-1/0];const i=e.geometry.coordinates;if("MultiLineString"==r)for(let e=0;e<i.length;e++)re(i[e],t);else if("MultiPolygon"==r)for(let e=0;e<i.length;e++)re(i[e][0],t);else if("LineString"==r||"MultiPoint"==r)re(i,t);else {if("Polygon"!=r)return !1;re(i[0],t);}}return !(!Number.isFinite(t[0])||!Number.isFinite(t[1]))&&t};var se={calcBBox:ie};class oe{static async findPath(e,t,i,s,o){return new Promise(((n,a)=>{const l=(t,i,o)=>{const n=t.geometry.coordinates[i],a=e.search({point:{longitude:n[0],latitude:n[1]},radius:.5}),l={from:{link:t,index:i},to:null};for(const e of a){if("LineString"!=e.geometry.type||e==t)continue;const i=e.geometry.coordinates,a=i.length-1,h=r.AStar.isPointEqual(n,i[0])?a:r.AStar.isPointEqual(n,i[a])?0:null;if(null!=h){const t=l.to={link:e,index:h};s(l)&&o.push({point:i[h],data:t});}}return o};let h=!0;n(r.AStar.findPath(t,i,(e=>{const t=e.data.link,r=[];return h?(h=!1,l(t,0,r),l(t,t.geometry.coordinates.length-1,r),r):(l(t,e.data.index,r),r)}),o?(e,t)=>o({from:e.point,to:t.point,direction:t.data.index?"START_TO_END":"END_TO_START",feature:t.data.link,distance:r.geotools.distance(e.point,t.point)}):(e,t)=>r.geotools.distance(e.point,t.point),(e=>{let t=e.data.link.id;return e.data.index>0&&(t+=":R"),t}),((e,t)=>e.data.link==t.data.link)));}))}}class ne{constructor(e){this.feature=e,this.tiles=new Set;}}class ae{constructor(){this._map=new Map;}has(e){return this._map.has(String(e))}get(e){return this._map.get(String(e))}set(e,t){this._map.set(String(e),t);}delete(e){this._map.delete(String(e));}toArray(){const e=new Array(this._map.size);let t=0;return this._map.forEach((r=>e[t++]=r.feature)),e}size(){return this._map.size}clear(){this._map.clear();}}const le="featureRemove",he="featureAdd",de="featureCoordinatesChange";let ce;class ue extends ee{constructor(e){super(e),this.dataType="json",this.ignore=!1,this.cnt=0,this.__type="FeatureProvider",this.tree=new H(9),this.fReg=new ae,this.Feature=this.Feature||F,[he,"featuresAdd",le,"featuresRemove",de].forEach((e=>this.listeners.addEvent(e)));}isDroppable(e){return !0}insertTileData(e,t,r,i=!0){const s=this;let o=[];for(let e of t){const t=s.prepareFeature(e);if(!1!==t){const e=s._insert(t);e?o[o.length]=e:s.tree||(o[o.length]=s.getFeature(t.id));}}s.tree&&(s.tree.load(o),o=s.clipped?o:s.search(e.getContentBounds()));for(let t of o)s._mark(t,e);i&&s.dispatchEvent("tileInitialized",{features:o,tiles:[e]}),r(o);}addFeature(e,t){var r;const i=this;let s,o;if("object"==typeof e){if("FeatureCollection"==e.type&&(e=e.features||[]),Array.isArray(e)){const r=[];i.ignore||(t=new Set);for(let s=0,o=e.length;s<o;s++)r[s]=i.addFeature(e[s],t);return t&&i.dispatchEvent("featuresAdd",{features:r,tiles:Array.from(t)}),r}if(i.isFeatureInstance(e,F)){const t=e.getProvider();t&&t!=i&&(e=e.toJSON());}if(s=i.prepareFeature(e),!1!==s){if(o=i._insert(s),o!=ce){e=o;const s=i.getCachedTiles(i.decBBox(e));for(let r of s)r.add(e),null==t||t.add(r),r.z==i.level&&this._mark(e,r);null===(r=i.tree)||void 0===r||r.insert(e),i.ignore||t||i.dispatchEvent("featuresAdd",{features:[e],tiles:s});}}else e=null;return e}}addEventListener(e,t,r){return super.addEventListener(e,t,r)}removeEventListener(e,t,r){return super.removeEventListener(e,t,r)}all(){return this.fReg.toArray()}getFeature(e){var t;return null===(t=this.fReg.get(e))||void 0===t?void 0:t.feature}getFeatures(e){e instanceof Array||(e=[e]);const t=[];for(let r=0;r<e.length;r++)t[r]=this.getFeature(e[r]);return 1==t.length?t[0]:t}createStorageTile(e){const{storage:t}=this;let r=t.get(e);return r===ce&&(t.set(r=this.createTile(e)),r.loadStartTs=Date.now()),r}getTile(e,t){const r=this,i=r.createStorageTile(e);return i.loadStopTs||(i.data=r.search(i.getContentBounds()),i.loadStopTs=Date.now()),null==t||t(i),i}setFilter(e){this.filter="function"==typeof e?e:ce;}getFeatureClass(e){return this.Feature}isFeatureInstance(e,t){return e instanceof t}createFeature(e,t){return new t(e,this)}search(e,t){const i=this;let s,o;if("object"==typeof e)if(t)for(const r in e)t[r]=e[r];else t=e;let n=t&&t.radius||1;if(e instanceof Array)o=4==e.length?e:r.geotools.getPointBBox(e,n);else {if("number"==typeof e||"string"==typeof e||!e)return i.getFeatures(e);if(e.longitude!=ce&&e.latitude!=ce)o=r.geotools.getPointBBox([e.longitude,e.latitude],n);else if(e.minLon!=ce&&e.minLat!=ce&&e.maxLon!=ce&&e.maxLat!=ce)o=[e.minLon,e.minLat,e.maxLon,e.maxLat];else {if(s=e.point||e.rect||e.viewport)return i.search(s,t);if(e.id||e.ids)return i.getFeatures(e.id||e.ids)}}o={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3]};return i._s(o)}exists(e){return this.fReg.get(e.id)}setFeatureCoordinates(e,t){const r=e;if(e=this.getFeature(e.id)){const r=e.getBBox(),{geometry:i}=e,s=i.coordinates;this.ignore=!0,this.removeFeature(e),i._xyz&&delete i._xyz,i.coordinates=this.encCoord(i.type,t),e.bbox=null,this.addFeature(e),this.ignore=!1,this.dispatchEvent(de,{feature:e,prevBBox:r,prevCoordinates:s,provider:this});}else r.geometry.coordinates=t,r.bbox=null,this.updateBBox(r);}removeFeature(e,t){var r;if(e){if("FeatureCollection"==e.type&&(e=e.features),Array.isArray(e)){const r=[];this.ignore||(t=new Set);for(let i=0,s=e.length;i<s;i++)r[i]=this.removeFeature(e[i],t);return t&&this.dispatchEvent("featuresRemove",{features:r,tiles:Array.from(t)}),r}if(e=this.getFeature(e.id)){const i=this.getCachedTiles(this.decBBox(e));for(let r of i)r.isLoaded()&&(null==t||t.add(r),r.remove(e));this.cnt--,this.fReg.delete(e.id),null===(r=this.tree)||void 0===r||r.remove(e),this.ignore||this.dispatchEvent("featuresRemove",{features:[e],tiles:i});}}return e}async findPath(e){if(!(null==e?void 0:e.from)||!(null==e?void 0:e.to))return null;const t=e=>{if("number"==typeof e.longitude){const t=e.altitude;e=[e.longitude,e.latitude],"number"==typeof t&&(e[2]=t);}return e},i=t(e.from),s=t(e.to),o=i.length+s.length<6,n=(e,t)=>r.geometry.findPointOnLineString(e,t,o),a=(e,t=100,i=1e4)=>{const s=this.search({point:{longitude:e[0],latitude:e[1]},radius:t});if(!s.length&&t<i)return a(e,10*t);const o={distance:1/0,feature:null,point:null,index:null,segment:null};for(let t of s){if("LineString"!=t.geometry.type)continue;const i=t.geometry.coordinates,s=i.length-1,a=n(i,e),l=r.geotools.distance(a.point,e);if(l<o.distance){o.distance=l,o.feature=t;const e=r.geotools.distance(a.point,i[0]),n=r.geotools.distance(a.point,i[s]);o.index=e<n?0:s,o.point=i[o.index],o.segment=a.segment;}}return o},l=a(i),h=a(s);if(!l.feature||!h.feature)return null;const d={point:l.feature.geometry.coordinates[l.index],data:{link:l.feature,index:l.index}},c={point:h.feature.geometry.coordinates[h.index],data:{link:h.feature,index:h.index}},u=await oe.findPath(this,d,c,(null==e?void 0:e.allowTurn)||(()=>!0),null==e?void 0:e.weight);return (null==u?void 0:u.length)?{from:[...d.point],to:[...c.point],features:u.map((e=>e.data.link)),get distance(){let e=0;for(let t of this.path.geometry.coordinates)for(let i=1,s=t.length;i<s;i++)e+=r.geotools.distance(t[i-1],t[i]);return e},get path(){const{features:e}=this;let t=[...e[0].geometry.coordinates],o=e[1].geometry.coordinates;(r.AStar.isPointEqual(t[0],o[0])||r.AStar.isPointEqual(t[0],o[o.length-1]))&&t.reverse();const a=[t];for(let t=1;t<e.length;t++){const i=a[t-1],s=[...e[t].geometry.coordinates];r.AStar.isPointEqual(s[0],i[i.length-1])||s.reverse(),a.push(s);}const{point:l,segment:h}=n(a[0],i);a[0]=a[0].slice(h),a[0][0]=l;const d=a.length-1;let{point:c,segment:u}=n(a[d],s);return a[d]=a[d].slice(0,u+1),a[d][u+1]=c,{type:"Feature",geometry:{type:"MultiLineString",coordinates:a},properties:{}}}}:void 0}clear(e,t){var r,i;const s=this;if(!e){null===(r=s.tree)||void 0===r||r.clear();const{fReg:e}=s,t=e.toArray();e.clear();for(const r of t)s.isDroppable(r)||(e.set(r.id,new ne(r)),null===(i=s.tree)||void 0===i||i.insert(r));s.cnt=e.size();}return super.clear(e,t)}_insert(e){const t=e.id;let r=null;const i=this.getFeatureClass(e),s=this.filter;return s&&!s(e)||this.fReg.has(t)||(this.cnt++,this.isFeatureInstance(e,i)?e._provider=this:e=this.createFeature(e,i),this.updateBBox(e),this.fReg.set(String(t),new ne(e)),r=e),r}_mark(e,t){var r;null===(r=this.fReg.get(e.id))||void 0===r||r.tiles.add(t.quadkey);}_removeTile(e,t){const r=this;let i;const s=e.quadkey;r.storage.remove(e);const o="tileDestroyed",n=r.listeners.isListened(o)&&[];if(i=e.data)for(let e of i)r._dropFeature(e,s,t)&&n&&n.push(e);n&&r.dispatchEvent(o,{features:n,tiles:[e]});}_dropFeature(e,t,r){var i;const s=this,o=s.fReg.get(e.id);if(o){const r=o.tiles;if(r.delete(t),!r.size&&s.isDroppable(e))return s.cnt--,s.fReg.delete(e.id),null===(i=s.tree)||void 0===i||i.remove(e),!0}}_s(e,t){if(this.tree)return this.tree.search(e);const r=Math.random(),{level:i}=this;let s;return this.storage.forEach((o=>{if(o.z!=i||!o.isLoaded()||-1==(null==t?void 0:t.indexOf(o.quadkey)))return;const n=o.search(e);if(n.length)if(s)for(let e of n)e._m!=r&&(e._m=r,s[s.length]=e);else {s=n;for(let e of s)e._m=r;}})),s||[]}encCoord(e,t){return t}decCoord(e){return e.geometry.coordinates}decBBox(e){return e.bbox}prepareFeature(e){var t;return null!==(t=e.id)&&void 0!==t||(e.id=1e8*Math.random()^0),e.bbox?(6===e.bbox.length&&(e.bbox=[e.bbox[0],e.bbox[1],e.bbox[3],e.bbox[4]]),e):this.updateBBox(e)&&e}updateBBox(e){if(!e.bbox){const t=ie(e);if(!t)return !1;{e.bbox=t;const r=e.geometry;r._c&&(r._c=null),r._pc&&(r._pc=null);}}return !0}}ue.prototype.modifyFeatureCoordinates=ue.prototype.setFeatureCoordinates;class pe{constructor(...e){this.executing=0,this.parallel=16,this.q=[],this.lq={},this.src=e;}exec(){const e=this,t=e.q;for(;t.length&&e.executing<e.parallel;){const{onError:r,onSuccess:i,tile:s}=t.pop();e.loadTile(s,i,r);}}loadTile(e,t,r,i=0){const s=this,o=s.src,n=s.lq;s.executing++,n[e.quadkey]=[e,t,r,i],o[i].load(e,((r,i)=>{s.executing--,delete n[e.quadkey],s.exec(),t(r,i);}),((t,i)=>{r(t,i),s.executing--,delete n[e.quadkey],s.exec();}));}tile(e,t,r){this.q.unshift({onError:r,onSuccess:t,tile:e}),this.exec();}abort(e){const t=this,r=t.q,i=t.lq,s=t.src;let o,n=!0;const a=r.findIndex((t=>t.tile===e));return -1!==a?r.splice(a,1):(o=i[e.quadkey])?(t.executing--,delete i[e.quadkey],s[o[3]].abort(e)):n=!1,t.exec(),n}clear(){this.src.forEach((e=>{var t;null===(t=e.clear)||void 0===t||t.call(e);}));}setUrl(){var e;for(const t of this.src)null===(e=t.setUrl)||void 0===e||e.apply(t,arguments);}}class ge{constructor(e,t){this.c=0,this.cbs=[],this.qks=t,this.tile=e;}receive(e){const t=this;if(!t.ready){const r=t.tile,i=t.qks,s=i.indexOf(e.quadkey);if(-1!=s&&(i[s]=null,++t.c==i.length)){t.ready=!0;const i=e.error;if(i)r.error=i;else {const[e,t,i,s]=r.getContentBounds(),{provider:o}=r;r.data=r.provider._s({minX:e,minY:t,maxX:i,maxY:s},o.clipped&&r.quadkey);}r.loadStopTs=Date.now(),t.exec(),r.onLoaded.length=0,t.qks=null;}}}exec(){const e=this.cbs,t=e.length,r=this.tile;let i=0;for(;i<t;)e[i++](r,r.error);e.length=0;}add(e){const t=this.cbs;if("function"==typeof e&&-1==t.indexOf(e))return t.push(e),!0}remove(e){const t=this.cbs,r=t.indexOf(e);return -1!=r&&t.splice(r,1),t.length}}ge.prototype.ready=!1;const fe=e=>"function"==typeof e,me=e=>fe(e),ye=(e,t)=>function(r,i,s){const o={data:r,provider:t,ready:i};s&&(o.tile={x:s.x,y:s.y,z:s.z,quadkey:s.quadkey}),((e,t={})=>{let r,i=t.ready;var s;r=me(e)?e(t):t.data,!(s=r)||"object"!=typeof s&&"function"!=typeof s||"function"!=typeof s.then?void 0!==r&&i(r):r.then(i);})(e,o);};let ve,xe;class be{constructor(e){let{loader:t}=e;if(!t)throw new Error("no tile loader defined.");t instanceof pe||(t=new pe(t)),this.loader=t,this.provider=e.provider,this.initPreprocessor(e.preProcessor),"function"==typeof e.processTileResponse&&(this.processTileResponse=e.processTileResponse);}initPreprocessor(e){this.preprocess=ye(e,this.provider);}clear(){this.loader.clear();}cancel(e,t){const r=this.provider,i=r.storage,s=t==ve;let o;if(o=e instanceof r.Tile?e:i.get(e),o){const{onLoaded:e}=o;e&&(s?e.length=0:e.splice(e.indexOf(t),1),e.length||this.loader.abort(o)&&i.remove(o));}}execTile(e){const t=e.onLoaded;let r;if(t){for(var i=0,s=t.length;i<s;i++)r=t[i],r instanceof ge?r.receive(e):r(e);t.length=0;}}processTileResponse(e,t,r,i){r(t);}handleTileResponse(e,t,r,i){e.loadStopTs=Date.now(),this.processTileResponse(e,t,(t=>{e.data=t,this.execTile(e),i&&i();}),r);}completeTile(e,t){this.handleTileResponse(e,t);}getTile(e,t){const r=this.provider,i=r.storage;let s;if((s=i.get(e))==ve)s=r.createTile(e),s.onLoaded=[],s.data=[],i.set(s);else if(s.isLoaded())return t&&t(s,s.error),s;return t&&-1==s.onLoaded.indexOf(t)&&s.onLoaded.push(t),s.loadStartTs||(s.loadStartTs=Date.now(),this.loader.tile(s,((e,t)=>{this.preprocess(e,(e=>this.completeTile(s,e)),s);}),((e,t)=>{s.error=e,this.handleTileResponse(s,void 0,t,(()=>r.listeners.trigger("error",[e,s],!0)));}))),s}drop(e){this.provider.storage.remove(e),e.isLoaded()||this.loader.abort(e);}}class _e extends be{constructor(e){super(e),this.dep={},this.blockedLevels={},this.level=e.level,this.ignoreTileQueryLimit=e.ignoreTileQueryLimit||!1;}cancel(e,r){const i=this.provider,s=i.storage,o=r==xe;let n,a;if(a=e instanceof i.Tile?e:s.get(e),a){e=a.quadkey,n=t.getTilesOfLevel(e,this.level);for(let t,l,h=0;h<n.length;h++)if(l=n[h],t=l==e?a:s.get(l),t){const e=t.onLoaded;let n;e&&(o?a.onLoaded.length=0:i.level&&a.z!=i.level?(n=e.indexOf(a.onLoaded[0]),-1!=n&&(e[n].remove(r)||e.splice(n,1))):e.splice(e.indexOf(r),1),e.length||this.loader.abort(t)&&s.remove(t));}}}clear(){super.clear(),this.dep={};}createTile(e){const r=this.provider.createTile(e),i=r.z,s=this.level;let o,n;if(s&&i!=s&&(i>s?o=[e.substr(0,s)]:i<s&&(o=t.getTilesOfLevel(e,s)),o))for(let e=0,t=o.length;e<t;e++){let t=o[e];n=this.dep[t],n||(n=this.dep[t]=[]),n[n.length]=r;}return r}getTile(e,r){const i=this.provider,s=i.storage,o=this.level;let n;if((n=s.get(e))==xe)n=this.createTile(e),n.onLoaded=[],n.data=[],s.set(n);else if(n.isLoaded())return r&&r(n,n.error),n;const a=(e,t)=>{t&&-1==e.onLoaded.indexOf(t)&&e.onLoaded.push(t);},l=e.length;if(l!=o){if(n.loadStartTs=Date.now(),!this.ignoreTileQueryLimit&&o>l)return this.blockedLevels[l]||(this.blockedLevels[l]=1),a(n,r),setTimeout((()=>this.completeTile(n,[])),0),n;const h=t.getTilesOfLevel(e,o);let d,c;n.onLoaded.length?c=n.onLoaded[0]:(c=new ge(n,h),n.onLoaded.push(c)),c.add(r);for(let e=0;e<h.length;e++)d=s.get(h[e]),d==xe?d=i.getTile(h[e],c):d.isLoaded()?c.receive(d):-1==d.onLoaded.indexOf(c)&&d.onLoaded.push(c);}else a(n,r),n.loadStartTs||(n.loadStartTs=Date.now(),this.loader.tile(n,(e=>{this.preprocess(e,(e=>this.completeTile(n,e)),n);}),((e,t)=>{n.error=e,this.handleTileResponse(n,void 0,t,(()=>i.listeners.trigger("error",[e,n],!0)));})));return n}drop(e){const t=e.quadkey,r=this.provider.storage;let i;if(i=this.dep[t]){for(var s=0;s<i.length;s++)r.remove(i[s]);delete this.dep[t];}super.drop(e);}}class Te extends ue{constructor(e){super(Object.assign({staticData:!1},e)),this.sizeKB=0;let t=e.loader;if(!t)throw new Error("no tile loader defined.");t instanceof pe||(t=new pe(t));const{preProcessor:r}=e;this.remoteTileLoader=new _e({provider:this,loader:t,level:this.level,ignoreTileQueryLimit:e.ignoreTileQueryLimit,preProcessor:r,processTileResponse:(e,t,r)=>{if(e.error)return r(e.data);this.insertTileData(e,t,r);}});}cancel(e,t){this.remoteTileLoader.cancel(e,t);}getLoader(){return this.remoteTileLoader.loader}config(e){return super.config(e)}clear(e){return 0==arguments.length&&this.remoteTileLoader.clear(),super.clear.apply(this,arguments)}getTile(e,t){return this.remoteTileLoader.getTile(e,t)}_removeTile(e,t){this.remoteTileLoader.drop(e),super._removeTile(e,t);}}class Le extends F{getMvtLayer(){return this.geometry.__xyz.l}getDataSourceLayer(e){return this.geometry.__xyz.l}}class we extends Te{constructor(e){super(r.JSUtils.extend({loader:e.loader||new R(e),margin:0,Tile:W,Feature:Le,preProcessor:Y},e)),this.c=null,this.clipped=!0,this.tree=null;}decCoord(e){return e.geometry._coordinates()}getAttribution(e){let t=this,i=t.url;"function"==typeof i&&(i=i(0,0,0,""));let s=(null==i?void 0:i.match)&&i.match(/.*xyz+.*here\.com\/tiles\/[a-zA-Z]+[\.\d]*\//),o=t.c;if(e)if(null==o)if(s){o=new r.Queue,o.add(e),t.c=o;t.getLoader().src[0].send({url:s+"copyright",responseType:"json",success:e=>{t.c=e,o.done(e);}});}else e(t.c=[]);else o instanceof r.Queue?o.add(e):e(o);}}const Pe={backgroundColor:"#555555",strokeWidthZoomScale:e=>e>17?1:e>14?.5:.25,styleGroups:{earth:[{zIndex:1,type:"Polygon",fill:"#555555"}],landuse:[{zIndex:2,type:"Polygon",fill:"#666666"}],water:[{zIndex:3,type:"Polygon",fill:"#353535"}],roads:[{zIndex:4,type:"Line",stroke:"#ffffff",strokeWidth:4}],highway:[{zIndex:5,type:"Line",stroke:"#ffffff",strokeWidth:6}],buildings:[{zIndex:6,type:"Polygon",fill:"#999999"}]},assign:(e,t)=>{const r=e.properties,i=r.kind,s=r.layer,o=e.geometry.type;if("water"!=s||"LineString"!=o&&"MultiLineString"!=o){if("roads"==s){if("rail"==i||"ferry"==i)return;if("highway"==i)return i}return s}}},Me=e=>{const t="string"==typeof e&&e.match(/256|512|1024|2048|4096/);return t?Number(t[0]):null};class Se extends C{constructor(e){const t=e.remote,i=t.url,s=t.min||1,o=t.max||16,n=e.name||"",a=e.max||32,l=new R(t);let h,d=e.tileSize||t.tileSize,c=e.providers;if(d||(d=Me(i)||512),!Array.isArray(c)){c=[],h=0;let e=new r.LRU(256/Math.pow(2,0)),t=new r.LRU(4*e.max);for(var u=s;u<=o;u++)c.push({min:u,max:u==o?a:u,provider:new we({name:n+"-L"+u,url:i,level:u-0,loader:l,size:d,storage:new Q(u-0,e,t)})});}super(Object.assign(Object.assign({min:s,max:a,style:Pe,margin:0,pointerEvents:!1},e),{tileSize:d,providers:c})),this.adaptiveGrid=!0;}getProvider(e){const t=Math.floor(e)-this.levelOffset;return this._p[t]}getAttribution(e){this.getProvider(this.max).getAttribution(e);}}class Ce extends x{constructor(e){super(e||{}),this.custom=!0,this.style={},this.tiled=!1;const t=this,r=t.onLayerAdd,i=t.onLayerRemove;r&&t.addEventListener("layerAdd",t.onLayerAdd=e=>{t.init(),r.call(t,e);}),i&&t.addEventListener("layerRemove",t.onLayerRemove=i.bind(t));}init(){const e=this.renderOptions||(this.renderOptions={}),t=e.mode||(e.mode="2d");this.flat="2d"==t;}onLayerAdd(e){}onLayerRemove(e){}render(e,t){}pointerEvents(e){return !1}getAttribution(){}getStyle(){return this.style}}function Ee(e,t,r){const i=new XMLHttpRequest;return i.onload=function(){t(JSON.parse(this.responseText));},i.onreadystatechange=function(){const e=this.status;4==this.readyState&&(e<200||e>=300)&&0!==e&&r&&r(this);},i.open("GET",e,!0),i.send(),i}class Re{constructor(e){const t=".json";(e=e||{}).host=e.host||"geocoder.api.here.com",e.version=e.version||"6.2",this.url="https://"+e.host+"/"+e.version+"/geocode"+t,this.reverseUrl="https://reverse."+e.host+"/"+e.version+"/reversegeocode"+t,this.cfg=e;}createUrl(e,t){let r="";t=t||{};for(const e in t)r+="&"+e+"="+encodeURIComponent(t[e]);return this.reverseUrl+"?app_id="+this.cfg.app_id+"&app_code="+this.cfg.app_code+r}geocode(e,t,r){Ee(this.createUrl(this.url,e),t,r);}reverseGeocode(e,t,r){Ee(this.createUrl(this.reverseUrl,e),t,r);}getIsoCountryCode(e,t,r){const i={mode:"retrieveAddresses",maxresults:1,jsonattributes:1};i.prox=e instanceof Array?e[1]+","+e[0]:e.latitude+","+e.longitude,this.reverseGeocode(i,(e=>{let r=null;try{r=e.response.view[0].result[0].location.address.country;}catch(e){}t&&t(r,e);}),r);}}class Fe{constructor(e){this.cache=new r.LRU(e||256);}forEach(e){this.cache.forEach(e);}clear(){this.cache.clear();}remove(e){this.cache.remove(e.quadkey);}get(e){return this.cache.get(e)}set(e){const t=this.cache.set(e.quadkey,e),r=this._onDrop;t&&r&&r(t);}onDrop(e){this._onDrop=e;}}class Oe extends ee{constructor(e){if(super(Object.assign({storage:new Fe(512)},e)),this.name="",this.opacity=1,this.dataType="image","string"==typeof e.errorImage){const t=new Image;t.src=e.errorImage,this.errorImage=t;}this.tileLoader=new be({provider:this,loader:new pe(new t.HTTPLoader({url:e.url,headers:{Accept:"*/*"},responseType:"image"})),preProcessor:e.preProcessor,processTileResponse:(e,r,i,s)=>{if(e.error)if(this.errorImage)r=this.errorImage;else if(404==e.error.statusCode){const{response:e}=s;if(e instanceof Blob&&e.type.startsWith("image"))return t.HTTPLoader.createImageFromBlob(e,i)}i(r);}});}getTile(e,t){return this.tileLoader.getTile(e,t)}_removeTile(e){this.tileLoader.drop(e);}cancel(e){return this.tileLoader.cancel(e)}}Oe.prototype.__type="ImageProvider";class ze extends ue{constructor(e){super(Object.assign({editable:!0,enforceRandomFeatureId:!0},e)),this.blocked={};}detectFeatureClass(e){switch(e.geometry.type){case"Point":return "MARKER";case"LineString":return "LINE";case"Polygon":case"MultiPolygon":return "AREA"}}getFeatureProperties(e){return e.properties}readRoutingPoint(e){return {link:this.readRoutingLink(e),position:this.readRoutingPosition(e)}}blockFeature(e,t){const r=e.id||e,i=typeof r;"string"!=i&&"number"!=i||(t?this.blocked[r]=!0:delete this.blocked[r]);}_insert(e){return this.blocked[e.id]?null:super._insert(e)}reserveId(e,t){setTimeout((()=>t(e.map((e=>e.id)))),0);}isoCC(e,t){return !0}prepareFeature(e){var t,i;return null!==(t=e.id)&&void 0!==t||(e.id=r.JSUtils.String.random()),!!super.prepareFeature(e)&&(null!==(i=e.properties)&&void 0!==i||(e.properties={}),e)}}let ke;const Ae="Method not implemented.";class Be extends Error{constructor(e,t){super(e),this.name="FeatureError",this.feature=t;}}class je extends ze{constructor(e){super(Object.assign({staticData:!1},e)),this.sizeKB=0,this._clearOnCommit=!0;const t=this;let r=e.loader;if(!r)throw new Error("no tile loader defined.");r instanceof pe||(r=new pe(r));const{preProcessor:i}=e;var s;t.preprocess=ye(i||e.preprocessor,t),t.postprocess=ye(e.postProcessor,t),this.remoteTileLoader=new _e({provider:t,loader:r,level:t.level,ignoreTileQueryLimit:e.ignoreTileQueryLimit,preProcessor:i,processTileResponse:(e,t,r)=>{if(e.error)return r(e.data);this.insertTileData(e,t,r);}}),t.commit&&(t.commit=(s=t.commit,function(e,r,i){const{postProcessor:o}=this,n=e=>{Array.isArray(e)||(e=[e]);let t,r,i=e.length;for(;i--;)t=e[i]=F.prototype.toJSON.call(e[i]),(r=t.properties)&&delete r["@ns:com:here:editor"];return e};if("object"==typeof e&&(e.put=n(e.put||[]),e.remove=n(e.remove||[]),fe(o))){let o;return t.postprocess(e,(e=>{o=s.call(this,e,r,i);})),o}return s.call(this,e,r,i)}));}getFeatures(e,t){t=t||{},e instanceof Array||("object"==typeof e&&(e.remote&&(t.remote=e.remote),e.onload&&(t.onload=e.onload),e=e.ids||e.id),e=[].concat(e));const r=this;let i=!0;const s=t.onload,o=t.remote;(a=super.getFeatures(e))instanceof Array||(a=[a]);for(let t=0;t<a.length;t++)a[t]||(a[t]=e[t],i=!1);function n(){return 1==(a=a.map((e=>"object"==typeof e?e:ke))).length?a[0]:a}if(i||!o){var a=n();return s&&s(a),a}{e=a.filter((e=>"object"!=typeof e));const i=e=>{const{onerror:r}=t;r&&r(e);};r._requestFeatures(e,(e=>{for(let t of e){let{geometry:e}=t;if(!e||!e.type||!e.coordinates)return void i(new Be("Invalid geometry",t))}this.preprocess(e,(e=>{for(let t of e)a[a.indexOf(t.id)]=r.addFeature(t);s&&s(n());}));}),i,t);}}cancel(e,t){this.remoteTileLoader.cancel(e,t);}search(e,i){const s=this;let o,n;if("object"==typeof e)if(i)for(const t in e)i[t]=e[t];else i=e;const a=(i=i||{}).onload;let l=i.radius;const h=i.remote,d=i.onerror;if(l==ke&&(l=1),e instanceof Array)n=4==e.length?e:r.geotools.getPointBBox(e,l);else {if("number"==typeof e||"string"==typeof e||!e)return s.getFeatures(e,i);if(e.longitude!=ke&&e.latitude!=ke)n=r.geotools.getPointBBox([e.longitude,e.latitude],l);else if(e.minLon!=ke&&e.minLat!=ke&&e.maxLon!=ke&&e.maxLat!=ke)n=[e.minLon,e.minLat,e.maxLon,e.maxLat];else {if(o=e.point||e.rect||e.viewport)return s.search(o,i);if(e.id||e.ids)return s.getFeatures(e.id||e.ids,i)}}if(n={minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]},h){const e=t.tileUtils.getTilesInRect(n.minX,n.minY,n.maxX,n.maxY,s.level);let r;const i=t=>{e.splice(e.indexOf(t.quadkey),1),r=r||t.error,e.length||(r?d(r):a&&a(s._s(n)));};for(let t=0;t<e.length;t++){const r=e[t],o=s.getCachedTile(r);if(o&&o.isLoaded()){if(o.error)return void(d&&d(o.error));e.splice(t--,1);}else s.getTile(r,i);}if(e.length)return}const c=s._s(n);return a&&a(c),c}getLoader(){return this.remoteTileLoader.loader}clear(e){return 0==arguments.length&&this.remoteTileLoader.clear(),super.clear.apply(this,arguments)}getTile(e,t){return this.remoteTileLoader.getTile(e,t)}_removeTile(e,t){this.remoteTileLoader.drop(e),super._removeTile(e,t);}readDirection(e){throw new Error(Ae)}readPedestrianOnly(e){throw new Error(Ae)}writeTurnRestriction(e,t,r){throw new Error(Ae)}readRoutingProvider(e,t){return this.id}readRoutingPosition(e){throw new Error(Ae)}readRoutingLink(e){throw new Error(Ae)}writeRoutingPosition(e,t){throw new Error(Ae)}writeRoutingLink(e,t){throw new Error(Ae)}readTurnRestriction(e,t){throw new Error(Ae)}writeRoutingPoint(e,t,r){this.writeRoutingLink(e,t),this.writeRoutingPosition(e,r);}writeEditState(e,t){}readFeatureHeight(e){return null}writeFeatureHeight(e,t){throw new Error(Ae)}reserveId(e,t){let i=e.length;const s=[];let o;for(;i--;)o=e[i].id,"string"==typeof o&&o.length>15?s.push(e[i].id):s.push(r.JSUtils.String.random(16));setTimeout((()=>{t(s.reverse());}),0);}isDroppable(e){const t=e.editState&&e.editState();return !t||t.drop||!t.modified&&!t.removed&&!t.split}}const Ue="Method not implemented.";class Ie extends je{constructor(e){let r=e.loader;r?r instanceof pe||(r=new pe(r)):r=new pe(new t.HTTPLoader({url:e.url,withCredentials:e.withCredentials,headers:e.headers})),e.loader=r,super(e),this.setParams(e.params||{}),this.setHeaders(e.headers||{});}_httpLoader(){const e=this.remoteTileLoader.loader.src;return e[e.length-1]}getHeader(e){return this._httpLoader().headers[e]||null}getHeaders(){return r.JSUtils.clone(this._httpLoader().headers)}setHeader(e,t){let r=this.getHeaders();r[e]=t,this._httpLoader().headers=r,this.headers=r;}setHeaders(e){let t=this.getHeaders();r.JSUtils.extend(t,e),this._httpLoader().headers=t,this.headers=t;}getParams(){return this.params}getParam(e){return this.params[e]||null}setParams(e){const t=this._httpLoader(),i=t.baseUrl;let s=this.params||{};if(r.JSUtils.extend(s,e),this.params=s,"string"==typeof i){s=r.JSUtils.extend(((e,t)=>(t=t||{},e.split(/\?|\&/).slice(1).map((e=>{e=e.split(/\=/),t[e[0]]=e[1];})),t))(i),s);let e=i.split(/\?/)[0],o="?";for(let t in s){let r=s[t];void 0===r?delete s[t]:(e+=o+t+"="+r,o="&");}t.setUrl(e);}}setParam(e,t){let r={};r[e]=t,this.setParams(r);}config(e,t){"url"===e&&"string"==typeof t&&(e={url:t},t=void 0);const r=super.config(e,t);return (null==e?void 0:e.url)&&this.setParams({}),r}commit(e,t,r,i){throw new Error(Ue)}_requestFeatures(e,t,r,i){throw new Error(Ue)}readZLevels(e){throw new Error(Ue)}writeZLevels(e,t){throw new Error(Ue)}}Ie.prototype.getFeatureUrl=Ie.prototype.getLayerUrl=Ie.prototype.getTileUrl=function(){throw new Error(Ue)};const qe="Method not implemented.";class De extends Ie{constructor(e){e.level=e.level||13,e.headers=r.JSUtils.extend({Accept:"application/geo+json"},e.headers||{}),super(e);}getFeatureUrl(e,t){throw new Error(qe)}getLayerUrl(e){throw new Error(qe)}getTileUrl(e){throw new Error(qe)}}const Ge="Method not implemented.";class Ye extends ze{constructor(e){super(Object.assign({storage:new Fe(512),editable:!1,size:512},e)),this._clearOnCommit=!1,delete this.level,this.editable||(this.Feature=F,this.detectFeatureClass=()=>null);}cancel(e){}delete(e){this.tree.remove(e);}import(e){const t=this;t.tree.import(e);let r=(e=t.tree.all()).length;for(;r--;)t._insert(e[r]);}initStorage(e){}commit(e,t,r){return "function"==typeof t&&setTimeout((()=>t({})),0),!0}readDirection(e){throw new Error(Ge)}readPedestrianOnly(e){throw new Error(Ge)}writeTurnRestriction(e,t,r){throw new Error(Ge)}readRoutingProvider(e,t){return this.id}readRoutingPosition(e){throw new Error(Ge)}readRoutingLink(e){throw new Error(Ge)}writeRoutingPosition(e,t){throw new Error(Ge)}writeRoutingLink(e,t){throw new Error(Ge)}readTurnRestriction(e,t){throw new Error(Ge)}writeRoutingPoint(e,t,r){this.writeRoutingLink(e,t),this.writeRoutingPosition(e,r);}readZLevels(e){throw new Error("Method not implemented.")}writeZLevels(e,t){throw new Error("Method not implemented.")}writeEditState(e,t){}readFeatureHeight(e){return null}writeFeatureHeight(e,t){throw new Error(Ge)}}const Ne={environment:"prd",space:"",credentials:{access_token:""},withCredentials:!1,tags:!1,https:!0,clip:!1,url:null,headers:null,propertySearch:null,editable:!0,level:0},Xe="@ns:com:here:xyz",He="http://",Je={prd:`${He}xyz.api.here.com/hub/spaces`},Ze=(e,t,r)=>{r||(r=e.includes("?")?"&":"?");for(const s in t)e+=`${r}${s}=${i=t[s],Array.isArray(i)?i.map((e=>encodeURIComponent(e))).join(","):encodeURIComponent(i)}`,r="&";var i;return e};class $e extends De{constructor(e){super(((e,t)=>((e=r.JSUtils.extend(r.JSUtils.clone(Ne),e)).params=r.JSUtils.extend(e.params||{},e.credentials),delete e.credentials,me(t)&&(e.preProcessor=t),e.url||(e.url=Je[e.environment]),e.https&&(e.url=e.url.replace(He,"https://")),e))(e,arguments[1])),this.definition=null,this.setUrl(this.getTileUrl(this.space)),e.propertySearch&&this.setPropertySearch(e.propertySearch);}getHttpLoader(){const e=this.getLoader().src;return e[e.length-1]}config(e,t){"credentials"===e&&"object"==typeof t&&(e={credentials:t},t=void 0);const r=null==e?void 0:e.credentials;return r&&(delete e.credentials,this.setParams(r)),super.config(e,t)}commit(e,t,r){const i=this.getHttpLoader();let s=0;const o=e=>{! --s&&t&&t(e);},n=e=>{r&&r(e);};if("object"==typeof e){const t=e.put||[],r=e.remove||[];t.length&&(s++,i.send(this.createUpdateFeatureRequest(t,{success:o,error:n}))),r.length&&(s++,i.send(this.createRemoveFeatureRequest(r,{success:o,error:n})));}}getLayerUrl(e){return this.url+"/"+e}getTileUrl(e){return Ze(this._addUrlFilters(this.getLayerUrl(e)+"/tile/quadkey/{QUADKEY}"),{margin:this.margin,clip:!!this.clip})}getFeatureUrl(e,t){return Array.isArray(t)||(t=[t]),Ze(this.getLayerUrl(e)+"/features",{id:t})}createUpdateFeatureRequest(e,t={}){const r=this,i=r._addUrlCredentials(r.getLayerUrl(r.space)+"/features","?");return Object.assign({type:"POST",url:i,headers:Object.assign(Object.assign({},r.headers),{"Content-Type":"application/geo+json"}),data:JSON.stringify({type:"FeatureCollection",features:e})},t)}createRemoveFeatureRequest(e,t={}){const r=this,i=Ze(r.getLayerUrl(r.space)+"/features",{id:e.map((e=>e.id))});return Object.assign({type:"DELETE",url:r._addUrlCredentials(i),headers:Object.assign(Object.assign({},r.headers),{Accept:"application/json"})},t)}prepareFeature(e){let t=(e=super.prepareFeature(e)).properties;return t[Xe]||(t[Xe]={}),e}setMargin(e){De.prototype.setMargin.call(this,e),this.setUrl(this.getTileUrl(this.space));}setUrl(e){this._httpLoader().setUrl(this._addUrlCredentials(e));}setTags(e){"string"==typeof e&&(e=[e]),this.tags=e,this.setUrl(this.getTileUrl(this.space)),this.clear();}setPropertySearch(e,t,i){let s,o="";"string"==typeof e?(s={},s[e]={operator:t,value:i}):s=e;for(let e in s){let n=s[e];t=n.operator.replace(">=","=gte=").replace("<=","=lte=").replace(">","=gt=").replace("<","=lt="),(i=null==n.values?n.value:n.values)instanceof Array||(i=[i]),i=i.map((e=>("string"==typeof e&&(r.JSUtils.isNumeric(e)||"true"==e||"false"==e||"null"==e)&&(e='"'+e+'"'),encodeURIComponent(e))));let a=e.slice(0,2);"f."!=a&&"p."!=a&&(e="p."+e),o+=e+t+i+"&";}this.psf=o.slice(0,-1),this.setUrl(this.getTileUrl(this.space)),this.clear();}getAttribution(e,t){super.getAttribution((r=>{r||(r=[]),this.getDefinition((t=>{null==e||e([...r,...t.copyright||[]]);}),t);}));}getDefinition(e,t){const i=this,s=i.getHttpLoader();let o=i.definition;if(null==o){let e=new r.Queue;o=this.definition=e,s.send({url:i._addUrlCredentials(i.getLayerUrl(i.space),"?"),id:"def",success:t=>{i.definition=t,e.done(t);},error:e=>{i.definition=[],t&&t(e);},headers:Object.assign(Object.assign({},this.headers),{Accept:"application/json"})});}e&&(o instanceof r.Queue?o.add(e):e(o));}_requestFeatures(e,t,r,i){this.getHttpLoader().send({id:e.join("&"),url:this._addUrlCredentials(this.getFeatureUrl(this.space,e)),success:e=>{t(e.features);},headers:this.headers,error:r});}_addUrlCredentials(e,t){return Ze(e,this.params,t||"&")}_addUrlFilters(e){const{tags:t,psf:r}=this;return t&&t.length&&(e=Ze(e,{tags:t})),r&&(e+="&"+r),e}}class Ve extends $e{constructor(e){var t;super((e=>{const t=Object.assign(Object.assign({url:"http://interactive.data.api.platform.here.com/interactive/v1",https:!0,space:e.layer},e),{credentials:Object.assign({},e.credentials)});return delete t.credentials.token,t})(e)),this.definition=[],this.token=null===(t=e.credentials)||void 0===t?void 0:t.token;}addRequestToken(e){return (e.headers=e.headers||{}).Authorization="Bearer "+this.token,e}createUpdateFeatureRequest(e,t={}){return this.addRequestToken(super.createUpdateFeatureRequest(e,t))}createRemoveFeatureRequest(e,t={}){return this.addRequestToken(super.createRemoveFeatureRequest(e,t))}getLayerUrl(e){return this.url+"/catalogs/"+this.catalog+"/layers/"+e}config(e,t){var r;"credentials"===e&&(e={credentials:t},t=void 0);const i=null===(r=null==e?void 0:e.credentials)||void 0===r?void 0:r.token;return i&&(this.token=i,delete e.credentials.token),super.config(e,t)}}class We{constructor(e){this.length=0,this.loaders=e;for(let t in e)this.length++;}abort(e){let{loaders:t}=this;for(let r in t)t[r].abort(e);}load(e,t,r){let{loaders:i,length:s}=this;const o={};for(let n in i){i[n].load(e,(e=>{o[n]=e,--s||t(o);}),(t=>{s=-1,this.abort(e),r(t);}));}}}class Qe extends E{constructor(e){var t,r;super("TerrainWorker",e),this.min=null!==(t=e.min)&&void 0!==t?t:0,this.max=null!==(r=e.min)&&void 0!==r?r:30;}processData(e){return e}load(e,r,i){if(e.quadkey.length<this.min){const i=t.createTerrainTile(e.x,e.y,e.z,new Uint16Array([0,1,3,1,2,3]),new Uint8Array([0,0,0,255,0,0,255,255,0,0,255,0]),new Int8Array([0,0,127,0,0,127,0,0,127,0,0,127]),{quantizedRange:255,quantizedMinHeight:0,quantizedMaxHeight:255});return i.properties.dummy=!0,r(i)}super.load(e,r,i);}setMaxGeometricError(e){this.call({method:"setMaxGeometricError",data:e});}async createMeshFromHeightMap(e){return this.call({method:"createMeshFromHeightMap",key:`${e.zoom}:${e.centerLatitude}`,data:e,transfer:[e.heightMap.buffer]})}}class Ke extends F{getHeightMap(){return this.properties.heightMap||null}getHeightAt(e,t,r=!1){const i=this.getHeightMap();if(!i)return null;const s=Math.sqrt(i.length),o=Math.floor(e*s);return i[Math.floor(t*s)*s+o]}}class et extends Te{constructor(e){e||(e={});const r=[],i=(e=>("number"==typeof e&&(e=Object.fromEntries(Array.from({length:30},((t,r)=>[r,e])))),e))(e.maxGeometricError),s=e=>{e&&r.push(...Array.isArray(e)?e:[e]);};let o;if(s(e.attribution),!e.loader){const r={};for(let n of ["terrain","imagery"]){const a=e[n];if(a){const e="terrain"==n?Qe:t.HTTPLoader;r[n]=new e(Object.assign(Object.assign({headers:Object.assign({Accept:"*/*"},a.headers)},a),{maxGeometricError:i})),"terrain"==n&&(o=r[n]),s(a.attribution);}}e.loader=new pe(new We(r));}super(Object.assign(e,{level:0,storage:new Fe(512),clipped:!0,attribution:r})),this.dataType="json",this.Feature=Ke;const n=this;this._twl=o,this.remoteTileLoader=new be({provider:n,loader:e.loader,preProcessor:this.preProcessor.bind(this),processTileResponse:(e,t,r)=>{if(e.error)return r(e.data);n.insertTileData(e,t,r);}});}getTile(e,t){return super.getTile(e,t)}preProcessor(e){const{data:r,tile:i}=e,s=r.terrain;if(s){const{properties:e}=s;r.imagery&&(e.texture=r.imagery);const{heightMap:o}=e,n=[];for(let r of [t.Neighbor.RIGHT,t.Neighbor.BOTTOM,t.Neighbor.LEFT,t.Neighbor.TOP]){const s=r===t.Neighbor.RIGHT?1:r===t.Neighbor.LEFT?-1:0,a=r===t.Neighbor.BOTTOM?1:r===t.Neighbor.TOP?-1:0,l=this.getCachedTile(t.tileXYToQuadKey(i.z,i.y+a,i.x+s));if(null==l?void 0:l.isLoaded()){const i=l.data[0];if(!i)continue;const s=i.properties,a=t.getOppositeNeighbor(r);if(n.push(l),e.edgeIndices)r===t.Neighbor.RIGHT||r===t.Neighbor.BOTTOM?t.stitchMeshBorders(r,e,s):t.stitchMeshBorders(a,s,e);else {const e=s.heightMap;r===t.Neighbor.RIGHT||r===t.Neighbor.BOTTOM?(t.stitchHeightmapBorders(o,e,r,1,2),t.stitchHeightmapBorders(e,o,a,2,1)):(t.stitchHeightmapBorders(e,o,a,1,2),t.stitchHeightmapBorders(o,e,r,2,1));}}}n.length&&this.dispatchEvent("featuresAdd",{tiles:n,features:[]},!1);}return [s]}}et.prototype.__type="TINProvider";const tt=(e,[t,r])=>(t<e[0]&&(e[0]=t),t>e[2]&&(e[2]=t),r<e[1]&&(e[1]=r),r>e[3]&&(e[3]=r),e);class rt extends F{getFeatures(e=[]){for(let t of this.properties._clustered)t instanceof rt?t.getFeatures(e):e.push(t);return e}getClusterBBox(){const e=[1/0,1/0,-1/0,-1/0];for(let t of this.getFeatures())tt(e,t.geometry.coordinates);return e}}class it extends Ye{constructor(e){super(e),this.Feature=rt,this.f2c=new Map;}all(){return this.tree.all()}getFeatureClass(e){return e.properties.clusterSize?rt:F}clear(e,t){const r=super.clear(e);if(e)for(const e of r){const t=this.getCachedTile(e);if(t)for(let e of t.data)this.f2c.delete(e);}else this.f2c.clear();return r}setMargin(e=0){this.margin<e&&super.setMargin(e);}addCluster(e){return this.tree.insert(e),e}hasCluster(e){return this.f2c.has(e)}getCluster(e){return this.f2c.get(e)}setCluster(e,t){return this.f2c.set(e,t)}removeFromCluster(e){return this.f2c.delete(e)}removeCluster(e){return this.tree.remove(e),e}}const st=(e,t,r)=>{const i=e[0]-t[0],s=e[1]-t[1];return i*i/r[0]+s*s/r[1]<=1};var ot;!function(e){e[e.GROW=0]="GROW",e[e.SHRINK=1]="SHRINK";}(ot||(ot={}));class nt extends C{constructor(e){const t=e.provider,r=[],i=e.clusterMaxZoom||e.max||13,s=e.min||2;let o=e.clusterRadius||e.radius||32;const n=S(e.tileSize||t.size||512);for(var a=s-n;a<=i-n;a++)r.push({min:a,max:a,provider:new it({id:`cluster-${a}-${t.id}`,margin:o})});super(Object.assign(Object.assign({clusterRadius:o,tileSize:512},e),{providers:r})),this._globalClusterId=0,this._pendingClusterJobs=new Map,this._searchRadius=[0,0],this._searchBBox=[0,0,0,0],this.clusterMaxZoom=i-this.levelOffset,this._dataProvider=t,this.featureUpdateListener=this.featureUpdateListener.bind(this),this.providerClearListener=e=>this.clear(null,!0);const l=({type:e})=>{this.listenForDataUpdates("layerAdd"==e);};this.addEventListener("layerAdd",l),this.addEventListener("layerRemove",l);}listenForDataUpdates(e){const t=(e?"add":"remove")+"EventListener";["featuresAdd","featuresRemove","tileDestroyed"].forEach((e=>{this._dataProvider[t](e,this.featureUpdateListener);})),this._dataProvider[t]("clear",this.providerClearListener);}featureUpdateListener(e){let{features:t,tiles:r}=e.detail;const i="tileInitialized"==e.type,s="featuresAdd"==e.type?ot.GROW:ot.SHRINK,o=this._updateClusters(t,s,i);if("tileDestroyed"==e.type)for(let e of r)this._pendingClusterJobs.delete(e.quadkey);this._triggerTileRefresh(Array.from(o));}createProperties(e){return {}}aggregateProperties(e,t,r){}_createClusterTile(e){return this.getClusterProvider(e.length).createStorageTile(e)}_triggerTileRefresh(e){e.length&&this.dispatchEvent("featuresAdd",{tiles:e,features:[]},!1);}_setTileData(e,t){var r;e.data=t,null!==(r=e.loadStopTs)&&void 0!==r||(e.loadStopTs=Date.now());}_updateCachedTiles(e,t,r){const i=t.getCachedTiles(e);if(i)for(let e of i){null==r||r.add(e);const i=t.search(e.getContentBounds());this._setTileData(e,i);}}_initSearch(e,r){const i=t.webMercatorPrj.mapSizePixel(this.tileSize,r),s=t.webMercatorPrj.geoToPixel(e[0],e[1],i),o=this.clusterRadius,n=t.webMercatorPrj.pixelToGeo(s.x+o,s.y-o,i),a=n.longitude-e[0],l=n.latitude-e[1];return this._searchRadius[0]=a,this._searchRadius[1]=l,this._searchRadius}searchClusterNearby(e,t){const r=this._searchBBox,[i,s]=this._searchRadius,[o,n]=t;r[0]=o-i,r[1]=n-s,r[2]=o+i,r[3]=n+s;const a=e.search(r),l=[i*i,s*s];for(let e of a)if(st(e.geometry.coordinates,t,l))return e}_shrinkCluster(e,t,r){t[0]&&this._initSearch(t[0].geometry.coordinates,e);const i=[1/0,1/0,-1/0,-1/0],s=new Set;for(let e of t){let t=r.getCluster(e);if(t){const{properties:o}=t,n=o._clustered;if(!e.properties.clusterSize){const t=n.indexOf(e);r.removeFromCluster(e),n.splice(t,1);}tt(i,t.geometry.coordinates),0==--o.clusterSize?r.removeCluster(t):this.aggregateProperties(o,e.properties,"remove"),s.add(t);}}return {bounds:i,clusters:s}}_updateClusterSize(e){let t=0,r=0,i=0;for(let s of e.properties._clustered){const e=s.properties.clusterSize||1;r+=s.geometry.coordinates[0]*e,i+=s.geometry.coordinates[1]*e,t+=e;}e.geometry.coordinates[0]=r/t,e.geometry.coordinates[1]=i/t,e.properties.clusterSize=t;}_createClusters(e,t,r,i=!1){t[0]&&this._initSearch(t[0].geometry.coordinates,e);const s=new Set,o=[1/0,1/0,-1/0,-1/0];for(let n of t){let t,a=r.getCluster(n);if(a){if(i)continue;t=a.bbox,this._updateClusterSize(a);}else {const{properties:i}=n;if(t=n.bbox,a=this.searchClusterNearby(r,n.geometry.coordinates),a){const e=i.clusterSize||1,r=a.properties,s=r.clusterSize;r._clustered.push(n);const o=r.clusterSize+=e;this.aggregateProperties(r,n.properties,"add");const l=a.geometry;l.coordinates[0]=(l.coordinates[0]*s+t[0]*e)/o,l.coordinates[1]=(l.coordinates[1]*s+t[1]*e)/o,t=a.geometry.coordinates;}else {let s,o=1;i.isCluster&&(t=n.geometry.coordinates,o=i.clusterSize),s=[n],a=this._createClusterFeature(t[0],t[1],this._globalClusterId++,e,o,s),a=r.addCluster(a);}}s.add(a),r.setCluster(n,a),tt(o,t);}return {bounds:o,clusters:s}}getDataProvider(){return this._dataProvider}clear(e,t=!0){t&&this._dataProvider.clear(),this._pendingClusterJobs.clear();for(let t=this.clusterMaxZoom;t>=this.min;t--)this.getClusterProvider(t).clear(e,!1);this.dispatchEvent("clear",{tiles:null});}_getCoveringTile(e){for(let[t,r]of Array.from(this._pendingClusterJobs))if(0==e.indexOf(t))return t}_updateClusters(e,t=ot.GROW,r=!1){const i=this.clusterMaxZoom,s=this.min,o=new Set;for(let n=i;n>=s;n--){const i=this.getClusterProvider(n),{bounds:s,clusters:a}=t==ot.GROW?this._createClusters(n,e,i,r):this._shrinkCluster(n,e,i);this._updateCachedTiles(s,i,o),e=Array.from(a),r=!1;}return o}_createClusterFeature(e,t,r,i,s,o){const n=this.getClusterProvider(i),a=this.createProperties(o[0].properties);return a.isCluster=!0,a.zoom=i,a.clusterSize=s,a._clustered=o,n.createFeature({id:r,bbox:[e,t,e,t],type:"Feature",geometry:{type:"Point",coordinates:[e,t]},properties:a},n.Feature)}getProvider(e=this.clusterMaxZoom){return super.getProvider(e)}getClusterProvider(e){return this._p[e]}getTile(e,t){if(e.length>this.clusterMaxZoom)return this._dataProvider.getTile(e,t);const r=this._createClusterTile(e);if(!!r.loadStopTs)return null==t||t(r),r;const i=()=>{const t=e.length,i=r.getContentBounds(),s=this.getClusterProvider(t).search(i);return this._setTileData(r,s),r},s=this._getCoveringTile(e)||e;let o=this._pendingClusterJobs.get(s);if(0===(null==o?void 0:o.size))return null==t||t(i()),r;let n;return o?n=o.get(e)||(()=>{o.delete(e),null==t||t(i());}):(this._pendingClusterJobs.set(s,o=new Map),n=e=>{o.delete(s);const i=this._updateClusters(e.data,ot.GROW,!0);this._triggerTileRefresh(Array.from(i)),null==t||t(r);}),o.set(e,n),this._dataProvider.getTile(s,n),r}getCluster(e,t=this.clusterMaxZoom){return this.getClusterProvider(t).getCluster(e)}getClusters(e){const t=[];for(let r=this.clusterMaxZoom;r>=this.min&&(e=this.getClusterProvider(r).getCluster(e));r--)t.push(e);return t}totalFeaturesClustered(e=this.clusterMaxZoom){let t=0;for(let r of this.getClusterProvider(e).all())t+=r.properties.clusterSize||1;return t}}const at={0:5e3,1:2500,2:1300,3:700,4:400,5:200,6:100,7:50,8:25,9:12,10:6,11:3,12:1.5,13:.8,14:.4,15:.2,16:.1,17:.05,18:.025,19:.0125,20:.00625},lt=[{type:"ambient",color:"white",intensity:1}];class ht{constructor(e={}){const t={},r=e.material||{};let i="defaultTerrainLight",s=512;const o=e.exaggeration||1;e.light?(i="terrainLight",t[i]=e.light):t[i]=lt,this.setTileSize=e=>{s=e;},Object.assign(this,{skyColor:e.skyColor||{type:"LinearGradient",stops:{"0.0":"rgba(251, 251, 251, 1)",.1:"rgba(225, 237, 248, 1)",.2:"rgba(201, 223, 245, 1)",.3:"rgba(179, 209, 241, 1)",.4:"rgba(157, 195, 237, 1)",.5:"rgba(136, 181, 233, 1)",.6:"rgba(115, 167, 229, 1)",.7:"rgba(95, 153, 225, 1)",.8:"rgba(75, 138, 221, 1)",.9:"rgba(55, 124, 217, 1)","1.0":"rgba(35, 110, 213, 1)"}},backgroundColor:e.backgroundColor||"#8c9c5a",lights:t,styleGroups:{TerrainModel:[{light:i,zIndex:0,type:"Model",rotate:[Math.PI/2,0,0],cullFace:"Back",terrain:!0,scale({properties:e}){const{quantizationRange:t}=e,r=1/t*s;return [r,r,-e.heightScale*o]},translate:({properties:e})=>[-.5*s,e.quantizedMinHeight,-.5*s],model({id:e,properties:t},i){const o={},n={uvScale:1};return t.texture&&(o[n.diffuseMap=`dm-${e}`]=t.texture,n.uvScale=s/t.texture.width),t.heightMap&&(o[n.heightMap=`hm-${e}`]={data:t.heightMap}),{id:`Terrain-${e}-${1e6*Math.random()^0}`,textures:o,materials:{terrain:Object.assign(Object.assign({diffuse:[1,1,1],useUVMapping:!1,wrap:"clamp"},r),n)},faces:[{geometryIndex:0,material:"terrain"}],geometries:[{position:t.vertices,index:t.indices,normal:t.normals}]}}}]},assign:({geometry:e})=>"TerrainModel"});}setTileSize(e){}}class dt extends C{constructor(e){var t,r,i,s,o;const{elevation:n}=e,{url:a,encoding:l}=n,h=e.tileSize||Me(a)||512,d=l.includes("json")?"json":"xyztrn"==l?"arraybuffer":"image";if(!d)throw new Error("TerrainTileLayer requires a valid `encoding` in elevation options.");const c=null===(t=e.imagery)||void 0===t?void 0:t.url;super(Object.assign(Object.assign({adaptiveGrid:!0,pointerEvents:!1,margin:0},e),{tileSize:h,provider:new et(Object.assign({maxGeometricError:e.maxGeometricError||at,terrain:{attribution:n.attribution,url:a,encoding:l,responseType:d,heightScale:null!==(r=n.scale)&&void 0!==r?r:1,heightOffset:null!==(i=n.offset)&&void 0!==i?i:0,min:null!==(s=n.min)&&void 0!==s?s:1,max:null!==(o=n.max)&&void 0!==o?o:20}},c?{imagery:{attribution:e.imagery.attribution,url:c,responseType:"image"}}:{})),style:e.style instanceof ht?e.style:new ht})),this.getStyle().setTileSize(h);}getStyle(){return super.getStyle()}}const ct=t.webMercatorPrj,ut=Object.assign({name:"xyz-maps"},{version:"0.43.0",revision:"ef8baaa",date:"2025-09-23T15:40:14Z"}),pt=s.global.here.xyz.maps;pt.common=s;const gt=pt.geo={Point:t.GeoPoint,Rect:n},ft=pt.pixel={Point:t.PixelPoint,Rect:o},mt=pt.layers={TileLayer:C,MVTLayer:Se,CustomLayer:Ce,ClusterTileLayer:nt,TerrainTileLayer:dt},yt=pt.styles={TerrainTileLayerStyle:ht},vt=pt.features={Feature:F},xt=pt.tile={Tile:$,Utils:t.tileUtils};pt.build=ut;const bt=pt.providers={ImageProvider:Oe,GeoJSONProvider:De,FeatureProvider:ue,LocalProvider:Ye,RemoteTileProvider:Te,EditableRemoteTileProvider:je,SpaceProvider:$e,IMLProvider:Ve,MVTProvider:we,TINProvider:et,EditableFeatureProvider:ze},_t=pt.projection={webMercator:ct},Tt=pt.loaders={HTTPLoader:t.HTTPLoader,Manager:pe},Lt=pt.service||{Geocoder:Re};var wt={tile:xt,layers:mt,styles:yt,geo:gt,pixel:ft,features:vt,providers:bt,projection:_t,loaders:Tt,service:Lt,build:ut,common:s};e.GeoPoint=t.GeoPoint,e.PixelPoint=t.PixelPoint,e.RTINMeshBuilder=t.RTINMeshBuilder,e.tileUtils=t.tileUtils,e.ClusterFeature=rt,e.ClusterTileLayer=nt,e.CustomLayer=Ce,e.DEFAULT_LAYER_MAX_ZOOM=32,e.DEFAULT_LAYER_MIN_ZOOM=15,e.EditableFeatureProvider=ze,e.EditableRemoteTileProvider=je,e.Feature=F,e.FeatureProvider=ue,e.GeoCoder=Re,e.GeoJSONProvider=De,e.GeoRect=n,e.HTTPProvider=Ie,e.IMLProvider=Ve,e.ImageProvider=Oe,e.Layer=x,e.LocalProvider=Ye,e.MVTLayer=Se,e.MVTProvider=we,e.PixelRect=o,e.RemoteTileProvider=Te,e.SpaceProvider=$e,e.TerrainTileLayer=dt,e.TerrainTileLayerStyle=ht,e.TerrainTileProvider=et,e.Tile=$,e.TileLayer=C,e.XYZLayerStyle=m,e.build=ut,e.default=wt,e.features=vt,e.getProviderZoomOffset=S,e.layers=mt,e.loaders=Tt,e.pixel=ft,e.projection=_t,e.providers=bt,e.service=Lt,e.styles=yt,e.tile=xt,e.utils=se,e.webMercator=ct,Object.defineProperty(e,"__esModule",{value:!0});}));

	let xyz = typeof window =='undefined'?global:window; ;
	'here.xyz.maps'.split('.').forEach((ns) => xyz = (xyz[ns] = xyz[ns] || {}));
	var xyz$1 = xyz;

	return xyz$1;

}));
